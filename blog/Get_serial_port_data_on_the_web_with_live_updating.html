
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Get serial port data on the web with live updating - Raymii.org</title>
        <style> *, ::before, ::after {background-repeat: no-repeat;-webkit-box-sizing: border-box;box-sizing: border-box;}::before, ::after {text-decoration: inherit;vertical-align: inherit;}html {cursor: default;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";line-height: 1.15;-moz-tab-size: 4;-o-tab-size: 4;tab-size: 4;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;}body {background-color: white;margin: 0;}h1 {font-size: 2em;margin: 0.67em 0;}hr {height: 0;overflow: visible;}main {display: block;}nav ol, nav ul {list-style: none;}pre {font-family: Roboto Mono, Menlo, Consolas, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}a {background-color: transparent;}abbr[title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;}b, strong {font-weight: bolder;}code, kbd, samp {font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}small {font-size: 80%;}::-moz-selection {background-color: #b3d4fc;color: #000;text-shadow: none;}::selection {background-color: #b3d4fc;color: #000;text-shadow: none;}audio, canvas, iframe, img, svg, video {vertical-align: middle;}audio, video {display: inline-block;}audio:not([controls]) {display: none;height: 0;}img {border-style: none;}svg:not([fill]) {fill: currentColor;}svg:not(:root) {overflow: hidden;}table {border-collapse: collapse;}button, input, select, textarea {font-family: inherit;font-size: inherit;line-height: inherit;}button, input, select {margin: 0;}button {overflow: visible;text-transform: none;}button, [type="button"], [type="reset"], [type="submit"] {-webkit-appearance: button;}fieldset {padding: 0.35em 0.75em 0.625em;}input {overflow: visible;}legend {color: inherit;display: table;max-width: 100%;white-space: normal;}progress {display: inline-block;vertical-align: baseline;}select {text-transform: none;}textarea {margin: 0;overflow: auto;resize: vertical;}[type="checkbox"], [type="radio"] {padding: 0;}[type="search"] {-webkit-appearance: textfield;outline-offset: -2px;}::-webkit-inner-spin-button, ::-webkit-outer-spin-button {height: auto;}::-webkit-input-placeholder {color: inherit;opacity: 0.54;}::-webkit-search-decoration {-webkit-appearance: none;}::-webkit-file-upload-button {-webkit-appearance: button;font: inherit;}::-moz-focus-inner {border-style: none;padding: 0;}:-moz-focusring {outline: 1px dotted ButtonText;}details {display: block;}dialog {background-color: white;border: solid;color: black;display: block;height: -moz-fit-content;height: -webkit-fit-content;height: fit-content;left: 0;margin: auto;padding: 1em;position: absolute;right: 0;width: -moz-fit-content;width: -webkit-fit-content;width: fit-content;}dialog:not([open]) {display: none;}summary {display: list-item;}canvas {display: inline-block;}template {display: none;}a, area, button, input, label, select, summary, textarea, [tabindex] {-ms-touch-action: manipulation;touch-action: manipulation;}[hidden] {display: none;}[aria-busy="true"] {cursor: progress;}[aria-controls] {cursor: pointer;}[aria-disabled="true"], [disabled] {cursor: not-allowed;}[aria-hidden="false"][hidden]:not(:focus) {clip: rect(0, 0, 0, 0);display: inherit;position: absolute;}main, header, footer, article, section, aside, details, summary {margin: 0 auto;margin-bottom: 16px;width: 100%;}main {display: block;margin: 0 auto;max-width: 1000px;padding: 0 16px 16px;}footer {border-top: 1px solid rgba(0, 0, 0, 0.12);padding: 16px 0;text-align: left;}footer p {margin-bottom: 0;}hr {border: 0;border-top: 1px solid rgba(0, 0, 0, 0.12);display: block;margin-top: 16px;margin-bottom: 16px;width: 100%;-webkit-box-sizing: content-box;box-sizing: content-box;height: 0;overflow: visible;}img {height: auto;max-width: 100%;vertical-align: baseline;}@media screen and (max-width: 400px) {article, section, aside {clear: both;display: block;max-width: 100%;}img {margin-right: 16px;}}embed, iframe, video {border: 0;}body {color: rgba(0, 0, 0, 0.8);font-family: "Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 16px;line-height: 1.5;}p {margin: 0;margin-bottom: 16px;}h1, h2, h3, h4, h5, h6 {color: inherit;font-family: inherit;line-height: 1.2;font-weight: 500;}h1 {font-size: 40px;margin: 20px 0 16px;}h2 {font-size: 32px;margin: 20px 0 16px;}h3 {color: #75cc00;font-size: 28px;margin: 16px 0 4px;}h4 {color: #75cc00;font-size: 24px;margin: 16px 0 4px;}h5 {color: #75cc00;font-size: 20px;margin: 16px 0 4px;}h6 {color: #75cc00;font-size: 16px;margin: 16px 0 4px;}small {color: rgba(0, 0, 0, 0.54);vertical-align: bottom;}pre {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);display: block;font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;margin: 16px 0;padding: 16px;white-space: pre-wrap;overflow-wrap: break-word;}code {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;line-height: inherit;margin: 0;vertical-align: baseline;word-break: break-all;word-wrap: break-word;}a {color: #75cc00;text-decoration: none;background-color: transparent;}a:hover, a:focus {color: #0062cc;font-weight: bolder;text-decoration: underline;}dl {margin-bottom: 16px;}dd {margin-left: 40px;}ul, ol {margin-bottom: 8px;padding-left: 40px;vertical-align: baseline;}blockquote {border-left: 2px solid rgba(0, 0, 0, 0.8);font-family: Georgia, Times, "Times New Roman", serif;font-style: italic;margin: 16px 0;padding-left: 16px;}figcaption {font-family: Georgia, Times, "Times New Roman", serif;}u {text-decoration: underline;}s {text-decoration: line-through;}sup {font-size: 14px;vertical-align: super;}sub {font-size: 14px;vertical-align: sub;}mark {background: #ffeb3b;}input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="date"], input[type="month"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="week"], input[type="number"], input[type="search"], input[type="tel"], select, textarea {background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}input[type="color"] {background: #fff;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;display: inline-block;vertical-align: middle;}input:not([type]) {-webkit-appearance: none;background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;text-align: left;}input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="url"]:focus, input[type="date"]:focus, input[type="month"]:focus, input[type="time"]:focus, input[type="datetime"]:focus, input[type="datetime-local"]:focus, input[type="week"]:focus, input[type="number"]:focus, input[type="search"]:focus, input[type="tel"]:focus, input[type="color"]:focus, select:focus, textarea:focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input:not([type]):focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {outline: 1px thin rgba(0, 0, 0, 0.12);}input[type="text"][disabled], input[type="password"][disabled], input[type="email"][disabled], input[type="url"][disabled], input[type="date"][disabled], input[type="month"][disabled], input[type="time"][disabled], input[type="datetime"][disabled], input[type="datetime-local"][disabled], input[type="week"][disabled], input[type="number"][disabled], input[type="search"][disabled], input[type="tel"][disabled], input[type="color"][disabled], select[disabled], textarea[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input:not([type])[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input[readonly], select[readonly], textarea[readonly] {border-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);}input:focus:invalid, textarea:focus:invalid, select:focus:invalid {border-color: #ea1c0d;color: #f44336;}input[type="file"]:focus:invalid:focus, input[type="radio"]:focus:invalid:focus, input[type="checkbox"]:focus:invalid:focus {outline-color: #f44336;}select {border: 1px solid rgba(0, 0, 0, 0.12);vertical-align: sub;}select:not([size]):not([multiple]) {height: -webkit-calc(2.25rem + 2px);height: calc(2.25rem + 2px);}select[multiple] {height: auto;}label {display: inline-block;line-height: 2;}fieldset {border: 0;margin: 0;padding: 8px 0;}legend {border-bottom: 1px solid rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.8);display: block;margin-bottom: 8px;padding: 8px 0;width: 100%;}textarea {overflow: auto;resize: vertical;}input[type=checkbox], input[type=radio] {-webkit-box-sizing: border-box;box-sizing: border-box;padding: 0;display: inline;}input[type=submit], input[type=reset], input[type=button], button {background-color: #75cc00;border: #75cc00;border-radius: 4px;color: #fff;padding: 8px 16px;display: inline-block;font-weight: 400;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid transparent;font-size: 1rem;line-height: 1.5;-webkit-transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;}input[type=submit]::-moz-focus-inner, input[type=reset]::-moz-focus-inner, input[type=button]::-moz-focus-inner, button::-moz-focus-inner {padding: 0;}input[type=submit]:hover, input[type=reset]:hover, input[type=button]:hover, button:hover {background-color: #0069d9;border-color: #0062cc;color: #fff;}input[type=submit]:not(:disabled):active, input[type=reset]:not(:disabled):active, input[type=button]:not(:disabled):active, button:not(:disabled):active {background-color: #0062cc;border-color: #005cbf;color: #fff;}input[type=submit]:focus, input[type=reset]:focus, input[type=button]:focus, button:focus {outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);}input[type=submit]:disabled, input[type=reset]:disabled, input[type=button]:disabled, button:disabled {opacity: .65;cursor: not-allowed;background-color: #75cc00;border-color: #75cc00;color: #fff;}table {border-top: 1px solid rgba(0, 0, 0, 0.12);margin-bottom: 16px;}caption {padding: 8px 0;}thead th {border: 0;border-bottom: 2px solid rgba(0, 0, 0, 0.12);text-align: left;}tr {margin-bottom: 8px;}th, td {border-bottom: 1px solid rgba(0, 0, 0, 0.12);padding: 16px;white-space: nowrap;vertical-align: inherit;}tfoot tr {text-align: left;}tfoot td {color: rgba(0, 0, 0, 0.54);font-size: 8px;font-style: italic;padding: 16px 4px;}a.skip-main {left:-999px;position:absolute;top:auto;width:1px;height:1px;overflow:hidden;z-index:-999;}a.skip-main:focus, a.skip-main:active {color: #fff;background-color:#000;left: auto;top: auto;width: 30%;height: auto;overflow:auto;margin: 10px 35%;padding:5px;border-radius: 15px;border:4px solid yellow;text-align:center;font-size:1.2em;z-index:999;}@font-face {font-family: 'Raleway';font-style: normal;font-weight: 600;src: url('/s/inc/css/raleway-v18-latin-600.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-600.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-600.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-600.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-600.svg#Raleway') format('svg');}@font-face {font-family: 'Raleway';font-style: italic;font-weight: 400;src: url('/s/inc/css/raleway-v18-latin-italic.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-italic.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-italic.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-italic.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-italic.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-italic.svg#Raleway') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 400;src: url('/s/inc/css/roboto-mono-v12-latin-regular.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-regular.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-regular.svg#RobotoMono') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 600;src: url('/s/inc/css/roboto-mono-v12-latin-600.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-600.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-600.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-600.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-600.svg#RobotoMono') format('svg');}@font-face {font-family: 'Ubuntu';font-style: normal;font-weight: 400;src: url('/s/inc/css/ubuntu-v15-latin-regular.eot');src: local(''), url('/s/inc/css/ubuntu-v15-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/ubuntu-v15-latin-regular.woff2') format('woff2'), url('/s/inc/css/ubuntu-v15-latin-regular.woff') format('woff'), url('/s/inc/css/ubuntu-v15-latin-regular.ttf') format('truetype'), url('/s/inc/css/ubuntu-v15-latin-regular.svg#Ubuntu') format('svg');}@font-face {font-family:'Raleway2';font-style:normal;font-weight:normal;src:url('/s/inc/css/raleway.eot');src:local('Raleway2'),local('Raleway2'),url('/s/inc/css/raleway.ttf') }.headheader {font-family:"Raleway2"!important }.headheader a {color:#000;text-decoration:none }.headheader a:hover {color:#000;text-decoration:none!important }#toc ul {list-style: none;margin: 0;padding: 0;}#toc h3 {color:black;}</style>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />         
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAYAAAD2Fg1xAAABgElEQVQ4jb3VP0iVYRTH8c9waXBokog7OYhTXChuF3GIi4hoiJA4REQIOTgGtoWTg6ODs0SYComIXCJEMhpKtD9guUU0ujRFS0PQ8DzC24v3Pq+3S9/pnMOP8/7Ocx6el/OziRN0JXTD+I2xhK4WdeNteGmbu8IgC3jQQlfCZ0zgINHzJabwoQP+ClHGV1zGJXwRDJ/FDJZi3MBQE10dL2K8gZFOGE3REDZyyjLunKG7KAzZHfMaXjXp+QbXYlzBfrvmSuhBNaHrxQU8zdQW8RhrOe0snuB7zA/jd6p4n9HV8QMfY/4JPzGAt7meFfS18LdXEk7uemIQuJ/Lj6PZQezFWhm3cTWnXcAj3MrU5oWh5WpzGM3UurGNZy28HSa8J7mB3Uy+4u/rl+UdrsT4Jraa6F6jP5M3MP0PHguzL9zzqmC2GRNYjXF2qDzDwgbgHp53wGMhJrEunGQ9oT3CQ+GFasWBsLVvwiv5XygJz/JOAe208POrJHST+CVspBB/AFY9Q3+QJqLxAAAAAElFTkSuQmCC" alt="Raymii.org Logo">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> 
                </small><br/><p>
                <link href="/s/_pagefind/pagefind-ui.css" rel="stylesheet">
                <script src="/s/_pagefind/pagefind-ui.js" type="text/javascript"></script>
                <div id="search" style="min-width:400px;max-width:1080px;"></div>
                <script>
                    window.addEventListener('DOMContentLoaded', (event) => {
                        new PagefindUI({ element: "#search" });
                    });
                </script>
                </p>
            </header>
          
    <main data-pagefind-body><h2 class='headheader' data-pagefind-meta='title' id='main'>Get serial port data on the web with live updating</h2>
<p><small>Published: <span data-pagefind-meta='date'>28-09-2019</span> | Author: Remy van Elst | <a href="Get_serial_port_data_on_the_web_with_live_updating.txt">Text only version of this article</a>
</small></p>
<br><div class='olderthanayear'><p><strong>&#10071; This post is over six years old. It may no longer be up to date. Opinions may have changed.</strong></p></div>
<div id="toc">
<h3>Table of Contents</h3>
<ul>
<li>
<a href="#toc_0">Hardware setup</a>
</li>
<li>
<a href="#toc_1">Software setup</a>
<ul>
<li>
<a href="#toc_2">screen</a>
</li>
<li>
<a href="#toc_3">Fancy pancy javascript webpage</a>
</li>
</ul>
</li>
</ul>

</div><hr><div id="contents">
<p>Recently I was asked to build a test setup to measure the accuracy of a few
loadcells (weight sensors) in a frame. Someone other than me would execute the
test and required access to the measured data, preferably live and without
needing knowledge of ssh or linux. The weight sensors can be read with an
openscale board from sparkfun via a serial connection which the board emulates
over USB (via an FTDI chip), via that same serial connection you can also
calibrate them or change settings like amount of decimals. As a quick solution I
created a webpage that uses a small amount of javascript to live update the
readings from the board. screen is used to capture the output of the serial
connection to a file which the webpage displays and updates. In this article
I&#39;ll talk about how I put various bits of software together to get the output of
the serial connection onto a nice webpage with live updating.</p>

<p><img src="/s/inc/img/logging_setup.jpg" alt="the hardware setup"></p>

<p>The picture above shows the hardware setup. The blurred part is the actual
hardware part with the load cells in it. You can see one cell on the left. The
red boards are the Sparkfun Openscale boards, connected via a USB hub to a
<a href="/s/inc/img/var-som-mx6.png">Variscite VAR-SOM-MX6</a> board running Yocto Linux (openembedded). I built a
webserver package for the board (nginx) since normally it runs nothing except
the main application. </p>

<p>The choice for this linux board was just because that was available. It could
just as well be a regular PC or Raspberry Pi, anything that can run screen and a
webserver. </p>

<p>The tests themselves will be done by someone else, who can navigate to a webpage
to check the current readings. Below is a screenshot of the webpage:</p>

<p><img src="/s/inc/img/logging_webpage.png" alt="the webpage"></p>

<p class="ad"> <b>Recently I removed all Google Ads from this site due to their invasive tracking, as well as Google Analytics. Please, if you found this content useful, consider a small donation using any of the options below. It means the world to me if you  show your appreciation and you'll help pay the server costs:</b><br><br> <a href="https://github.com/sponsors/RaymiiOrg/">GitHub Sponsorship</a><br><br> <a href="https://pcbway.com/g/e7yQRg">PCBWay referral link (You get $5, I get $20 after you've placed an order)</a><br><br> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocea referral link  ($200 credit for 60 days. Spend $25 after your credit expires and I'll get $25!)</a><br><br> </p>

<p>If the test results are good enough, those load cells might be used in the
future, but not with the sparkfun openscale boards. The cells will then just be
connected to the regular machine and we&#39;ll write our own software to use the
sensors. </p>

<h3 id="toc_0">Hardware setup</h3>

<p>The hardware I used consisted of common off the shelf parts:</p>

<ul>
<li><a href="https://www.sparkfun.com/products/13261">5 Sparkfun OpenScale</a> boards</li>
<li><a href="https://en.wikipedia.org/wiki/Load_cell">5 Double-ended beam load cells</a></li>
<li>6 port USB hub </li>
<li>Linux board to connect it all up (could be a Raspberry Pi)</li>
</ul>

<p>Connecting it all is not a hard job either:</p>

<ul>
<li>Screw in the load cells on the desired places.</li>
<li>Wire them into the screw terminal on the sparkfun board</li>
<li>Connect the sparkfun boards to the USB hub</li>
<li>Connect the USB hub to the linux computer</li>
</ul>

<p>I didn&#39;t require a powered USB hub since the linux board itself gave enough
power but your results can vary. Try less sensors or a powered USB hub if the
serial connection is flaky.</p>

<h3 id="toc_1">Software setup</h3>

<p>This is where stuff gets interesting. The goal of this setup was to be easy for
a non linux user to use. Someone who will test the accuracy of the sensors, what
happens when you do X, how does the setup respons when Y happens, etc. That
person is not interested in the software side of things, they just require the
measurements.</p>

<p>The time I got allocated to build this was not much, that&#39;s why this setup is so
simple. With more time, I might have added graphs, log archiving or a piece of
custom software to read the sensors without the sparkfun board. But, it had to
be done quickly, which required me to think about what tools were at hand for
this job.</p>

<p>The essential thing the setup needed to do was to provide log data in an easily
accessible format. During testing you don&#39;t want to click five times or type
commands, you just want to test. The setup should provide that.</p>

<p>The sparkfun openscale boards barf their output right on the (emulated) serial
port. What if we could present that data on a webpage so that the tester just
needed a laptop or tablet during their testing. What if we could make that data
live update using modern fancy web techniques? (Remember I&#39;m doing embedded C,
not javascript).</p>

<h4 id="toc_2">screen</h4>

<p>Screen is a linux terminal multiplexer. You can have one terminal and use screen
to get more. Handy when you&#39;re doing work via SSH, you can reconnect to the
screen session and continue on if for whatever reason the connection dropped. Or
you can run your IRC client, it won&#39;t disconnect when you log off.</p>

<p>As a byproduct of earlier times you can also connect to a serial port. Handy for
sending <code>AT</code> commands to your modem or connecting to your actual physical
terminal. We&#39;re going to use that to connect to the USB serial device in the
sparkfun board.</p>

<p>Screen supports logging of the session to a text file and allows you to insert
timestamps in that log. Perfect for what we want. That log can then be read out
via the webpage we&#39;re creating later on.</p>

<p>Start screen with the following commandline options:</p>

<pre><code>screen -dmS sensor1 -L -Logfile sensor1.txt
/dev/serial/by-id/usb-FTDI_FT231X_USB_UART_XXXX
</code></pre>

<p>Replace the actual serial device by the path to your device. The sparkfun board
all have a unique serial number, so I can match them to the actual sensors.</p>

<ul>
<li><code>-dmS</code>: start screen in detached mode and name this session <code>sensor1</code></li>
<li><code>-L</code>: log the output to a file</li>
<li><code>-Logfile</code>: change the filename of the log from the default to <code>sensor1.txt</code> </li>
</ul>

<p>The output of the sensor will now be in text file <code>sensor1.txt</code>. If you use
<code>tail -f sensor1.txt</code> you&#39;ll notice that it only updates every 10 seconds,
whereas the openscale board outputs every 2 seconds. Luck has it that screen
allows you to set the flush rate of the log. You can either use a <code>.screenrc</code>
file, or send it to the running session as a screen command. My compiled version
of screen has some quirks due to it being an older version, so I cannot use the
<code>.screenrc</code> route. Using the <code>-X</code> option I can send a command to a running
screen session.</p>

<p>Note that this is not a shell command that will be executed, it is a screen
command. One you could also give inside the running screen session by pressing
<code>CTRL+A :</code> (colon).</p>

<p>The <a href="https://www.gnu.org/software/screen/manual/html_node/Log.html">command to set the flush rate</a> is: <code>logfile flush seconds</code>, replacing
seconds by the number of seconds.</p>

<p>To send it to a running screen session, in my case, <code>sensor1</code>, use the following
command:</p>

<pre><code>screen -S sensor1 -X logfile flush 2
</code></pre>

<p>No quotes around the options. If you <code>tail</code> again, you&#39;ll see the file being
updated every 2 seconds.</p>

<p>I put a construction like this in a shell script for all 5 sensors, the script
is autostarting at boot of the linux machine via <code>systemd</code>. That means that all
sensors will be logged to a file named <code>sensorX.txt</code> where X is the sensor
number.</p>

<p>With the logging of the serial port data set up we can continue on to create the
webpage.</p>

<h4 id="toc_3">Fancy pancy javascript webpage</h4>

<p>As you might have guessed from the section heading, I don&#39;t code javascript
often. My piece of cake is C++ and C for small embedded platforms. If the code
looks simple to you then that&#39;s the reason. No frameworks, no <code>nodejs</code>, heck, if
I could get away with a <code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2&quot;&gt;</code> I&#39;d use that.
But, modern day users expect more than that, so why not.</p>

<p>The code you&#39;ll see below uses bootstrap css for styling. Hosted bootstrap that
is, just because I&#39;m lazy. </p>

<p>The javascript part is split up into two parts. One is to actually do the XHR
(ajax) request on a file and update the DOM (replace the current contents of an
html element with the new content) and one is to reload the five files using
that first function. The automagic reloading is set with a timer via a
<code>setInterval</code>.</p>

<p>The first function to reload the data:</p>

<pre><code>function reloadData(url, html_id)
{
    var req = new XMLHttpRequest();
    var now = new Date();
    req.open(&quot;GET&quot;, url + &quot;?&quot; + now.getTime(), false);
    req.onreadystatechange = function ()
    {
        if(req.readyState === 4)
        {
            if(req.status === 200 || req.status == 0)
            {
                 dataDiv = document.getElementById(html_id);
                 dataDiv.innerHTML = req.responseText.split(&quot;\n&quot;).reverse().slice(0, 1000).join(&quot;\n&quot;);

            }
        }
    }
    req.send(null);
}
</code></pre>

<p>The function accepts an URL and a HTML element ID to replace. A timestamp is
appended to every request so that it is not cached by the browser. If the
request fails, nothing happens. The <code>.onreadystatechange</code> contains the function
we want to execute every time the readyState attribute changes of the request. </p>

<p>There is no filtering or escaping of contents, the html attribute is blatantly
replaced. </p>

<p>In the status files the data is set with the newest lines on the bottom. For the
webpage, I want those on top, since you&#39;re not scrolling when doing the testing.
You just want to look. Therefore, the file line order is reversed with this bit:</p>

<pre><code>.split(&quot;\n&quot;).reverse().slice(0, 1000).join(&quot;\n&quot;);
</code></pre>

<p>It also limits the log to at max 1000 entries. Not a great seperation of
concerns, but for this stage, workable.</p>

<p>The second part is a wrapper function to call the <code>reloadData</code> on the five files
we want:</p>

<pre><code>function reloadFiles() 
{
    reloadData(&quot;sensor1.txt&quot;, &quot;sensor1&quot;);
    reloadData(&quot;sensor2.txt&quot;, &quot;sensor2&quot;);
    reloadData(&quot;sensor3.txt&quot;, &quot;sensor3&quot;);
    reloadData(&quot;sensor4.txt&quot;, &quot;sensor4&quot;);
    reloadData(&quot;sensor5.txt&quot;, &quot;sensor5&quot;);
}
</code></pre>

<p>The last part is this:</p>

<pre><code>setInterval(reloadFiles, 1000);
</code></pre>

<p>Which will execute the wrapper function every second. </p>

<p>The HTML part of the page contains some styling and columns for a header, the
actual data is put in four of these blocks:</p>

<pre><code>&lt;div class=&quot;col-md-auto&quot;&gt;
  &lt;h2&gt;Sensor 1&lt;/h2&gt;
  &lt;pre&gt;
    &lt;div id=&quot;sensor1&quot; align=&quot;center&quot;&gt;
      &lt;p&gt;Loading Sensor 1 Data...&lt;/p&gt;
    &lt;/div&gt;
  &lt;/pre&gt;
&lt;/div&gt;
</code></pre>

<p>The text <code>Loading Sensor 1 Data...</code> will disappear the first time the function succeeds. </p>

<p>Bare-bones javascript that gets the job done. Maybe not the best, but this whole
setup was put together in two hours and that includes wiring up all the
hardware, which took most of the time.</p>
Tags: <a href="../tags/arduino.html">arduino</a>
, <a href="../tags/arm.html">arm</a>
, <a href="../tags/blog.html">blog</a>
, <a href="../tags/embedded.html">embedded</a>
, <a href="../tags/ftdi.html">ftdi</a>
, <a href="../tags/hardware.html">hardware</a>
, <a href="../tags/javascript.html">javascript</a>
, <a href="../tags/logging.html">logging</a>
, <a href="../tags/openscale.html">openscale</a>
, <a href="../tags/screen.html">screen</a>
, <a href="../tags/serial.html">serial</a>
, <a href="../tags/tty.html">tty</a>
</div></main>
<br/>
<footer>
<br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small>
                </p>
    
    </footer>
    <script data-goatcounter="https://raymii.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

    <script defer src="/s/inc/js/instant.5.2.0.js"  type="module" ></script>

     
    </main>
    </body>
    </html>
    