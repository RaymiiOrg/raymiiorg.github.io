
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Yocto boot2qt for the Raspberry Pi 4, both Qt 5.15 and 6.2 - Raymii.org</title>
        <style> *, ::before, ::after {background-repeat: no-repeat;-webkit-box-sizing: border-box;box-sizing: border-box;}::before, ::after {text-decoration: inherit;vertical-align: inherit;}html {cursor: default;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";line-height: 1.15;-moz-tab-size: 4;-o-tab-size: 4;tab-size: 4;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;}body {background-color: white;margin: 0;}h1 {font-size: 2em;margin: 0.67em 0;}hr {height: 0;overflow: visible;}main {display: block;}nav ol, nav ul {list-style: none;}pre {font-family: Roboto Mono, Menlo, Consolas, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}a {background-color: transparent;}abbr[title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;}b, strong {font-weight: bolder;}code, kbd, samp {font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}small {font-size: 80%;}::-moz-selection {background-color: #b3d4fc;color: #000;text-shadow: none;}::selection {background-color: #b3d4fc;color: #000;text-shadow: none;}audio, canvas, iframe, img, svg, video {vertical-align: middle;}audio, video {display: inline-block;}audio:not([controls]) {display: none;height: 0;}img {border-style: none;}svg:not([fill]) {fill: currentColor;}svg:not(:root) {overflow: hidden;}table {border-collapse: collapse;}button, input, select, textarea {font-family: inherit;font-size: inherit;line-height: inherit;}button, input, select {margin: 0;}button {overflow: visible;text-transform: none;}button, [type="button"], [type="reset"], [type="submit"] {-webkit-appearance: button;}fieldset {padding: 0.35em 0.75em 0.625em;}input {overflow: visible;}legend {color: inherit;display: table;max-width: 100%;white-space: normal;}progress {display: inline-block;vertical-align: baseline;}select {text-transform: none;}textarea {margin: 0;overflow: auto;resize: vertical;}[type="checkbox"], [type="radio"] {padding: 0;}[type="search"] {-webkit-appearance: textfield;outline-offset: -2px;}::-webkit-inner-spin-button, ::-webkit-outer-spin-button {height: auto;}::-webkit-input-placeholder {color: inherit;opacity: 0.54;}::-webkit-search-decoration {-webkit-appearance: none;}::-webkit-file-upload-button {-webkit-appearance: button;font: inherit;}::-moz-focus-inner {border-style: none;padding: 0;}:-moz-focusring {outline: 1px dotted ButtonText;}details {display: block;}dialog {background-color: white;border: solid;color: black;display: block;height: -moz-fit-content;height: -webkit-fit-content;height: fit-content;left: 0;margin: auto;padding: 1em;position: absolute;right: 0;width: -moz-fit-content;width: -webkit-fit-content;width: fit-content;}dialog:not([open]) {display: none;}summary {display: list-item;}canvas {display: inline-block;}template {display: none;}a, area, button, input, label, select, summary, textarea, [tabindex] {-ms-touch-action: manipulation;touch-action: manipulation;}[hidden] {display: none;}[aria-busy="true"] {cursor: progress;}[aria-controls] {cursor: pointer;}[aria-disabled="true"], [disabled] {cursor: not-allowed;}[aria-hidden="false"][hidden]:not(:focus) {clip: rect(0, 0, 0, 0);display: inherit;position: absolute;}main, header, footer, article, section, aside, details, summary {margin: 0 auto;margin-bottom: 16px;width: 100%;}main {display: block;margin: 0 auto;max-width: 1000px;padding: 0 16px 16px;}footer {border-top: 1px solid rgba(0, 0, 0, 0.12);padding: 16px 0;text-align: left;}footer p {margin-bottom: 0;}hr {border: 0;border-top: 1px solid rgba(0, 0, 0, 0.12);display: block;margin-top: 16px;margin-bottom: 16px;width: 100%;-webkit-box-sizing: content-box;box-sizing: content-box;height: 0;overflow: visible;}img {height: auto;max-width: 100%;vertical-align: baseline;}@media screen and (max-width: 400px) {article, section, aside {clear: both;display: block;max-width: 100%;}img {margin-right: 16px;}}embed, iframe, video {border: 0;}body {color: rgba(0, 0, 0, 0.8);font-family: "Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 16px;line-height: 1.5;}p {margin: 0;margin-bottom: 16px;}h1, h2, h3, h4, h5, h6 {color: inherit;font-family: inherit;line-height: 1.2;font-weight: 500;}h1 {font-size: 40px;margin: 20px 0 16px;}h2 {font-size: 32px;margin: 20px 0 16px;}h3 {color: #75cc00;font-size: 28px;margin: 16px 0 4px;}h4 {color: #75cc00;font-size: 24px;margin: 16px 0 4px;}h5 {color: #75cc00;font-size: 20px;margin: 16px 0 4px;}h6 {color: #75cc00;font-size: 16px;margin: 16px 0 4px;}small {color: rgba(0, 0, 0, 0.54);vertical-align: bottom;}pre {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);display: block;font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;margin: 16px 0;padding: 16px;white-space: pre-wrap;overflow-wrap: break-word;}code {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;line-height: inherit;margin: 0;vertical-align: baseline;word-break: break-all;word-wrap: break-word;}a {color: #75cc00;text-decoration: none;background-color: transparent;}a:hover, a:focus {color: #0062cc;font-weight: bolder;text-decoration: underline;}dl {margin-bottom: 16px;}dd {margin-left: 40px;}ul, ol {margin-bottom: 8px;padding-left: 40px;vertical-align: baseline;}blockquote {border-left: 2px solid rgba(0, 0, 0, 0.8);font-family: Georgia, Times, "Times New Roman", serif;font-style: italic;margin: 16px 0;padding-left: 16px;}figcaption {font-family: Georgia, Times, "Times New Roman", serif;}u {text-decoration: underline;}s {text-decoration: line-through;}sup {font-size: 14px;vertical-align: super;}sub {font-size: 14px;vertical-align: sub;}mark {background: #ffeb3b;}input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="date"], input[type="month"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="week"], input[type="number"], input[type="search"], input[type="tel"], select, textarea {background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}input[type="color"] {background: #fff;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;display: inline-block;vertical-align: middle;}input:not([type]) {-webkit-appearance: none;background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;text-align: left;}input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="url"]:focus, input[type="date"]:focus, input[type="month"]:focus, input[type="time"]:focus, input[type="datetime"]:focus, input[type="datetime-local"]:focus, input[type="week"]:focus, input[type="number"]:focus, input[type="search"]:focus, input[type="tel"]:focus, input[type="color"]:focus, select:focus, textarea:focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input:not([type]):focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {outline: 1px thin rgba(0, 0, 0, 0.12);}input[type="text"][disabled], input[type="password"][disabled], input[type="email"][disabled], input[type="url"][disabled], input[type="date"][disabled], input[type="month"][disabled], input[type="time"][disabled], input[type="datetime"][disabled], input[type="datetime-local"][disabled], input[type="week"][disabled], input[type="number"][disabled], input[type="search"][disabled], input[type="tel"][disabled], input[type="color"][disabled], select[disabled], textarea[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input:not([type])[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input[readonly], select[readonly], textarea[readonly] {border-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);}input:focus:invalid, textarea:focus:invalid, select:focus:invalid {border-color: #ea1c0d;color: #f44336;}input[type="file"]:focus:invalid:focus, input[type="radio"]:focus:invalid:focus, input[type="checkbox"]:focus:invalid:focus {outline-color: #f44336;}select {border: 1px solid rgba(0, 0, 0, 0.12);vertical-align: sub;}select:not([size]):not([multiple]) {height: -webkit-calc(2.25rem + 2px);height: calc(2.25rem + 2px);}select[multiple] {height: auto;}label {display: inline-block;line-height: 2;}fieldset {border: 0;margin: 0;padding: 8px 0;}legend {border-bottom: 1px solid rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.8);display: block;margin-bottom: 8px;padding: 8px 0;width: 100%;}textarea {overflow: auto;resize: vertical;}input[type=checkbox], input[type=radio] {-webkit-box-sizing: border-box;box-sizing: border-box;padding: 0;display: inline;}input[type=submit], input[type=reset], input[type=button], button {background-color: #75cc00;border: #75cc00;border-radius: 4px;color: #fff;padding: 8px 16px;display: inline-block;font-weight: 400;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid transparent;font-size: 1rem;line-height: 1.5;-webkit-transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;}input[type=submit]::-moz-focus-inner, input[type=reset]::-moz-focus-inner, input[type=button]::-moz-focus-inner, button::-moz-focus-inner {padding: 0;}input[type=submit]:hover, input[type=reset]:hover, input[type=button]:hover, button:hover {background-color: #0069d9;border-color: #0062cc;color: #fff;}input[type=submit]:not(:disabled):active, input[type=reset]:not(:disabled):active, input[type=button]:not(:disabled):active, button:not(:disabled):active {background-color: #0062cc;border-color: #005cbf;color: #fff;}input[type=submit]:focus, input[type=reset]:focus, input[type=button]:focus, button:focus {outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);}input[type=submit]:disabled, input[type=reset]:disabled, input[type=button]:disabled, button:disabled {opacity: .65;cursor: not-allowed;background-color: #75cc00;border-color: #75cc00;color: #fff;}table {border-top: 1px solid rgba(0, 0, 0, 0.12);margin-bottom: 16px;}caption {padding: 8px 0;}thead th {border: 0;border-bottom: 2px solid rgba(0, 0, 0, 0.12);text-align: left;}tr {margin-bottom: 8px;}th, td {border-bottom: 1px solid rgba(0, 0, 0, 0.12);padding: 16px;white-space: nowrap;vertical-align: inherit;}tfoot tr {text-align: left;}tfoot td {color: rgba(0, 0, 0, 0.54);font-size: 8px;font-style: italic;padding: 16px 4px;}a.skip-main {left:-999px;position:absolute;top:auto;width:1px;height:1px;overflow:hidden;z-index:-999;}a.skip-main:focus, a.skip-main:active {color: #fff;background-color:#000;left: auto;top: auto;width: 30%;height: auto;overflow:auto;margin: 10px 35%;padding:5px;border-radius: 15px;border:4px solid yellow;text-align:center;font-size:1.2em;z-index:999;}@font-face {font-family: 'Raleway';font-style: normal;font-weight: 600;src: url('/s/inc/css/raleway-v18-latin-600.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-600.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-600.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-600.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-600.svg#Raleway') format('svg');}@font-face {font-family: 'Raleway';font-style: italic;font-weight: 400;src: url('/s/inc/css/raleway-v18-latin-italic.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-italic.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-italic.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-italic.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-italic.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-italic.svg#Raleway') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 400;src: url('/s/inc/css/roboto-mono-v12-latin-regular.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-regular.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-regular.svg#RobotoMono') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 600;src: url('/s/inc/css/roboto-mono-v12-latin-600.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-600.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-600.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-600.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-600.svg#RobotoMono') format('svg');}@font-face {font-family: 'Ubuntu';font-style: normal;font-weight: 400;src: url('/s/inc/css/ubuntu-v15-latin-regular.eot');src: local(''), url('/s/inc/css/ubuntu-v15-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/ubuntu-v15-latin-regular.woff2') format('woff2'), url('/s/inc/css/ubuntu-v15-latin-regular.woff') format('woff'), url('/s/inc/css/ubuntu-v15-latin-regular.ttf') format('truetype'), url('/s/inc/css/ubuntu-v15-latin-regular.svg#Ubuntu') format('svg');}@font-face {font-family:'Raleway2';font-style:normal;font-weight:normal;src:url('/s/inc/css/raleway.eot');src:local('Raleway2'),local('Raleway2'),url('/s/inc/css/raleway.ttf') }.headheader {font-family:"Raleway2"!important }.headheader a {color:#000;text-decoration:none }.headheader a:hover {color:#000;text-decoration:none!important }#toc ul {list-style: none;margin: 0;padding: 0;}#toc h3 {color:black;}</style>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />         
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAYAAAD2Fg1xAAABgElEQVQ4jb3VP0iVYRTH8c9waXBokog7OYhTXChuF3GIi4hoiJA4REQIOTgGtoWTg6ODs0SYComIXCJEMhpKtD9guUU0ujRFS0PQ8DzC24v3Pq+3S9/pnMOP8/7Ocx6el/OziRN0JXTD+I2xhK4WdeNteGmbu8IgC3jQQlfCZ0zgINHzJabwoQP+ClHGV1zGJXwRDJ/FDJZi3MBQE10dL2K8gZFOGE3REDZyyjLunKG7KAzZHfMaXjXp+QbXYlzBfrvmSuhBNaHrxQU8zdQW8RhrOe0snuB7zA/jd6p4n9HV8QMfY/4JPzGAt7meFfS18LdXEk7uemIQuJ/Lj6PZQezFWhm3cTWnXcAj3MrU5oWh5WpzGM3UurGNZy28HSa8J7mB3Uy+4u/rl+UdrsT4Jraa6F6jP5M3MP0PHguzL9zzqmC2GRNYjXF2qDzDwgbgHp53wGMhJrEunGQ9oT3CQ+GFasWBsLVvwiv5XygJz/JOAe208POrJHST+CVspBB/AFY9Q3+QJqLxAAAAAElFTkSuQmCC" alt="Raymii.org Logo">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                </small><br/><p>
                <link href="/s/_pagefind/pagefind-ui.css" rel="stylesheet">
                <script src="/s/_pagefind/pagefind-ui.js" type="text/javascript"></script>
                <div id="search" style="min-width:400px;max-width:1080px;"></div>
                <script>
                    window.addEventListener('DOMContentLoaded', (event) => {
                        new PagefindUI({ element: "#search" });
                    });
                </script>
                </p>
            </header>
          
    <main data-pagefind-body><h2 class='headheader' data-pagefind-meta='title' id='main'>Yocto boot2qt for the Raspberry Pi 4, both Qt 5.15 and 6.2</h2>
<p><small>Published: <span data-pagefind-meta='date'>21-02-2022</span> | Author: Remy van Elst | <a href="Yocto_boot2qt_for_the_Raspberry_Pi_4_both_Qt_6_and_Qt_5.txt">Text only version of this article</a>
</small></p>
<br><div class='olderthanayear'><p><strong>&#10071; This post is over one year old. It may no longer be up to date. Opinions may have changed.</strong></p></div>
<div id="toc">
<h3>Table of Contents</h3>
<ul>
<li>
<a href="#toc_0">What is yocto, what is boot2qt</a>
</li>
<li>
<a href="#toc_1">Development host</a>
</li>
<li>
<a href="#toc_2">Building boot2qt</a>
</li>
<li>
<a href="#toc_3">Flashing the Yocto Image</a>
</li>
<li>
<a href="#toc_4">Qt Creator integration</a>
<ul>
<li>
<a href="#toc_5">Building the cross-compile SDK</a>
</li>
<li>
<a href="#toc_6">Adding the kit in Qt Creator</a>
</li>
<li>
<a href="#toc_7">Adding a remote device</a>
</li>
<li>
<a href="#toc_8">One click deploy</a>
</li>
</ul>
</li>
<li>
<a href="#toc_9">Changing the default boot2qt startup application in Yocto</a>
</li>
<li>
<a href="#toc_10">Qt 5.15.2 issues</a>
</li>
</ul>

</div><hr><div id="contents">
<p>In this guide we&#39;ll build a linux distribution for Raspberry Pi 4, using the Yocto project and the <code>boot2qt</code> stack provided by Qt. This <code>boot2qt</code> image can be written to an SD card and when booted up, the Raspberry Pi runs a software stack that integrates nicely with Qt Creator (the Qt IDE), for example, one click deployment to the device. You can run your own Qt application on the Pi, full screen, it will boot right into it.
This guide covers both Qt 5.15 and Qt 6.2. The 5.15 build process is a bit convoluted due to a few upstream issues. The guide also covers changing the default startup app to your own app and Qt Creator integration.</p>

<p>We end up with a <code>boot2qt</code> image for the Raspberry Pi 4. <a href="/s/blog/Using_IceWM_and_sharing_my_config_and_tips_tricks.html">I have an 8 GB model</a>
here, but it works just as fine with less RAM. This guide also covers the Qt
Creator kit and device setup afterwards.</p>

<p class="ad"> <b>Recently I removed all Google Ads from this site due to their invasive tracking, as well as Google Analytics. Please, if you found this content useful, consider a small donation using any of the options below:</b><br><br> <a href="https://leafnode.nl">I'm developing an open source monitoring app called  Leaf Node Monitoring, for windows, linux & android. Go check it out!</a><br><br> <a href="https://github.com/sponsors/RaymiiOrg/">Consider sponsoring me on Github. It means the world to me if you show your appreciation and you'll help pay the server costs.</a><br><br> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">You can also sponsor me by getting a Digital Ocean VPS. With this referral link you'll get $100 credit for 60 days. </a><br><br> </p>

<p><img src="/s/inc/img/boot2qt-1.png" width=400 height=250 /></p>

<blockquote>
<p>The default app of <code>boot2qt</code> 6.2 running on the Raspberry Pi 4.</p>
</blockquote>

<p><img src="/s/inc/img/boot2qt-3.png" width=400 height=250 /></p>

<blockquote>
<p>The default apps of <code>boot2qt</code> 5.15 on my Raspberry Pi 4.</p>
</blockquote>

<p>Here is <a href="https://www.youtube.com/watch?v=iBNKr3kKxhU">a video</a> of boot2qt booting straight in to <a href="/s/tutorials/Qml_Drag_and_Drop_example_including_reordering_the_Cpp_Model.html">my custom Qt</a> app:</p>

<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/iBNKr3kKxhU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p><strong>If a step is for a specific Qt version, that is mentioned. Otherwise,
the step applies to both versions.</strong></p>

<p>This guide is for the Raspberry Pi 4 but should work for any of the
other Raspberry Pi models supported by Qt. Replace the <code>MACHINE</code>
variable later on with a different model.</p>

<h3 id="toc_0">What is yocto, what is boot2qt</h3>

<p>There is a lot of ground to cover, if you are not familiar with the Yocto
project, here is a quick, <em>simplified</em>, overview of all the terms.</p>

<p>Yocto is an open-source project which provides a build framework and metadata
to help to create a custom image for your target board. Yocto uses so-called
(meta) layers and recipes. Recipes are <code>.bb</code>(for bitbake) files that contain
build instructions and layers are a collection of specific recipes, classes
and configuration files. You could have a layer named <code>meta-raspberry</code>
(all layers, by convention, start with <code>meta-</code>) that has recipes applicable
only for the Raspberry Pi.</p>

<p>Yocto helps you to build a linux distro, their reference distro is named
<code>poky</code>. The primary build tool is a python command line tool named <code>bitbake</code>.
It parses all the recipes and then, one by one, gathers the source code
and compiles all the software, then packages that up into an image for your
board.</p>

<p>Yocto is aimed at embedded linux devices, at work we use it to create our own
Linux distribution (not boot2qt) to run on the coffee machines. Many
different boards are supported, most vendors provide a so called board
support package (bsp). Often this contains a kernel and drivers for your
board. There is a board support package for the Raspberry Pi, which we will
use.</p>

<p><code>boot2qt</code> is an set of layers for Yocto which builds a simple linux system
that starts up without a desktop, right into a Qt application. It also builds
a cross-compile SDK for your desktop, which you can use in Qt Creator to
cross-compile your application for the target device. Often the device you
develop for does not have the same CPU architecture as your desktop
workstation. To top this all up, it also integrates into Qt Creator, allowing
you to one-click deploy and run your application, via the network, on your
device. </p>

<p>All three parts save you a huge amount of work. Because we have our own yocto
build I know what kind of work that involves, the boot2qt stack saves so much
time, as long as your board is supported. You can see the list of board <a href="https://web.archive.org/web/20220219190502/https://doc.qt.io/QtForDeviceCreation-5.15/qtee-custom-embedded-linux-image.html">here</a> 
Qt 5.15 and <a href="https://web.archive.org/web/20220219191035/https://doc.qt.io/QtForDeviceCreation/qtdc-supported-platforms.html">here</a> for Qt 6.2. </p>

<p><code>boot2qt</code> also provide a set of scripts to make the <code>yocto</code> setup very easy, so 
the process you see in this guide is not the same as a default <code>yocto</code> setup. It&#39;s
specifically for <code>boot2qt</code> and for the Raspberry Pi 4. </p>

<p>So to summarize, <code>boot2qt</code> provides a layer on top of yocto that adds 
integration between your embedded linux device and the Qt suite of tools,
saving a boatload of time doing manual busywork.</p>

<h3 id="toc_1">Development host</h3>

<p>The machine that is going to build your <code>boot2qt</code> image (the host that runs
<code>bitbake</code>) needs a few packages before we can get started building. You need
at least 50 GB&#39;s of free space, but my host has 300 GB. Cross-compiling all
the packages takes a huge amount of time, so the more cores and RAM you have,
the better. My test build machine has 4 cores and 8 GB of RAM, the entire image
build took 3 whole days. At work we have a few beefy servers, there the build
takes about 2 hours. Yocto does support incremental builds, so if you change 
one recipe, only that part has to be rebuilt, not all the other parts. </p>

<p>My build machine runs Ubuntu 20.04 for the Qt 5.15 build and Debian 11 for 
the Qt 6 build. Install the required packages first:</p>

<pre><code>apt-get install gawk wget git diffstat unzip texinfo gcc build-essential
chrpath socat cpio python3 python3-pip python3-pexpect xz-utils
debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa
libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev python
git-lfs g++-multilib gcc-multilib libxkbcommon-dev
libxkbcommon-x11-dev libwayland-cursor++0 libwayland-cursor0
</code></pre>

<p>These are a bit more packages than the Qt site recommends, I had build issues
when building the <code>qbsp</code> layer, which is where most of the extra packages
come from.</p>

<p>Next you need <code>repo</code>, a git management tool <a href="https://web.archive.org/web/20220219191821/https://gerrit.googlesource.com/git-repo/">by Google</a>. It hides most of
the complexity of submodules and different repo&#39;s by putting all of that
extra information in a manifest file. You can install it using apt:</p>

<pre><code>apt install repo
</code></pre>

<p>If it&#39;s not in the repository, check the <a href="https://web.archive.org/web/20220219191821/https://gerrit.googlesource.com/git-repo/">instructions</a>, installation
process is just a simple copy of one executable. </p>

<p>Create a folder where all of yocto will reside:</p>

<pre><code>mkdir b2qt
cd b2qt
</code></pre>

<p>Use the <code>repo</code> tool to clone all the git repositories of the Yocto project
and <code>boot2qt</code> at once. First initialize for the correct Qt version:</p>

<pre><code># for Qt 6.2:
repo init -u git://code.qt.io/yocto/boot2qt-manifest -m v6.2.3.xml

# for Qt 5.15
repo init -u git://code.qt.io/yocto/boot2qt-manifest -m v5.15.2.xml
</code></pre>

<p>Then sync the repositories:</p>

<pre><code>repo sync
</code></pre>

<p>You must tell which board you want to build for, then source a
script:</p>

<pre><code>export MACHINE=raspberrypi4 &amp;&amp; source ./setup-environment.sh 
</code></pre>

<p><strong>This step must be repeated on every login</strong>.</p>

<p>Output:</p>

<pre><code>### Shell environment set up for builds. ###

You can now run &#39;bitbake &lt;target&gt;&#39;

Common targets are:
b2qt-embedded-qt6-image
meta-toolchain-b2qt-embedded-qt6-sdk

QBSP target is:
meta-b2qt-embedded-qbsp

For creating toolchain or QBSP for Windows, set environment variable before running bitbake:
SDKMACHINE=x86_64-mingw32

For more information about Boot to Qt, see https://doc.qt.io/QtForDeviceCreation/
</code></pre>

<p>You should now be in a folder named <code>build-raspberrypi4</code>. Using the <code>repo</code> tool and 
sourcing this script has made a nifty folder structure for yocto:</p>

<ul>
<li><code>build-$boardname</code>: build directory for the board, you are in this folder
after sourcing the <code>setup-environment.sh</code> file.</li>
<li><code>sources</code>: has all the <code>bitbake</code> layers and recipes</li>
<li><code>download</code>: folder where all the source code is downloaded (git repo&#39;s,
tar.gz archives)</li>
</ul>

<p>In the <code>build-*</code> directory there is a <code>conf</code> folder, that has two important
files. <code>bblayers.conf</code> and <code>local.conf</code>. I had issues with the <code>oom-killer</code>
while building the image, the <code>do_compile</code> of <code>qtwebengine</code> kept crashing
(killed). I had to set the following variables to <code>1</code>, to make the build
pass:</p>

<pre><code># Default to setting automatically based on cpu count
BB_NUMBER_THREADS ?= &quot;1&quot;
# 
# Default to setting automatically based on cpu count
PARALLEL_MAKE ?= &quot;-j1&quot;
</code></pre>

<p>This is probably due to my limited hardware for the build machine, but if you
experience out of memory killer issues during a build, you know where to
look.</p>

<p>You&#39;re all set up now. I recommend you start a <code>screen</code> or <code>tmux</code> session as
the build will take a long time.</p>

<h3 id="toc_2">Building boot2qt</h3>

<p>For Qt 6 the following step runs without problems, for Qt 5 you must do some
manual patching. The patches I had to do are at the bottom of this article.
If you pay for Qt 5.15 LTS then you have no problems. The last open source
Qt 5 version at this moment is 5.15.2 and the commercial version is 5.15.8, in
the commercial release these issues are fixed, in the open source release we
have to edit a few recipes ourselves and download newer firmware. </p>

<p>The following command builds the full <code>boot2qt</code> image (and all packages) which
you can flash to an SD card:</p>

<pre><code># for Qt 6
bitbake b2qt-embedded-qt6-image

# for Qt 5
bitbake b2qt-embedded-qt5-image
</code></pre>

<p>The build process takes a long time, because it compiles all the source code. Output
is like below for Qt 5:</p>

<pre><code>    remy@host:~/b2qt/build-raspberrypi4$ bitbake b2qt-embedded-qt5-image                                                           
    WARNING: Host distribution &quot;ubuntu-20.04&quot; has not been validated with this version of the build system; you may possibly experience unexpected failures. It is recommended that you use a tested distribution.
    Loading cache: 100% |#################################################################################################| Time: 0:00:00
    Loaded 4132 entries from dependency cache.
    Parsing recipes: 100% |###############################################################################################| Time: 0:00:00
    Parsing of 2779 .bb files complete (2778 cached, 1 parsed). 4132 targets, 299 skipped, 1 masked, 0 errors.
    NOTE: Resolving any missing task queue dependencies

    Build Configuration:
    BB_VERSION           = &quot;1.44.0&quot;
    BUILD_SYS            = &quot;x86_64-linux&quot;
    NATIVELSBSTRING      = &quot;universal&quot;
    TARGET_SYS           = &quot;arm-poky-linux-gnueabi&quot;
    MACHINE              = &quot;raspberrypi4&quot;
    DISTRO               = &quot;b2qt&quot;
    DISTRO_VERSION       = &quot;3.0.4&quot;
    TUNE_FEATURES        = &quot;arm vfp cortexa7 neon vfpv4 thumb callconvention-hard&quot;
    TARGET_FPU           = &quot;hard&quot;
    SDKMACHINE           = &quot;x86_64&quot;
    meta                 
    meta-poky            = &quot;HEAD:f2eb22a8783f1eecf99bd4042695bab920eed00e&quot;
    meta-raspberrypi     = &quot;HEAD:0e05098853eea77032bff9cf81955679edd2f35d&quot;
    meta-oe              
    meta-python          
    meta-networking      
    meta-initramfs       
    meta-multimedia      = &quot;HEAD:2b5dd1eb81cd08bc065bc76125f2856e9383e98b&quot;
    meta-python2         = &quot;HEAD:4400f9155ec193d028208cf0c66aeed2ba2b00ab&quot;
    meta-boot2qt         
    meta-boot2qt-distro  = &quot;HEAD:5f23cb2d6836bbad3a1fa982089ccf20bf0c6245&quot;
    meta-mingw           = &quot;HEAD:756963cc28ebc163df7d7f4b4ee004c18d3d3260&quot;
    meta-qt5             = &quot;HEAD:72459ce0639eb3ce408558a7abede945e1f8ddc9&quot;

    Initialising tasks: 100% |############################################################################################| Time: 0:00:05
    Sstate summary: Wanted 513 Found 295 Missed 218 Current 1721 (57% match, 90% complete)
    NOTE: Executing Tasks
    NOTE: Setscene tasks completed
    Currently  5 running tasks (4391 of 6968)  63% |####################################################                                |
    0: qtquickcontrols2-5.15.2+gitAUTOINC+16f27dfa35-r0 do_compile - 9m41s (pid 4102272)
    1: qtmultimedia-5.15.2+gitAUTOINC+fd30913d46-r0 do_compile - 9m33s (pid 4104096)
    2: qtlocation-5.15.2+gitAUTOINC+02a21217a9_d3101bbc22-r0 do_compile - 8m16s (pid 4107720)
    3: qtconnectivity-5.15.2+gitAUTOINC+ca6cc606d9-r0 do_compile - 6m51s (pid 4110585)
    4: qtwayland-5.15.2+gitAUTOINC+3cc17177b1-r0 do_compile - 6m20s (pid 4111432)
</code></pre>

<p>At the bottom of the output you see different tasks running, it could be a
<code>do_fetch</code> (download the source), <code>do_compile</code> (cross-compile the code) or a
<code>do_package</code> (make a package), or a few other <code>do_*</code> steps. </p>

<p>You see that there are almost <code>7000</code> tasks, so, again, it will take a lot of time.
Check up regularly, because changes are that your build fails. Yocto error messages are
clear including log files.</p>

<p>For Qt 6.2 the output is like below:</p>

<pre><code>remy@host:~/b2qt/build-raspberrypi4$ bitbake b2qt-embedded-qt6-image
WARNING: Host distribution &quot;debian-11&quot; has not been validated with this version of the build system; you may possibly experience unex
pected failures. It is recommended that you use a tested distribution.
Loading cache: 100% |#################################################################################################| Time: 0:00:00
Loaded 4368 entries from dependency cache.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION           = &quot;1.50.0&quot;
BUILD_SYS            = &quot;x86_64-linux&quot;
NATIVELSBSTRING      = &quot;universal&quot;
TARGET_SYS           = &quot;arm-poky-linux-gnueabi&quot;
MACHINE              = &quot;raspberrypi4&quot;
DISTRO               = &quot;b2qt&quot;
DISTRO_VERSION       = &quot;3.3.4&quot;
TUNE_FEATURES        = &quot;arm vfp cortexa7 neon vfpv4 thumb callconvention-hard&quot;
TARGET_FPU           = &quot;hard&quot;
SDKMACHINE           = &quot;x86_64&quot;
meta                 
meta-poky            = &quot;HEAD:c40ac16d79026169639f47be76a3f7b9d8b5178e&quot;
meta-raspberrypi     = &quot;HEAD:b4ec97e4eb8e36efd1f7e2f8ae020a9e55cfc239&quot;
meta-oe              
meta-python          
meta-networking      
meta-initramfs       
meta-multimedia      = &quot;HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d&quot;
meta-python2         = &quot;HEAD:810d6d842f103eb59f18b06426106462b15de7e2&quot;
meta-boot2qt         
meta-boot2qt-distro  = &quot;HEAD:e59a2e20697e0afc2a0b068835cd90e102dec589&quot;
meta-mingw           = &quot;HEAD:422b96cb2b6116442be1f40dfb5bd77447d1219e&quot;
meta-qt6             = &quot;HEAD:eb3719266fc03b96d5056980b135b371f31811f4&quot;
meta-raymii          = &quot;master:0789f30e221712462748cf56b9afddeec3613be1&quot;

Initialising tasks: 100% |############################################################################################| Time: 0:00:09
Sstate summary: Wanted 482 Local 356 Network 0 Missed 126 Current 2730 (73% match, 96% complete)
NOTE: Executing Tasks
Currently  4 running tasks (4425 of 9263)  47% |########################################                                            |
0: qtwebengine-6.2.3-r0 do_compile (pid 527778)   0% |                                                                              |
1: qtwayland-6.2.3-r0 do_install_ptest_base - 1m2s (pid 527854)
2: qtdeclarative-6.2.3-r0 do_package_write_ipk - 1m0s (pid 527980)
3: qtmultimedia-6.2.3-r0 do_package_write_ipk - 30s (pid 529522)
</code></pre>

<p>Even more tasks, <a href="https://en.wikipedia.org/wiki/It&#x27;s_Over_9000!">It&#39;s Over 9000!</a>. </p>

<p>As stated in the intro, I had issues compiling Qt WebEngine, which were solved
by using less concurrent cores. For Qt 5.15.2 there were more issues, but those
fixes are down below on this page. When everything is built continue on to the 
next paragraph which goes into flashing the image.</p>

<h3 id="toc_3">Flashing the Yocto Image</h3>

<p>Once the Yocto build is complete, you should have an image file which you can
flash to an SD card to boot the Raspberry Pi. Yocto generates many more
files, packages for each individual piece of software, support files like
device trees and a few other files, at the moment we&#39;re only interested in
the image file.</p>

<p>The two different <code>boot2qt</code> versions (Qt 5 and Qt 6) build a different image
file. Qt 5 has an image which you can just <code>dd</code> to an SD card and boot, Qt 6
has a <code>bmap</code> file. <code>bmap</code> is a special format which should be faster to flash
and verifies data during flash, initially created by Intel for their Tizen
project. </p>

<p>For Qt 5 you get the following, in the
<code>b2qt/build-raspberrypi4/tmp/deploy/images/raspberrypi4</code> folder:</p>

<pre><code>ls -larSh tmp/deploy/images/raspberrypi4/ # ls sorted by size
</code></pre>

<p>Output:</p>

<pre><code>-rw-r--r-- 2 remy remy  40K Feb 15 15:22 bcm2711-rpi-4-b-1-4.19.93+git0+3fdcc814c5-r0-raspberrypi4-20220215123308.dtb
drwxr-xr-x 3 remy remy  52K Feb 17 06:14 .
-rw-r--r-- 1 remy remy 193K Feb 17 06:09 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.rootfs.manifest
-rw-r--r-- 1 remy remy 335K Feb 17 06:09 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.testdata.json
-rw-r--r-- 2 remy remy 5.7M Feb 15 15:21 zImage-1-4.19.93+git0+3fdcc814c5-r0-raspberrypi4-20220215123308.bin
-rw-rw-r-- 2 remy remy  19M Feb 15 15:22 modules-1-4.19.93+git0+3fdcc814c5-r0-raspberrypi4-20220215123308.tgz
-rw-r--r-- 1 remy remy 322M Feb 17 06:13 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.7z
-rw-r--r-- 1 remy remy 488M Feb 17 06:10 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.rootfs.tar.bz2
-rw-r--r-- 1 remy remy 1.7G Feb 17 06:10 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.rootfs.ext3
-rw-r--r-- 1 remy remy 1.8G Feb 17 06:10 b2qt-embedded-qt5-image-raspberrypi4-20220217055709.rootfs.rpi-sdimg
</code></pre>

<p>The last file, the <code>*-sdimg</code> file, can be flashed to your SD card using <code>dd</code>:</p>

<pre><code>dd if=b2qt-embedded-qt5-image-raspberrypi4-20220217055709.rootfs.rpi-sdimg of=/dev/sdX bs=4M conv=fsync 
</code></pre>

<p>I&#39;m using an external SD card reader, if you have a builtin reader you should
probably use <code>of=/dev/mmcblk0</code> as output device, not <code>/dev/sdX</code>. Do note that
the image file has a date, and you should replace the filename in my example
by your build output filename.</p>

<p>For Qt 6 you have a <code>bmap</code> image file file:</p>

<pre><code>-rw-r--r-- 2 remy remy  29K Feb 15 18:03 bcm2710-rpi-3-b-plus-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.dtb
-rw-r--r-- 2 remy remy  35K Feb 15 18:03 sx150x-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.dtbo
-rw-r--r-- 2 remy remy  49K Feb 15 18:03 bcm2711-rpi-400-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.dtb
-rw-r--r-- 2 remy remy  49K Feb 15 18:03 bcm2711-rpi-4-b-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.dtb
-rw-r--r-- 2 remy remy  49K Feb 15 18:03 bcm2711-rpi-cm4-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.dtb
drwxr-xr-x 3 remy remy  60K Feb 16 22:57 .
-rw-r--r-- 1 remy remy 216K Feb 16 22:53 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.rootfs.manifest
-rw-r--r-- 1 remy remy 346K Feb 16 22:53 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.testdata.json
-rw-r--r-- 2 remy remy 7.1M Feb 15 18:03 zImage-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.bin
-rw-r--r-- 2 remy remy  19M Feb 15 18:03 modules-1-5.10.31+git0+a19886b00e_89399e6e7e-r0-raspberrypi4-20220215145419.tgz
-rw-r--r-- 1 remy remy 374M Feb 16 22:57 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.7z
-rw-r--r-- 1 remy remy 374M Feb 16 22:57 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.rootfs.wic.xz
-rw-r--r-- 1 remy remy 579M Feb 16 22:53 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.rootfs.tar.bz2
-rw-r--r-- 1 remy remy 596M Feb 16 22:54 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.rootfs.wic.bz2
-rw-r--r-- 1 remy remy 2.0G Feb 16 22:54 b2qt-embedded-qt6-image-raspberrypi4-20220216200033.rootfs.ext3
</code></pre>

<p>If you run Ubuntu, you must install the <code>bmap-tools</code> package and use the
following command to flash the image to the SD card:</p>

<pre><code>$ sudo bmaptool copy b2qt-embedded-qt6-image-raspberrypi4.wic.bz2 --bmap b2qt-embedded-qt6-image-raspberrypi4.wic.bmap /dev/sda
bmaptool: info: block map format version 2.0
bmaptool: info: 687923 blocks of size 4096 (2.6 GiB), mapped 374929 blocks (1.4 GiB or 54.5%)
bmaptool: info: copying image &#39;b2qt-embedded-qt6-image-raspberrypi4.wic.bz2&#39; to block device &#39;/dev/sda&#39; using bmap file &#39;b2qt-embedded-qt6-image-raspberrypi4.wic.bmap&#39;
</code></pre>

<p>If you don&#39;t have the <code>bmap</code> package, just extract the <code>*.rootfs.wic.bz2</code> file
and use <code>dd</code> to write it to your SD card. Takes a bit longer and lacks
validation of written data, but works just as well.</p>

<p>Once written to the SD card, pop it into your Raspberry Pi and boot. After a
short bootup sequence, you should be greeted with a nice Boot 2 Qt screen. </p>

<p>In the case of Qt 6 the IP address is printed on screen. You can SSH to that
IP with the username <code>root</code> and no password. If all went well, you should be
greeted with a shell prompt. If so, continue on with the Qt Creator
integration. In the case of Qt 5, you can run a few demo applications right
away.</p>

<h3 id="toc_4">Qt Creator integration</h3>

<p>One big advantage of <code>boot2qt</code> is the integration with the other Qt tooling,
like the IDE Qt Creator. </p>

<p>Qt Creator has the concept of Kits, which basically is a compiler
configuration. You can have multiple versions of Qt or GCC (or CLANG)
installed, and within a kit you tell Qt Creator which specific versions to
use. I have specific kits for Qt 5.15, both Android and desktop linux and for
Qt 6.2. I also have a cross-compiler kit installed, that allows me to compile
for the Raspberry Pi from my x86 desktop. </p>

<p>Yocto can build a native SDK, which has all the required compile tools for your
specific environment. <code>boot2qt</code> extends this, it also includes the entire Qt
stack in the cross compile SDK and a few helper scripts. </p>

<p>The steps to integrate your device into Qt Creator are:</p>

<ul>
<li>Build the Cross-compile SDK</li>
<li>Install the cross-compile SDK</li>
<li>Add the SDK as a kit to Qt Creator</li>
<li>Clone that kit and set it up correctly</li>
<li>Add a remote device (your Pi)</li>
<li>Update the kit to deploy to the device</li>
<li>Add the kit to your project</li>
</ul>

<p>Lots of moving parts, but once you have it all setup and running,
it&#39;s a breeze. Qt creator cross-compiles your app and copies it 
directly to your device, no manual tasks.</p>

<h4 id="toc_5">Building the cross-compile SDK</h4>

<p>You must build the SDK before you can use it, it&#39;s not automatically built
when you build the boot image. Make sure you&#39;re in the <code>b2qt</code> folder and have
setup the environment:</p>

<pre><code>export MACHINE=raspberrypi4 &amp;&amp; source ./setup-environment.sh 
</code></pre>

<p>Execute the bitbake command to build the SDK:</p>

<pre><code>bitbake meta-toolchain-b2qt-embedded-qt6-sdk
</code></pre>

<p>The build can take a few hours, depending on your host machine&#39;s
specifications. Not as long as building the entire image, but still quite a
while. The output looks a lot like the earlier output you saw when building
the image:  </p>

<pre><code>remy@host:~/b2qt/build-raspberrypi4$ bitbake meta-toolchain-b2qt-embedded-qt6-sdk
WARNING: Host distribution &quot;debian-11&quot; has not been validated with this version of the build system; you may possibly experience unexpected failures. It is recommended that you use a tested distribution.
Loading cache: 100% |#################################################################################################| Time: 0:00:00
Loaded 4368 entries from dependency cache.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION           = &quot;1.50.0&quot;
BUILD_SYS            = &quot;x86_64-linux&quot;
NATIVELSBSTRING      = &quot;universal&quot;
TARGET_SYS           = &quot;arm-poky-linux-gnueabi&quot;
MACHINE              = &quot;raspberrypi4&quot;
DISTRO               = &quot;b2qt&quot;
DISTRO_VERSION       = &quot;3.3.4&quot;
TUNE_FEATURES        = &quot;arm vfp cortexa7 neon vfpv4 thumb callconvention-hard&quot;
TARGET_FPU           = &quot;hard&quot;
SDKMACHINE           = &quot;x86_64&quot;
meta                 
meta-poky            = &quot;HEAD:c40ac16d79026169639f47be76a3f7b9d8b5178e&quot;
meta-raspberrypi     = &quot;HEAD:b4ec97e4eb8e36efd1f7e2f8ae020a9e55cfc239&quot;
meta-oe              
meta-python          
meta-networking      
meta-initramfs       
meta-multimedia      = &quot;HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d&quot;
meta-python2         = &quot;HEAD:810d6d842f103eb59f18b06426106462b15de7e2&quot;
meta-boot2qt         
meta-boot2qt-distro  = &quot;HEAD:e59a2e20697e0afc2a0b068835cd90e102dec589&quot;
meta-mingw           = &quot;HEAD:422b96cb2b6116442be1f40dfb5bd77447d1219e&quot;
meta-qt6             = &quot;HEAD:eb3719266fc03b96d5056980b135b371f31811f4&quot;
meta-raymii          = &quot;master:0789f30e221712462748cf56b9afddeec3613be1&quot;


Initialising tasks: 100% |############################################################################################| Time: 0:00:10
Sstate summary: Wanted 1340 Local 292 Network 0 Missed 1048 Current 2252 (21% match, 70% complete)
NOTE: Executing Tasks
NOTE: Tasks Summary: Attempted 10059 tasks of which 7511 didn&#39;t need to be rerun and all succeeded.
NOTE: Build completion summary:
NOTE:   do_populate_sysroot: 0.0% sstate reuse(0 setscene, 146 scratch)
NOTE:   do_deploy_source_date_epoch: 0.0% sstate reuse(0 setscene, 146 scratch)
NOTE:   do_package_qa: 0.0% sstate reuse(0 setscene, 150 scratch)
NOTE:   do_package: 0.0% sstate reuse(0 setscene, 150 scratch)
NOTE:   do_packagedata: 0.0% sstate reuse(0 setscene, 150 scratch)
NOTE:   do_package_write_ipk: 2.0% sstate reuse(3 setscene, 150 scratch)
NOTE:   do_populate_lic: 0.0% sstate reuse(0 setscene, 154 scratch)
</code></pre>

<p>Once the build is finished, you have an installable shell script in the <code>tmp/deploy/sdk</code> folder:</p>

<pre><code>remy@host:~/b2qt/build-raspberrypi4$ ls tmp/deploy/sdk/ -larSh
total 1.6G
-rw-r--r-- 1 remy remy    0 Feb 18 15:43 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.host.manifest
-rw-r--r-- 1 remy remy  90K Feb 18 15:42 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.target.manifest
-rw-r--r-- 1 remy remy 324K Feb 18 15:42 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.testdata.json
-rwxr-xr-x 1 remy remy 1.6G Feb 18 15:58 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.sh
</code></pre>

<p>You can execute the <code>b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.sh</code> file to install the 
SDK on your local machine:</p>

<pre><code>$ ./b2qt-x86_64-meta-toolchain-b2qt-embedded-qt6-sdk-raspberrypi4.sh 
Boot to Qt for Embedded Linux SDK installer version 3.3.4
=========================================================
Enter target directory for SDK (default: /opt/b2qt/3.3.4): 
You are about to install the SDK to &quot;/opt/b2qt/3.3.4&quot;. Proceed [Y/n]? y
[sudo] password for remy: 
Extracting SDK...
done
Setting it up...done
SDK has been successfully set up and is ready to be used.
Each time you wish to use the SDK in a new shell session, you need to source the environment setup script e.g.
 $ . /opt/b2qt/3.3.4/environment-setup-cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi
</code></pre>

<p>The build command for Qt 5 is:</p>

<pre><code>bitbake meta-toolchain-b2qt-embedded-qt5-sdk
</code></pre>

<p>Output is almost identical, and once that build is done you have the installer in the same folder, <code>tmp/deploy/sdk</code>:</p>

<pre><code>remy@host:~/b2qt/build-raspberrypi4$ ls -larSh tmp/deploy/sdk/
total 1.7G
-rw-r--r-- 1 remy remy  59K Feb 19 22:25 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt5-sdk-raspberrypi4.host.manifest
-rw-r--r-- 1 remy remy 199K Feb 19 22:24 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt5-sdk-raspberrypi4.target.manifest
-rw-r--r-- 1 remy remy 303K Feb 19 22:24 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt5-sdk-raspberrypi4.testdata.json
-rwxr-xr-x 1 remy remy 1.7G Feb 19 22:47 b2qt-x86_64-meta-toolchain-b2qt-embedded-qt5-sdk-raspberrypi4.sh
</code></pre>

<p>This script can installed just as the Qt 6 one, no workarounds or issues there:</p>

<pre><code>$ ./b2qt-x86_64-meta-toolchain-b2qt-embedded-qt5-sdk-raspberrypi4.sh 
Boot to Qt for Embedded Linux SDK installer version 3.0.4
=========================================================
Enter target directory for SDK (default: /opt/b2qt/3.0.4): 
You are about to install the SDK to &quot;/opt/b2qt/3.0.4&quot;. Proceed [Y/n]? Y
[sudo] password for remy: 
Extracting SDK...done
Setting it up...done
SDK has been successfully set up and is ready to be used.
Each time you wish to use the SDK in a new shell session, you need to source the environment setup script e.g.
 $ . /opt/b2qt/3.0.4/environment-setup-cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi
</code></pre>

<h4 id="toc_6">Adding the kit in Qt Creator</h4>

<p>Configuring kit&#39;s in Qt creator is a tedious process, but <code>boot2qt</code> provides
a script to make this part a bit easier as well. Once you have the native
SDK installed, you can use the <code>configure-qtcreator.sh</code> script to have a 
kit added. Close Qt Creator first, then execute script:</p>

<pre><code>/opt/b2qt/3.3.4/configure-qtcreator.sh --config /opt/b2qt/3.3.4/environment-setup-cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi --qtcreator /mnt/DATADISK/qt2021/Tools/QtCreator/ --name qt6-pi4-template
</code></pre>

<ul>
<li><code>--config</code>: points to the file that the SDK installer tells you to source.</li>
<li><code>--qtcreator</code>: points to the folder QtCreator is installed in. I have it on an extra disk, my path is different</li>
<li><code>--name</code>: the name of the kit</li>
</ul>

<p>You cannot edit this kit later on, therefore I added <code>-template</code> to the name. We can make changes, but
the kit must be cloned first.</p>

<p>Output:     </p>

<pre><code>Configured Qt Creator with new kit: qt6-pi4-template
</code></pre>

<p>Fire up Qt Creator, navigate to <code>Preferences</code>, then <code>Kits</code>. You should see
the new kit, click the <code>Clone</code> button:</p>

<p><img src="/s/inc/img/boot2qt-5.png" alt="qt creator"></p>

<p>The most important setting to change is the <code>Qt Version</code>. Not sure
why it didn&#39;t detect it, but for me it stated <code>None</code>. Select the
correct Qt version in the drop down. If you&#39;re unsure which one to
use, switch to the <code>Qt Versions</code> tab and check which one you need. 
Here&#39;s a picture of the settings I have:</p>

<p><img src="/s/inc/img/boot2qt-6.png" alt="qt versions"></p>

<p>You can now configure this kit for your own project, but before
we do that, add your Pi (running the <code>boot2qt</code> image) as a remote
device to deploy to.</p>

<h4 id="toc_7">Adding a remote device</h4>

<p>Also in settings, under <code>Devices</code>. Click the <code>Add</code> button. Add a <code>Generic
Linux Device</code> with the following settings, but replace the IP with your
board&#39;s IP:</p>

<p><img src="/s/inc/img/boot2qt-4.png" alt="device"></p>

<p>The <code>boot2qt</code> image&#39;s username is <code>root</code> and there is no password. You can
deploy a public key, but that is not required. Once your device is added,
use the Test button to make sure everything works. </p>

<p>Go back to the Kit settings and select this device under the <code>Device</code>
drop down.</p>

<p>After adding the device to the kit you can configure the kit for your project.
Open up your project and click the <code>Project</code> button in the left-hand menu.
Add the new kit by clicking it, then building your project. The compile
output should show the path to the Yocto SDK instead of your regular
compiler:</p>

<pre><code>15:09:01: Starting: &quot;/opt/b2qt/3.3.4/sysroots/x86_64-pokysdk-linux/usr/bin/make&quot; -j12
/opt/b2qt/3.3.4/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-g++ -mthumb -mfpu=neon-vfpv4 -mfloat-abi=hard -mcpu=cortex-a7 --sysroot=/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi -c -pipe -g -std=gnu++1z -Wall -Wextra -D_REENTRANT -fPIC -DQT_QML_DEBUG -DQT_QUICK_LIB -DQT_OPENGL_LIB -DQT_GUI_LIB -DQT_QMLMODELS_LIB -DQT_QML_LIB -DQT_NETWORK_LIB -DQT_CORE_LIB -I../dragdropexample -I. -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtQuick -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtOpenGL -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtGui -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtQmlModels -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtQml -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtNetwork -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/include/QtCore -I. -I/opt/b2qt/3.3.4/sysroots/cortexa7t2hf-neon-vfpv4-poky-linux-gnueabi/usr/lib/mkspecs/linux-oe-g++ -o main.o ../dragdropexample/main.cpp
</code></pre>

<h4 id="toc_8">One click deploy</h4>

<p>The Qt documentation lists one of the options under the 
<code>Run</code> step of the kit as <code>Change Default App</code>, but I don&#39;t
have that option, probably because I did not install the
<code>qbsp</code> package. However, not a big problem, since we
can just tell Qt Creator the correct command by hand.</p>

<p>Under the <code>Run</code> settings, check the <code>Alternate executable on device</code>
and change the path to <code>/usr/bin/appcontroller</code>. Add 
the full path of your app to the <code>Command Line Arguments</code> textfield,
like in the image below. The full path to your app is listed in 
the same settings dialog:</p>

<p><img src="/s/inc/img/boot2qt-7.png" alt="deploy"></p>

<p>Next time you deploy, it will kill any running instances of <code>appcontroller</code>
and start it with your application as command line argument,
effectively deploying your app to the device.</p>

<h3 id="toc_9">Changing the default boot2qt startup application in Yocto</h3>

<p>You can change the default app that boots up once your system is
running with the following command:</p>

<pre><code>appcontroller --make-default /path/to/your/app
</code></pre>

<p>What that does is not much more than <a href="https://web.archive.org/web/20220221152205/https://code.qt.io/cgit/qt-apps/boot2qt-appcontroller.git/tree/main.cpp#n303">make a symlink</a> to
<code>/usr/bin/b2qt</code>.</p>

<p>However, you might want to bake your app into the image. This is 
a quick short section to make your own layer and recipe and to include
that recipe in the image by extending the Qt image. We&#39;ll do so by
making a recipe that places your binary on the filesystem and symlinks
it, as well as extending the default image.</p>

<p>If you do plan to ship production images via this guide, remember that
this is a development image, SSH is wide open and there is a lot left
in the image to setup correctly. Please do dive in to Yocto a bit more
for more on that.</p>

<p>Start by making a few folders for your layer, in the <code>b2qt</code> folder:</p>

<pre><code>mkdir -p sources/meta-raymii/recipes-myapp/myapp/files/
mkdir -p sources/meta-raymii/conf/
mkdir -p sources/meta-raymii/recipes-qt/images/
</code></pre>

<p>Edit the following file:</p>

<pre><code>sources/meta-raymii/conf/layer.conf
</code></pre>

<p>Place the below contents:</p>

<pre><code>BBPATH .= &quot;:${LAYERDIR}&quot;

BBFILES += &quot;${LAYERDIR}/recipes*/*/*.bb \
            ${LAYERDIR}/recipes*/*/*.bbappend \
            &quot;
BBFILE_COLLECTIONS += &quot;raymii&quot;
BBFILE_PATTERN_raymii := &quot;^${LAYERDIR}/&quot;
BBFILE_PRIORITY_raymii = &quot;1&quot;

LAYERSERIES_COMPAT_raymii = &quot;thud zeus dunfell gatesgarth hardknott&quot;
</code></pre>

<p>Next, edit the following file, which is your app&#39;s recipe:</p>

<pre><code>sources/meta-raymii/recipes-myapp/myapp/myapp_1.0.bb
</code></pre>

<p>The filename format (<code>myapp</code> <code>underscore</code> <code>versionMajor.versionMinor</code>) is important.
Don&#39;t mix up the <code>underscore</code> for a <code>dash</code>. A newer version of your app could be
named <code>myapp_1.1.bb</code>, or you could up the <code>PR=&quot;r0&quot;</code> for a minor release.</p>

<p>Contents:   </p>

<pre><code>DESCRIPTION = &quot;My Custom Qt App&quot;
AUTHOR = &quot;boot2qt-guide@raymii.org&quot;
LICENSE = &quot;CLOSED&quot;
PR = &quot;r0&quot;

SRC_URI =+ &quot;file://myapp \
           &quot;

DEPENDS += &quot;qtbase qtdeclarative qtdeclarative-native&quot;

do_install() {
    install -d ${D}/${bindir}
    install -m 0755 ${WORKDIR}/myapp ${D}/${bindir}/myapp

    lnr ${D}/${bindir}/myapp ${D}/${bindir}/b2qt
}

FILES_${PN} = &quot;${bindir}/myapp \
               ${bindir}/b2qt \
              &quot;
</code></pre>

<p>This recipe will copy your app to the correct place with the correct permissions
and it makes a symlink (<code>lnr</code>) to <code>/usr/bin/b2qt</code>. The <code>DEPENDS</code> line makes sure the relevant
Qt pieces are installed. With <code>boot2qt</code> that&#39;s the case, but if you omit that line,
you&#39;ll get a build error because Yocto is intelligent enough to scan your program
executable.</p>

<p>Make sure the cross-compiled version of your program in the <code>files</code> folder:</p>

<pre><code>remy@host:~/b2qt$ file sources/meta-raymii/recipes-myapp/myapp/files/myapp
sources/meta-raymii/recipes-myapp/myapp/files/myapp: ELF 32-bit LSB
pie executable, ARM, EABI5 version 1 (SYSV), dynamically linked,
interpreter /lib/ld-linux-armhf.so.3, for GNU/Linux 3.2.0, BuildID
[sha1]=f313bc93bfc28c7a8af0eb046c0270ab55378502, with debug_info, not
stripped
</code></pre>

<p>Add the layer to the Yocto build config:</p>

<pre><code>build-raspberrypi4/conf/bblayers.conf
</code></pre>

<p>At the bottom, don&#39;t forget the trailing slash (<code>\</code>):</p>

<pre><code>BBLAYERS ?= &quot; \
  ${BSPDIR}/sources/poky/meta \
    [...]
  ${BSPDIR}/sources/meta-qt6 \
  ${BSPDIR}/sources/meta-raymii \
  &quot;
</code></pre>

<p>The following file is a <code>.bbappend</code> file, which, if it has the same name, path 
and version, will, as you might expect, append stuff to the original. In this
case, we will extend the default <code>b2qt-embedded-qt6-image</code> image to include 
our <code>myapp</code> recipe in the installation. This is the same for Qt 5, just change
the filename accordingly. Edit this file</p>

<pre><code>sources/meta-raymii/recipes-qt/images/b2qt-embedded-qt6-image.bbappend
</code></pre>

<p>Contents:</p>

<pre><code>SUMMARY = &quot;Add myapp to Qt image&quot;
IMAGE_INSTALL_prepend := &quot;myapp&quot;
</code></pre>

<p>Once you&#39;ve did all the above, rebuild the image (<code>bitbake b2qt-embedded-qt6-image</code>) 
and flash it to your SD card. Once booted up, instead of the default, your own 
program will now start up. </p>

<p>If you want to make sure you&#39;re on the correct image, you can check the file 
<code>/etc/build</code> once logged in via SSH to see the layers and git commits used
to build the image:</p>

<pre><code>root@b2qt-raspberrypi4:~# cat /etc/build 
-----------------------
Build Configuration:  |
-----------------------
DISTRO = b2qt
DISTRO_VERSION = 3.3.4
QT_VERSION = 6.2.3
-----------------------
Layer Revisions:      |
-----------------------
meta              = HEAD:c40ac16d79026169639f47be76a3f7b9d8b5178e -- modified
meta-poky         = HEAD:c40ac16d79026169639f47be76a3f7b9d8b5178e -- modified
meta-raspberrypi  = HEAD:b4ec97e4eb8e36efd1f7e2f8ae020a9e55cfc239 
meta-oe           = HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d 
meta-python       = HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d 
meta-networking   = HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d 
meta-initramfs    = HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d 
meta-multimedia   = HEAD:f72a73b42fa740130b388ba8555cdbefdee8d37d 
meta-python2      = HEAD:810d6d842f103eb59f18b06426106462b15de7e2 
meta-boot2qt      = HEAD:e59a2e20697e0afc2a0b068835cd90e102dec589 
meta-boot2qt-distro = HEAD:e59a2e20697e0afc2a0b068835cd90e102dec589 
meta-mingw        = HEAD:422b96cb2b6116442be1f40dfb5bd77447d1219e 
meta-qt6          = HEAD:eb3719266fc03b96d5056980b135b371f31811f4 
meta-raymii       = master:0789f30e221712462748cf56b9afddeec3613be1 -- modified
</code></pre>

<p>The <code>image-buildinfo</code> class writes information to the target filesystem and the Qt image
has this class enabled by default. The image inherits <code>meta-boot2qt/classes/deploy-buildinfo.bbclass</code>
which inherits <code>image-buildinfo</code> and extends it with some Qt version information.</p>

<h3 id="toc_10">Qt 5.15.2 issues</h3>

<p>A few issues popped up when building boot2qt for 5.15.2. Upstream git repositories changes 
their <a href="https://web.archive.org/web/20220219194958/https://bugreports.qt.io/browse/QTBUG-91791">branch name</a>, so for the fonts I had to update a few recipes related to fonts:</p>

<ul>
<li><code>b2qt/sources/meta-boot2qt/meta-boot2qt/recipes-graphics/fonts/otf-noto_git.bb</code></li>
<li><code>b2qt/sources/meta-boot2qt/meta-boot2qt/recipes-graphics/fonts/ttf-opensans_git.bb</code></li>
</ul>

<p>Change the following:</p>

<pre><code>SRC_URI = &quot;git://github.com/googlei18n/noto-cjk.git&quot;
</code></pre>

<p>Add <code>;branch=main</code> to the end:</p>

<pre><code>SRC_URI = &quot;git://github.com/googlei18n/noto-cjk.git;branch=main&quot;
</code></pre>

<p>Rinse and repeat for any other font recipes that complain.</p>

<hr>

<p>My Raspberry Pi 4b 8 GB failed to boot with this image, the
bootloader complaining with the following error:</p>

<pre><code>start4x.elf is not compatible
This board requires newer software
</code></pre>

<p><a href="/s/inc/img/boot2qt-2.png"><img src="/s/inc/img/boot2qt-2.png" width=400 height=250 /></a></p>

<p>I&#39;m not sure if this is specific to the 8 GB version, I only have one 
Raspberry Pi 4, so I can&#39;t test it on a 4 GB model. Try flashing the image
first, and only update the following recipes if you experience the same issue.</p>

<p>There are two recipes you need to update to get a newer firmware file. In the 
earlier yocto layer example to change the default app I used overrides, but 
in this case I&#39;m brute-forcing my way to a fix, my overriding other recipes.
Not the prettiest way, but it works.</p>

<p>Update the following file:</p>

<pre><code>b2qt/sources/meta-raspberrypi/recipes-bsp/common/raspberrypi-firmware.inc
</code></pre>

<p>Remove all existing content and paste in the following:</p>

<pre><code>RPIFW_DATE ?= &quot;20210421&quot;
SRCREV ?= &quot;2ac4de4eaac5c1d1b25acec4a5e0a9fdb16f0c91&quot;
RPIFW_SRC_URI ?= &quot;https://github.com/raspberrypi/firmware/archive/${SRCREV}.tar.gz;downloadfilename=raspberrypi-firmware-${SRCREV}.tar.gz&quot;
RPIFW_S ?= &quot;${WORKDIR}/firmware-${SRCREV}&quot;

SRC_URI = &quot;${RPIFW_SRC_URI}&quot;
SRC_URI[sha256sum] = &quot;c687aa1b5127a8dc0773e8aefb1f009f24bf71ccb4c9e8b40a1d46cbbb7bee0c&quot;

PV = &quot;${RPIFW_DATE}&quot;
</code></pre>

<p>Update the following file:</p>

<pre><code>b2qt/sources/meta-raspberrypi/recipes-kernel/linux-firmware-rpidistro/linux-firmware-rpidistro_git.bb
</code></pre>

<p>Remove all existing content and paste in the following:</p>

<pre><code>SUMMARY = &quot;Linux kernel firmware files from Raspbian distribution&quot;
DESCRIPTION = &quot;Updated firmware files for RaspberryPi hardware. \
RPi-Distro obtains these directly from Cypress; they are not submitted \
to linux-firmware for general use.&quot;
HOMEPAGE = &quot;https://github.com/RPi-Distro/firmware-nonfree&quot;
SECTION = &quot;kernel&quot;

# In maintained upstream linux-firmware:
# * brcmfmac43430-sdio falls under LICENSE.cypress
# * brcmfmac43455-sdio falls under LICENSE.broadcom_bcm43xx
# * brcmfmac43456-sdio falls under LICENSE.broadcom_bcm43xx
#
# It is likely[^1] that both of these should be under LICENSE.cypress.
# Further, at this time the text of LICENSE.broadcom_bcm43xx is the same
# in linux-firmware and RPi-Distro/firmware-nonfree, but this may
# change.
#
# Rather than make assumptions about what&#39;s supposed to be what, we&#39;ll
# use the license implied by the source of these files, named to avoid
# conflicts with linux-firmware.
#
# [^1]: https://github.com/RPi-Distro/bluez-firmware/issues/1
LICENSE = &quot;\
    Firmware-broadcom_bcm43xx-rpidistro \
&quot;
LIC_FILES_CHKSUM = &quot;\
    file://debian/config/brcm80211/LICENSE;md5=8cba1397cda6386db37210439a0da3eb \
&quot;

# These are not common licenses, set NO_GENERIC_LICENSE for them
# so that the license files will be copied from fetched source
NO_GENERIC_LICENSE[Firmware-broadcom_bcm43xx-rpidistro] = &quot;debian/config/brcm80211/LICENSE&quot;

SRC_URI = &quot;git://github.com/RPi-Distro/firmware-nonfree;branch=bullseye;protocol=https&quot;

SRCREV = &quot;b3eec612566ca08913f0830d299f4df70297428f&quot;
PV = &quot;20210315-3+rpt4&quot;

S = &quot;${WORKDIR}/git&quot;

inherit allarch

CLEANBROKEN = &quot;1&quot;

do_compile() {
    :
}

do_install() {
    install -d ${D}${nonarch_base_libdir}/firmware/brcm ${D}${nonarch_base_libdir}/firmware/cypress

    cp debian/config/brcm80211/LICENSE ${D}${nonarch_base_libdir}/firmware/LICENSE.broadcom_bcm43xx-rpidistro

    # Replace outdated linux-firmware files with updated ones from
    # raspbian firmware-nonfree. Raspbian adds blobs and nvram
    # definitions that are also necessary so copy those too.
    for fw in brcmfmac43430-sdio brcmfmac43436-sdio brcmfmac43436s-sdio brcmfmac43455-sdio brcmfmac43456-sdio ; do
        cp -R --no-dereference --preserve=mode,links -v debian/config/brcm80211/brcm/${fw}.* ${D}${nonarch_base_libdir}/firmware/brcm/
    done
    cp -R --no-dereference --preserve=mode,links -v debian/config/brcm80211/cypress/* ${D}${nonarch_base_libdir}/firmware/cypress/
    # add compat links. Fixes errors like
    # brcmfmac mmc1:0001:1: Direct firmware load for brcm/brcmfmac43455-sdio.raspberrypi,4-model-compute-module.txt failed with error -2
    ln -s brcmfmac43455-sdio.txt ${D}${nonarch_base_libdir}/firmware/brcm/brcmfmac43455-sdio.raspberrypi,4-compute-module.txt
}

PACKAGES = &quot;\
    ${PN}-broadcom-license \
    ${PN}-bcm43430 \
    ${PN}-bcm43455 \
    ${PN}-bcm43456 \
    ${PN}-bcm43436 \
    ${PN}-bcm43436s \
&quot;

LICENSE_${PN}-bcm43430 = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
LICENSE_${PN}-bcm43436 = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
LICENSE_${PN}-bcm43436s = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
LICENSE_${PN}-bcm43455 = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
LICENSE_${PN}-bcm43456 = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
LICENSE_${PN}-broadcom-license = &quot;Firmware-broadcom_bcm43xx-rpidistro&quot;
FILES_${PN}-broadcom-license = &quot;${nonarch_base_libdir}/firmware/LICENSE.broadcom_bcm43xx-rpidistro&quot;
FILES_${PN}-bcm43430 = &quot;${nonarch_base_libdir}/firmware/brcm/brcmfmac43430* ${nonarch_base_libdir}/firmware/cypress/cyfmac43430-sdio.bin&quot;
FILES_${PN}-bcm43436 = &quot;${nonarch_base_libdir}/firmware/brcm/brcmfmac43436-*&quot;
FILES_${PN}-bcm43436s = &quot;${nonarch_base_libdir}/firmware/brcm/brcmfmac43436s*&quot;
FILES_${PN}-bcm43455 = &quot;${nonarch_base_libdir}/firmware/brcm/brcmfmac43455* ${nonarch_base_libdir}/firmware/cypress/cyfmac43455-sdio.*&quot;
FILES_${PN}-bcm43456 = &quot;${nonarch_base_libdir}/firmware/brcm/brcmfmac43456*&quot;
RDEPENDS_${PN}-bcm43430 += &quot;${PN}-broadcom-license&quot;
RDEPENDS_${PN}-bcm43436 += &quot;${PN}-broadcom-license&quot;
RDEPENDS_${PN}-bcm43436s += &quot;${PN}-broadcom-license&quot;
RDEPENDS_${PN}-bcm43455 += &quot;${PN}-broadcom-license&quot;
RDEPENDS_${PN}-bcm43456 += &quot;${PN}-broadcom-license&quot;
RCONFLICTS_${PN}-bcm43430 = &quot;\
    linux-firmware-bcm43430 \
    linux-firmware-raspbian-bcm43430 \
&quot;

RREPLACES_${PN}-bcm43430 = &quot;\
    linux-firmware-bcm43430 \
    linux-firmware-raspbian-bcm43430 \
&quot;

RCONFLICTS_${PN}-bcm43436 = &quot;\
    linux-firmware-bcm43436 \
    linux-firmware-raspbian-bcm43436 \
&quot;

RREPLACES_${PN}-bcm43436 = &quot;\
    linux-firmware-bcm43436 \
    linux-firmware-raspbian-bcm43436 \
&quot;

RCONFLICTS_${PN}-bcm43436s = &quot;\
    linux-firmware-bcm43436s \
    linux-firmware-raspbian-bcm43436s \
&quot;

RREPLACES_${PN}-bcm43436s = &quot;\
    linux-firmware-bcm43436s \
    linux-firmware-raspbian-bcm43436s \
&quot;

RCONFLICTS_${PN}-bcm43455 = &quot;\
    linux-firmware-bcm43455 \
    linux-firmware-raspbian-bcm43455 \
&quot;
RREPLACES_${PN}-bcm43455 = &quot;\
    linux-firmware-bcm43455 \
    linux-firmware-raspbian-bcm43455 \
&quot;
RCONFLICTS_${PN}-bcm43456 = &quot;\
    linux-firmware-bcm43456 \
    linux-firmware-raspbian-bcm43456 \
&quot;
RREPLACES_${PN}-bcm43456 = &quot;\
    linux-firmware-bcm43456 \
    linux-firmware-raspbian-bcm43456 \
&quot;

# Firmware files are generally not run on the CPU, so they can be
# allarch despite being architecture specific
INSANE_SKIP = &quot;arch&quot;
</code></pre>

<p>Both recipes come from the latest master branch of the <code>meta-raspberry</code> layer,
but the last file has the colons (<code>:</code>) replaces with underscores (<code>_</code>), due 
to the older yocto version not supporting colons (<code>:</code>).</p>

<p>As stated in the introduction, if you pay for the commercial LTS version of Qt
5.15 these issues are resolved. At work we have that license, but
I <strong>explicitly have not looked at the commercial boot2qt 5.15 source code</strong>,
just applied my general troubleshooting knowledge to fix these errors. The
fonts fix is public on the<a href="https://codereview.qt-project.org/c/yocto/meta-boot2qt/+/338895/2/meta-boot2qt/recipes-graphics/fonts/otf-noto_git.bb#41">qt site</a> and the <code>start4x.elf</code> issue is from
the <code>meta-raspberry</code> layer, not a boot2qt layer. That issue could also be
because I was experimenting with bootloader that supports <a href="https://web.archive.org/web/20220219200056/https://www.jeffgeerling.com/blog/2022/testing-raspberry-pis-new-network-install-feature">network booting</a> as well. </p>
Tags: <a href="../tags/arm.html">arm</a>
, <a href="../tags/boot2qt.html">boot2qt</a>
, <a href="../tags/c++.html">c++</a>
, <a href="../tags/cpp.html">cpp</a>
, <a href="../tags/embedded.html">embedded</a>
, <a href="../tags/hardware.html">hardware</a>
, <a href="../tags/openembedded.html">openembedded</a>
, <a href="../tags/qt.html">qt</a>
, <a href="../tags/qt5.html">qt5</a>
, <a href="../tags/qt6.html">qt6</a>
, <a href="../tags/raspberry-pi.html">raspberry-pi</a>
, <a href="../tags/tutorials.html">tutorials</a>
, <a href="../tags/yocto.html">yocto</a>
</div></main>
<br/>
<footer>
<br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small>
                </p>
    
    </footer>
    <script data-goatcounter="https://raymii.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

    <script defer src="/s/inc/js/instant.5.2.0.js"  type="module" ></script>

     
    </main>
    </body>
    </html>
    