
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>QML Drag and Drop including reordering the C++ model - Raymii.org</title>
        <style> *, ::before, ::after {background-repeat: no-repeat;-webkit-box-sizing: border-box;box-sizing: border-box;}::before, ::after {text-decoration: inherit;vertical-align: inherit;}html {cursor: default;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";line-height: 1.15;-moz-tab-size: 4;-o-tab-size: 4;tab-size: 4;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;}body {background-color: white;margin: 0;}h1 {font-size: 2em;margin: 0.67em 0;}hr {height: 0;overflow: visible;}main {display: block;}nav ol, nav ul {list-style: none;}pre {font-family: Roboto Mono, Menlo, Consolas, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}a {background-color: transparent;}abbr[title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;}b, strong {font-weight: bolder;}code, kbd, samp {font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}small {font-size: 80%;}::-moz-selection {background-color: #b3d4fc;color: #000;text-shadow: none;}::selection {background-color: #b3d4fc;color: #000;text-shadow: none;}audio, canvas, iframe, img, svg, video {vertical-align: middle;}audio, video {display: inline-block;}audio:not([controls]) {display: none;height: 0;}img {border-style: none;}svg:not([fill]) {fill: currentColor;}svg:not(:root) {overflow: hidden;}table {border-collapse: collapse;}button, input, select, textarea {font-family: inherit;font-size: inherit;line-height: inherit;}button, input, select {margin: 0;}button {overflow: visible;text-transform: none;}button, [type="button"], [type="reset"], [type="submit"] {-webkit-appearance: button;}fieldset {padding: 0.35em 0.75em 0.625em;}input {overflow: visible;}legend {color: inherit;display: table;max-width: 100%;white-space: normal;}progress {display: inline-block;vertical-align: baseline;}select {text-transform: none;}textarea {margin: 0;overflow: auto;resize: vertical;}[type="checkbox"], [type="radio"] {padding: 0;}[type="search"] {-webkit-appearance: textfield;outline-offset: -2px;}::-webkit-inner-spin-button, ::-webkit-outer-spin-button {height: auto;}::-webkit-input-placeholder {color: inherit;opacity: 0.54;}::-webkit-search-decoration {-webkit-appearance: none;}::-webkit-file-upload-button {-webkit-appearance: button;font: inherit;}::-moz-focus-inner {border-style: none;padding: 0;}:-moz-focusring {outline: 1px dotted ButtonText;}details {display: block;}dialog {background-color: white;border: solid;color: black;display: block;height: -moz-fit-content;height: -webkit-fit-content;height: fit-content;left: 0;margin: auto;padding: 1em;position: absolute;right: 0;width: -moz-fit-content;width: -webkit-fit-content;width: fit-content;}dialog:not([open]) {display: none;}summary {display: list-item;}canvas {display: inline-block;}template {display: none;}a, area, button, input, label, select, summary, textarea, [tabindex] {-ms-touch-action: manipulation;touch-action: manipulation;}[hidden] {display: none;}[aria-busy="true"] {cursor: progress;}[aria-controls] {cursor: pointer;}[aria-disabled="true"], [disabled] {cursor: not-allowed;}[aria-hidden="false"][hidden]:not(:focus) {clip: rect(0, 0, 0, 0);display: inherit;position: absolute;}main, header, footer, article, section, aside, details, summary {margin: 0 auto;margin-bottom: 16px;width: 100%;}main {display: block;margin: 0 auto;max-width: 1000px;padding: 0 16px 16px;}footer {border-top: 1px solid rgba(0, 0, 0, 0.12);padding: 16px 0;text-align: left;}footer p {margin-bottom: 0;}hr {border: 0;border-top: 1px solid rgba(0, 0, 0, 0.12);display: block;margin-top: 16px;margin-bottom: 16px;width: 100%;-webkit-box-sizing: content-box;box-sizing: content-box;height: 0;overflow: visible;}img {height: auto;max-width: 100%;vertical-align: baseline;}@media screen and (max-width: 400px) {article, section, aside {clear: both;display: block;max-width: 100%;}img {margin-right: 16px;}}embed, iframe, video {border: 0;}body {color: rgba(0, 0, 0, 0.8);font-family: "Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 16px;line-height: 1.5;}p {margin: 0;margin-bottom: 16px;}h1, h2, h3, h4, h5, h6 {color: inherit;font-family: inherit;line-height: 1.2;font-weight: 500;}h1 {font-size: 40px;margin: 20px 0 16px;}h2 {font-size: 32px;margin: 20px 0 16px;}h3 {color: #75cc00;font-size: 28px;margin: 16px 0 4px;}h4 {color: #75cc00;font-size: 24px;margin: 16px 0 4px;}h5 {color: #75cc00;font-size: 20px;margin: 16px 0 4px;}h6 {color: #75cc00;font-size: 16px;margin: 16px 0 4px;}small {color: rgba(0, 0, 0, 0.54);vertical-align: bottom;}pre {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);display: block;font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;margin: 16px 0;padding: 16px;white-space: pre-wrap;overflow-wrap: break-word;}code {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;line-height: inherit;margin: 0;vertical-align: baseline;word-break: break-all;word-wrap: break-word;}a {color: #75cc00;text-decoration: none;background-color: transparent;}a:hover, a:focus {color: #0062cc;font-weight: bolder;text-decoration: underline;}dl {margin-bottom: 16px;}dd {margin-left: 40px;}ul, ol {margin-bottom: 8px;padding-left: 40px;vertical-align: baseline;}blockquote {border-left: 2px solid rgba(0, 0, 0, 0.8);font-family: Georgia, Times, "Times New Roman", serif;font-style: italic;margin: 16px 0;padding-left: 16px;}figcaption {font-family: Georgia, Times, "Times New Roman", serif;}u {text-decoration: underline;}s {text-decoration: line-through;}sup {font-size: 14px;vertical-align: super;}sub {font-size: 14px;vertical-align: sub;}mark {background: #ffeb3b;}input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="date"], input[type="month"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="week"], input[type="number"], input[type="search"], input[type="tel"], select, textarea {background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}input[type="color"] {background: #fff;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;display: inline-block;vertical-align: middle;}input:not([type]) {-webkit-appearance: none;background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;text-align: left;}input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="url"]:focus, input[type="date"]:focus, input[type="month"]:focus, input[type="time"]:focus, input[type="datetime"]:focus, input[type="datetime-local"]:focus, input[type="week"]:focus, input[type="number"]:focus, input[type="search"]:focus, input[type="tel"]:focus, input[type="color"]:focus, select:focus, textarea:focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input:not([type]):focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {outline: 1px thin rgba(0, 0, 0, 0.12);}input[type="text"][disabled], input[type="password"][disabled], input[type="email"][disabled], input[type="url"][disabled], input[type="date"][disabled], input[type="month"][disabled], input[type="time"][disabled], input[type="datetime"][disabled], input[type="datetime-local"][disabled], input[type="week"][disabled], input[type="number"][disabled], input[type="search"][disabled], input[type="tel"][disabled], input[type="color"][disabled], select[disabled], textarea[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input:not([type])[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input[readonly], select[readonly], textarea[readonly] {border-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);}input:focus:invalid, textarea:focus:invalid, select:focus:invalid {border-color: #ea1c0d;color: #f44336;}input[type="file"]:focus:invalid:focus, input[type="radio"]:focus:invalid:focus, input[type="checkbox"]:focus:invalid:focus {outline-color: #f44336;}select {border: 1px solid rgba(0, 0, 0, 0.12);vertical-align: sub;}select:not([size]):not([multiple]) {height: -webkit-calc(2.25rem + 2px);height: calc(2.25rem + 2px);}select[multiple] {height: auto;}label {display: inline-block;line-height: 2;}fieldset {border: 0;margin: 0;padding: 8px 0;}legend {border-bottom: 1px solid rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.8);display: block;margin-bottom: 8px;padding: 8px 0;width: 100%;}textarea {overflow: auto;resize: vertical;}input[type=checkbox], input[type=radio] {-webkit-box-sizing: border-box;box-sizing: border-box;padding: 0;display: inline;}input[type=submit], input[type=reset], input[type=button], button {background-color: #75cc00;border: #75cc00;border-radius: 4px;color: #fff;padding: 8px 16px;display: inline-block;font-weight: 400;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid transparent;font-size: 1rem;line-height: 1.5;-webkit-transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;}input[type=submit]::-moz-focus-inner, input[type=reset]::-moz-focus-inner, input[type=button]::-moz-focus-inner, button::-moz-focus-inner {padding: 0;}input[type=submit]:hover, input[type=reset]:hover, input[type=button]:hover, button:hover {background-color: #0069d9;border-color: #0062cc;color: #fff;}input[type=submit]:not(:disabled):active, input[type=reset]:not(:disabled):active, input[type=button]:not(:disabled):active, button:not(:disabled):active {background-color: #0062cc;border-color: #005cbf;color: #fff;}input[type=submit]:focus, input[type=reset]:focus, input[type=button]:focus, button:focus {outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);}input[type=submit]:disabled, input[type=reset]:disabled, input[type=button]:disabled, button:disabled {opacity: .65;cursor: not-allowed;background-color: #75cc00;border-color: #75cc00;color: #fff;}table {border-top: 1px solid rgba(0, 0, 0, 0.12);margin-bottom: 16px;}caption {padding: 8px 0;}thead th {border: 0;border-bottom: 2px solid rgba(0, 0, 0, 0.12);text-align: left;}tr {margin-bottom: 8px;}th, td {border-bottom: 1px solid rgba(0, 0, 0, 0.12);padding: 16px;white-space: nowrap;vertical-align: inherit;}tfoot tr {text-align: left;}tfoot td {color: rgba(0, 0, 0, 0.54);font-size: 8px;font-style: italic;padding: 16px 4px;}a.skip-main {left:-999px;position:absolute;top:auto;width:1px;height:1px;overflow:hidden;z-index:-999;}a.skip-main:focus, a.skip-main:active {color: #fff;background-color:#000;left: auto;top: auto;width: 30%;height: auto;overflow:auto;margin: 10px 35%;padding:5px;border-radius: 15px;border:4px solid yellow;text-align:center;font-size:1.2em;z-index:999;}@font-face {font-family: 'Raleway';font-style: normal;font-weight: 600;src: url('/s/inc/css/raleway-v18-latin-600.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-600.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-600.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-600.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-600.svg#Raleway') format('svg');}@font-face {font-family: 'Raleway';font-style: italic;font-weight: 400;src: url('/s/inc/css/raleway-v18-latin-italic.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-italic.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-italic.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-italic.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-italic.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-italic.svg#Raleway') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 400;src: url('/s/inc/css/roboto-mono-v12-latin-regular.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-regular.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-regular.svg#RobotoMono') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 600;src: url('/s/inc/css/roboto-mono-v12-latin-600.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-600.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-600.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-600.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-600.svg#RobotoMono') format('svg');}@font-face {font-family: 'Ubuntu';font-style: normal;font-weight: 400;src: url('/s/inc/css/ubuntu-v15-latin-regular.eot');src: local(''), url('/s/inc/css/ubuntu-v15-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/ubuntu-v15-latin-regular.woff2') format('woff2'), url('/s/inc/css/ubuntu-v15-latin-regular.woff') format('woff'), url('/s/inc/css/ubuntu-v15-latin-regular.ttf') format('truetype'), url('/s/inc/css/ubuntu-v15-latin-regular.svg#Ubuntu') format('svg');}@font-face {font-family:'Raleway2';font-style:normal;font-weight:normal;src:url('/s/inc/css/raleway.eot');src:local('Raleway2'),local('Raleway2'),url('/s/inc/css/raleway.ttf') }.headheader {font-family:"Raleway2"!important }.headheader a {color:#000;text-decoration:none }.headheader a:hover {color:#000;text-decoration:none!important }#toc ul {list-style: none;margin: 0;padding: 0;}#toc h3 {color:black;}</style>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />         
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="data:image/png;base64,b'iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAYAAAD2Fg1xAAABgElEQVQ4jb3VP0iVYRTH8c9waXBokog7OYhTXChuF3GIi4hoiJA4REQIOTgGtoWTg6ODs0SYComIXCJEMhpKtD9guUU0ujRFS0PQ8DzC24v3Pq+3S9/pnMOP8/7Ocx6el/OziRN0JXTD+I2xhK4WdeNteGmbu8IgC3jQQlfCZ0zgINHzJabwoQP+ClHGV1zGJXwRDJ/FDJZi3MBQE10dL2K8gZFOGE3REDZyyjLunKG7KAzZHfMaXjXp+QbXYlzBfrvmSuhBNaHrxQU8zdQW8RhrOe0snuB7zA/jd6p4n9HV8QMfY/4JPzGAt7meFfS18LdXEk7uemIQuJ/Lj6PZQezFWhm3cTWnXcAj3MrU5oWh5WpzGM3UurGNZy28HSa8J7mB3Uy+4u/rl+UdrsT4Jraa6F6jP5M3MP0PHguzL9zzqmC2GRNYjXF2qDzDwgbgHp53wGMhJrEunGQ9oT3CQ+GFasWBsLVvwiv5XygJz/JOAe208POrJHST+CVspBB/AFY9Q3+QJqLxAAAAAElFTkSuQmCC'" alt="Raymii.org Logo">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> 
                </small><br/><p>
                <link href="/s/_pagefind/pagefind-ui.css" rel="stylesheet">
                <script src="/s/_pagefind/pagefind-ui.js" type="text/javascript"></script>
                <div id="search" style="min-width:400px;max-width:1080px;"></div>
                <script>
                    window.addEventListener('DOMContentLoaded', (event) => {
                        new PagefindUI({ element: "#search" });
                    });
                </script>
                </p>
            </header>
          
    <main data-pagefind-body><h2 class='headheader' data-pagefind-meta='title' id='main'>QML Drag and Drop including reordering the C++ model</h2>
<p><small>Published: <span data-pagefind-meta='date'>21-01-2022</span> | Author: Remy van Elst | <a href="Qml_Drag_and_Drop_example_including_reordering_the_Cpp_Model.txt">Text only version of this article</a>
</small></p>
<br><div class='olderthanayear'><p><strong>&#10071; This post is over two years old. It may no longer be up to date. Opinions may have changed.</strong></p></div>
<div id="toc">
<h3>Table of Contents</h3>
<ul>
<li>
<a href="#toc_0">Drag and Drop in Qml</a>
</li>
<li>
<a href="#toc_1">Basic MVVM Qt setup</a>
</li>
<li>
<a href="#toc_2">QML Drag &amp; Drop</a>
</li>
<li>
<a href="#toc_3">Reordering the C++ model</a>
</li>
<li>
<a href="#toc_4">Code</a>
</li>
</ul>

</div><hr><div id="contents">
<p>This guide shows you how to implement drag and drop in Qml including how to reorder the backing C++ (<code>QAbstractListModel</code> derived) data model.
Most QML Drag and Drop examples you find online, including the Qt official example, use a <code>ListModel</code> in the same Qml file which has the data, but no example I found actually reordered a C++ model.
This example has a simple <code>MVVM (model-view-viewmodel)</code> C++ structure and a QML file with a drag and drop grid. The dragable example items come from the C++ model, which is derived from <code>QAbstractListModel</code>.</p>

<p class="ad"> <b>Recently I removed all Google Ads from this site due to their invasive tracking, as well as Google Analytics. Please, if you found this content useful, consider a small donation using any of the options below:</b><br><br> <a href="https://leafnode.nl">I'm developing an open source monitoring app called  Leaf Node Monitoring, for windows, linux & android. Go check it out!</a><br><br> <a href="https://github.com/sponsors/RaymiiOrg/">Consider sponsoring me on Github. It means the world to me if you show your appreciation and you'll help pay the server costs.</a><br><br> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">You can also sponsor me by getting a Digital Ocean VPS. With this referral link you'll get $100 credit for 60 days. </a><br><br> </p>

<p>This guide assumes you&#39;re familiair with Qml and have read through the 
<a href="https://web.archive.org/web/20220117060027/https://doc.qt.io/qt-5/qml-qtquick-drag.html">Drag</a> and <a href="https://web.archive.org/web/20161215174157/http://askubuntu.com/questions/301145/how-to-emit-ondropped-in-qml-drag-n-drop-example">DropArea</a> documentation and the <a href="https://web.archive.org/web/20220115175823/https://doc.qt.io/qt-5/qtquick-draganddrop-example.html">official drag and drop</a> example.</p>

<h3 id="toc_0">Drag and Drop in Qml</h3>

<p>Qml has the concept of drag and drop built in, you define a <code>DropArea</code>
somewhere and make something <code>Drag</code>-able, that&#39;s basically it. Really neat
and quick to set up, including <a href="https://web.archive.org/web/20220115175823/https://doc.qt.io/qt-5/qtquick-draganddrop-example.html">official examples</a></p>

<p>The second official example shows a grid of tiles which you can reorder by
dragging and dropping them. It uses a <code>DelegateModel</code>, a special Qml
repeater-like control which has both the model and the delegate, to move a
delegate item to the position of another item it is dragged over.</p>

<p>The example also states, quite clearly:</p>

<blockquote>
<p>The GridView Example adds drag and drop to a GridView, allowing you to
  visually reorder the delegates without changing the underlying ListModel.</p>
</blockquote>

<p>In my case, also changing the underlying listmodel (and backing C++ model) is
exactly what I want to do. It turned out to be a bit convoluted, due to how a
<code>DelegateModel</code> acts as a proxy, it has a <code>ListModel</code> which you can
manipulate, but that is more like a copy of the original <code>model:</code>. You must
explicitly propagate changes back to your C++ code.</p>

<h3 id="toc_1">Basic MVVM Qt setup</h3>

<p><img src="/s/inc/img/listmodel.gif" alt="drag and drop"></p>

<blockquote>
<p>A recording of the demo application</p>
</blockquote>

<p>The example application follows an MVVM-like pattern. It has a C++ class
named <code>Thingie</code>. In this case a <code>Thingie</code> has two properties, a name and color,
but imagine it to be a more complex class, maybe an image of some kind.</p>

<p>There is a <code>ThingieListModel</code>, your basic Qt <code>QAbstractListModel</code> derived
list, with a backing <code>QList&lt;Thingie&gt;</code> and one extra special method (<code>move</code>). </p>

<p>Finally there is a <code>ThingieModel</code>, the class that houses all business logic.
In an actual MVVM application there would also be a <code>ViewModel</code>, but for
this example that would be too much.</p>

<p>The <code>ThingieModel</code> is exposed to QML and constructs the list of <code>Thingies</code>,
which is also exposed to Qml as a property, via the model.</p>

<p>You can find the code <a href="https://github.com/RaymiiOrg/qml-drag-and-drop-reorder-cpp-model-example">here on my Github</a>, but for the sake of convinience,
the code is also at the bottom of this article.</p>

<h3 id="toc_2">QML Drag &amp; Drop</h3>

<p>My example has a grid of squares that you can drag and drop to re-order. The grid 
is in a sepeate file named <code>ThingGrid</code> and houses a <code>GridView</code> with a <code>DelegateModel</code>. 
The delegate of this model is another control, a <code>ThingTile</code>. This <code>ThingTile</code> has 
most of the <code>Drag</code> logic (rectangle with mousearea) and the tiles on the <code>ThingGrid</code>
have most of the <code>Drop</code> logic (<code>DropArea</code>). Inside the <code>ThingTile</code> you define your
own element, which in the case of the example is a <code>Text</code>, but could be anything.</p>

<p>Where my example differs from the Qt example is that my code has an explicit <code>MouseArea</code>
in the dragable tile, mostly to send signals back up above to the grid, the most 
important one being <code>parent.Drag.drop()</code>. If you&#39;re wondering why, well, let me explain.</p>

<p>The Drag &#39;thing&#39;, does not send a <code>drop</code> event / signal when you release it. It only generates
<code>entered</code> events when entering a DropArea. <a href="https://web.archive.org/web/20161215174157/http://askubuntu.com/questions/301145/how-to-emit-ondropped-in-qml-drag-n-drop-example">You must explicitly call the <code>drop()</code></a> method
on the <code>Drag</code> object.</p>

<p>The <a href="https://web.archive.org/web/20220117064303/https://code.qt.io/cgit/qt/qtdeclarative.git/tree/examples/quick/draganddrop/views/Icon.qml?h=5.15#n71">example has a <code>DragHandler</code> and no <code>MouseArea</code></a>, so it took me a while to figure out
how to send that <code>drop()</code> event. </p>

<p>But why do we need a <code>drop()</code> event? The official example already re-orders stuff once you
drop, you might ask.</p>

<p>The official example does not re-order when you drop, it re-orders when you <code>enter</code>. This
means, when you start dragging a square over another square (each square can be dragged, but
is also a drop area), it is already re-ordering the <strong>visual model</strong>. You can see this because
the animation starts (displacing the other square).</p>

<p>What we want to do however, is re-order the backing C++ model. Remember that the <code>DelegateModel</code>
acts as a kind of proxy between your actual <code>ListModel</code>. You&#39;re modifying the visual representation
of that model, not the actual model itself.</p>

<p>Inside our <code>DropArea</code> control in the <code>ThingGrid</code>, this is the code that handles the visual changes. 
Every square is both draggable as well as its own drop area, so when one square starts being dragged,
once it enters another square, this code triggers a visual change (and corresponding animation):</p>

<pre><code>onEntered: function (drag) {
    var from = (drag.source as Example.ThingTile).visualIndex
    var to = thingTile.visualIndex
    visualModel.items.move(from, to)
}
</code></pre>

<p>Do note that this is all on the visual model side, not the actual model. Once you drop an item inside a
<code>DropArea</code>, the following code triggers, handling the actual backend model change:</p>

<pre><code>onDropped: function (drag) {
    var from = modelIndex
    var to = (drag.source as Example.ThingTile).visualIndex
    ThingModel.listOfThingies.move(from, to)
}
</code></pre>

<p>The C++ <code>ThingModel</code> has a <code>Q_PROPERTY</code> names <code>listOfThingies</code>, which is the <code>QAbstractListModel</code> derived
class. QML calls the <code>move()</code> method directly on that listmodel. For the observant readers among you,
you might be wondering what <code>modelIndex</code> is in the latter method. The <code>DropArea</code> has a property <code>visualIndex</code>,
which is the actual index in the visual model:</p>

<pre><code>property int visualIndex: DelegateModel.itemsIndex
</code></pre>

<p>This property changes once we enter another droparea, via the <code>onEntered</code> method. But, we need to keep that
old index to move the C++ model. If we would use the visual index, then that would already be updated once
a drop occurs. Therefore I added a variable just below the <code>visualIndex</code>, named <code>modelIndex</code>. It is set once
you press the tile, but not via a property binding (otherwise it would update the same as the visualIndex), 
but via a JavaScript statement:</p>

<pre><code>Example.ThingTile {
  [...]
  onPressed: delegateRoot.modelIndex = visualIndex
</code></pre>

<p>This way, once you start dragging the square, the visual index updates and other squares are displaced. Only
when you drop, the actual C++ code is called with the old index and the new index. </p>

<h3 id="toc_3">Reordering the C++ model</h3>

<p>The basic C++ (read only) listmodel derived from <code>QAbstractListModel</code> for your
own data structures must subclass <code>rowCount</code>, <code>data</code> and <code>roleNames</code>(last one
for QML). At work we have a few more convinience methods, for example to
update a listmodel from a vector. Most model data comes from the C++ backend
and the listmodels are only used to display stuff in QML. </p>

<p>In this case, the data should also be re-ordered from QML. Most of the
<a href="https://web.archive.org/web/20220121064951/https://doc.qt.io/qt-5/model-view-programming.html#model-subclassing-reference">subclassing reference</a> documentation talks about removing data or adding
data from the model, not moving stuff around. There is the <code>beginMoveRows</code>
and <code>endMoveRows</code> method, but when I used that the visual model was not
ordered correctly and there were visual oddities when releasing an item. So,
in the end I went with a <code>beginResetModel</code> and <code>endResetModel</code>.</p>

<p>As you saw in the above Qml code, once the draggable tile is actually
released (dropped), a C++ method named <code>move()</code> is called. That method is
simple, in the backing <code>QList</code> it moves an item (not swapping) and emits the
correct signals to notify Qml that the model has changed:</p>

<pre><code>void ThingieListModel::move(int from, int to)
{
    if(from &gt;= 0 &amp;&amp; from &lt; rowCount() &amp;&amp; to &gt;= 0 &amp;&amp; to &lt; rowCount() &amp;&amp; from != to) 
    {
        if(from == to - 1) 
        { // Allow item moving to the bottom
            to = from++;
        }

        beginResetModel();
        //beginMoveRows(QModelIndex(), from, from, QModelIndex(), to);
        _thingies.move(from, to); // update backing QList
        //endMoveRows();
        endResetModel();
    }
}
</code></pre>

<p>I left the <code>moveRows</code> calls in there, if you can figure out why that doesn&#39;t work correctly, please 
let me know.</p>

<p>You could extend this method to emit another signal, which you can handle in the viewmodel
or actual model, for example, to send a call to a web api backend to also reorder the 
data.</p>

<h3 id="toc_4">Code</h3>

<p>The code is also <a href="https://github.com/RaymiiOrg/qml-drag-and-drop-reorder-cpp-model-example">on my github</a> but since it&#39;s small, I&#39;ve posted it here as well.</p>

<p>Generated with a bash loop to automatically intend for markdown:</p>

<pre><code>for i in *.h *.cpp *.qml; do 
  echo &#39;**&#39; $i &#39;**&#39;; 
  echo; 
  sed &#39;s/^/    /&#39; $i; 
  echo; 
  echo; 
done 
</code></pre>

<p><strong>ThingModel.h</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#ifndef THINGMODEL_H
#define THINGMODEL_H

#include &lt;QObject&gt;
#include &lt;ThingieListModel.h&gt;

class Thingie;
class ThingModel : public QObject
{
    Q_OBJECT
    Q_PROPERTY(ThingieListModel* listOfThingies READ listOfThingies CONSTANT)
public:
    ThingModel(QObject* parent = nullptr);

    Q_INVOKABLE QString printModel() { return _listOfThingies.print(); }
    ThingieListModel* listOfThingies() { return &amp;_listOfThingies; }

public slots:

signals:

private:
    ThingieListModel _listOfThingies;
};

#endif // THINGMODEL_H
</code></pre>

<p><strong>Thingie.h</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#ifndef THINGIE_H
#define THINGIE_H

#include &lt;QObject&gt;
#include &lt;QColor&gt;

class Thingie : public QObject
{
    Q_OBJECT
    Q_PROPERTY(QString name READ name WRITE setName NOTIFY nameChanged)
    Q_PROPERTY(QColor color READ color WRITE setColor NOTIFY colorChanged)

public:
    Thingie(const QString&amp; name, QObject* parent = nullptr);
    const QString &amp;name() const;
    const QColor &amp;color() const;

public slots:
    void setName(const QString &amp;newName);
    void setColor(const QColor &amp;newColor);

signals:
    void nameChanged(const QString &amp;name);
    void colorChanged(const QColor &amp;color);

private:
    QString _name;
    QColor _color = randomColor();

    QColor randomColor();
    QString randomHexString(unsigned int length);
};

#endif // THINGIE_H
</code></pre>

<p><strong>ThingieListModel.h</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#ifndef ThingieLISTMODEL_H
#define ThingieLISTMODEL_H

#include &quot;Thingie.h&quot;

#include &lt;QAbstractListModel&gt;

class ThingieListModel : public QAbstractListModel
{
    Q_OBJECT
public:
    enum ThingieRoles
    {
        NameRole = Qt::UserRole + 1,
        ColorRole,
        ModelIndexRole,
    };
    ThingieListModel(QObject *parent = nullptr);

    void updateFromVector(std::vector&lt;Thingie*&gt; newThingies);
    QHash&lt;int, QByteArray&gt; roleNames() const override;
    QVariant data(const QModelIndex &amp;index, int role = Qt::DisplayRole) const override;
    int rowCount(const QModelIndex &amp;parent = QModelIndex()) const override;

    Q_INVOKABLE void move(int from, int to);
    Q_INVOKABLE QString print();

private:
    QList&lt;Thingie*&gt; _thingies;
};

#endif // ThingieLISTMODEL_H
</code></pre>

<p><strong>ThingModel.cpp</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#include &quot;ThingModel.h&quot;
#include &quot;Thingie.h&quot;

ThingModel::ThingModel(QObject* parent) : QObject(parent)
{    
    std::vector&lt;Thingie*&gt; tmpV;
    tmpV.push_back(new Thingie(&quot;Coffee Bean&quot;, this));
    tmpV.push_back(new Thingie(&quot;Small Cup&quot;, this));
    tmpV.push_back(new Thingie(&quot;Remy van Elst&quot;, this));
    tmpV.push_back(new Thingie(&quot;Fire information&quot;, this));
    tmpV.push_back(new Thingie(&quot;New Products&quot;, this));
    tmpV.push_back(new Thingie(&quot;New Videos&quot;, this));
    tmpV.push_back(new Thingie(&quot;Corona Info&quot;, this));
    _listOfThingies.updateFromVector(tmpV);
}
</code></pre>

<p><strong>Thingie.cpp</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#include &quot;Thingie.h&quot;

#include &lt;random&gt;

Thingie::Thingie(const QString&amp; name, QObject* parent) : QObject(parent), _name(name)
{

}

const QString &amp;Thingie::name() const
{
    return _name;
}

void Thingie::setName(const QString &amp;newName)
{
    if (_name == newName)
        return;
    _name = newName;
    emit nameChanged(_name);
}

const QColor &amp;Thingie::color() const
{
    return _color;
}

void Thingie::setColor(const QColor &amp;newColor)
{
    if (_color == newColor)
        return;
    _color = newColor;
    emit colorChanged(_color);
}


QString Thingie::randomHexString(unsigned int length)
{
    QString result;
    static std::mt19937 generator {std::random_device {}()};
    std::string hex_characters = &quot;0123456789abcdef&quot;;
    std::uniform_int_distribution&lt;int&gt; dist(0, hex_characters.length() - 1);
    for (unsigned int i = 0; i &lt; length; i++)
    {
        result += hex_characters[dist(generator)];
    }
    return result;
}


QColor Thingie::randomColor()
{
    QString result = &quot;#&quot;;
    result.append(randomHexString(6));
    return QColor(result);
}
</code></pre>

<p><strong>ThingieListModel.cpp</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */
#include &quot;ThingieListModel.h&quot;

#include &lt;QDebug&gt;

ThingieListModel::ThingieListModel(QObject *parent) :
    QAbstractListModel(parent)
{
}

void ThingieListModel::updateFromVector(std::vector&lt;Thingie*&gt; newThingies)
{
    beginResetModel();
    _thingies.clear();
    for (const auto &amp;item : newThingies)
    {
        _thingies &lt;&lt; item;
    }
    endResetModel();
}

QHash&lt;int, QByteArray&gt; ThingieListModel::roleNames() const
{
    QHash&lt;int, QByteArray&gt; roles;
    roles[NameRole] = &quot;name&quot;;
    roles[ColorRole] = &quot;color&quot;;
    roles[ModelIndexRole] = &quot;modelIndex&quot;;
    return roles;
}

QVariant ThingieListModel::data(const QModelIndex &amp;index, int role) const
{
    if (!index.isValid())
    {
        return QVariant();
    }

    const Thingie *thingie = _thingies[index.row()];
    switch (role)
    {
    case NameRole:
        return thingie-&gt;name();

    case ColorRole:
        return thingie-&gt;color();

    case ModelIndexRole:
        if (std::find(_thingies.begin(), _thingies.end(), thingie) != _thingies.end()) {
          return std::distance(_thingies.begin(), std::find(_thingies.begin(), _thingies.end(), thingie));
        } else {
          return -1;
        }

    default:
        return QVariant();
    }
}

int ThingieListModel::rowCount(const QModelIndex &amp;) const
{
    return _thingies.count();
}


void ThingieListModel::move(int from, int to)
{
    if(from &gt;= 0 &amp;&amp; from &lt; rowCount() &amp;&amp; to &gt;= 0 &amp;&amp; to &lt; rowCount() &amp;&amp; from != to) {
        if(from == to - 1) { // Allow item moving to the bottom
            to = from++;
        }

        beginResetModel();
//        beginMoveRows(QModelIndex(), from, from, QModelIndex(), to);
        qInfo() &lt;&lt; &quot;model move from: &quot; &lt;&lt; from &lt;&lt; &quot; to: &quot; &lt;&lt; to;
        _thingies.move(from, to);
//        endMoveRows();
        endResetModel();

    }
}

QString ThingieListModel::print()
{
    QString tmp;
    for(int i = 0; i &lt; _thingies.size(); ++i) {
        tmp.append(QString::number(i));
        tmp.append(&quot;: &quot;);
        tmp.append(_thingies.at(i)-&gt;name());
        tmp.append(&quot;; &quot;);
    }
    return tmp;
}
</code></pre>

<p><strong>main.cpp</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

#include &quot;ThingModel.h&quot;
#include &quot;Thingie.h&quot;

#include &lt;QGuiApplication&gt;
#include &lt;QQmlApplicationEngine&gt;

int main(int argc, char *argv[])
{
#if QT_VERSION &lt; QT_VERSION_CHECK(6, 0, 0)
    QCoreApplication::setAttribute(Qt::AA_EnableHighDpiScaling);
#endif

    QGuiApplication app(argc, argv);

    qRegisterMetaType&lt;std::vector&lt;Thingie*&gt;&gt;(&quot;std::vector&lt;Thingie*&gt;&quot;);
    ThingModel* thingModel = new ThingModel;
    qmlRegisterSingletonInstance&lt;ThingModel&gt;(&quot;org.raymii.ThingModel&quot;, 1, 0, &quot;ThingModel&quot;, thingModel);


    QQmlApplicationEngine engine;
    const QUrl url(QStringLiteral(&quot;qrc:/main.qml&quot;));
    QObject::connect(&amp;engine, &amp;QQmlApplicationEngine::objectCreated,
                     &amp;app, [url](QObject *obj, const QUrl &amp;objUrl) {
        if (!obj &amp;&amp; url == objUrl)
            QCoreApplication::exit(-1);
    }, Qt::QueuedConnection);
    engine.load(url);

    return app.exec();
}
</code></pre>

<p><strong>ThingGrid.qml</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

import QtQuick 2.14
import QtQml.Models 2.15

import org.raymii.ThingModel 1.0

import &quot;./&quot; as Example

GridView {
    id: root
    width: 600
    height: 600

    cellWidth: 250
    cellHeight: 250

    displaced: Transition {
        NumberAnimation {
            properties: &quot;x,y&quot;
            easing.type: Easing.OutQuad
        }
    }

    model: DelegateModel {
        id: visualModel
        model: ThingModel.listOfThingies

        // each square is both a drag-able item as well as a droparea (to drop items in).
        delegate: DropArea {
            id: delegateRoot
            required property color color
            required property string name

            property int modelIndex

            width: root.cellWidth
            height: root.cellHeight

            onEntered: function (drag) {
                var from = (drag.source as Example.ThingTile).visualIndex
                var to = thingTile.visualIndex
                visualModel.items.move(from, to)
            }

            onDropped: function (drag) {
                var from = modelIndex
                var to = (drag.source as Example.ThingTile).visualIndex
                ThingModel.listOfThingies.move(from, to)
            }

            property int visualIndex: DelegateModel.itemsIndex

            Example.ThingTile {
                id: thingTile
                width: root.cellWidth * 0.8
                height: root.cellHeight * 0.8
                dragParent: root
                visualIndex: delegateRoot.visualIndex
                color: delegateRoot.color
                onPressed: delegateRoot.modelIndex = visualIndex

                // content of the draggable square
                Text {
                    anchors.fill: parent
                    anchors.centerIn: parent
                    horizontalAlignment: Text.AlignHCenter
                    verticalAlignment: Text.AlignVCenter
                    color: &quot;white&quot;
                    anchors.margins: 5
                    fontSizeMode: Text.Fit
                    minimumPixelSize: 10
                    font.pixelSize: 30
                    text: delegateRoot.name
                }
            }
        }
    }
}
</code></pre>

<p><strong>ThingTile.qml</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

import QtQuick 2.14

Rectangle {
    id: root
    required property Item dragParent
    signal pressed
    signal released
    signal clicked

    property int visualIndex: 0

    anchors {
        horizontalCenter: parent.horizontalCenter
        verticalCenter: parent.verticalCenter
    }
    radius: 3

    MouseArea {
        id: mouseArea
        anchors.fill: parent
        drag.target: root
        onClicked: root.clicked()
        onPressed: root.pressed()
        onReleased: {
            parent.Drag.drop()
            root.released()
        }
    }

    Drag.active: mouseArea.drag.active
    Drag.source: root
    Drag.hotSpot.x: root.width / 2
    Drag.hotSpot.y: root.height / 2

    states: [
        State {
            when: mouseArea.drag.active
            ParentChange {
                target: root
                parent: root.dragParent
            }

            AnchorChanges {
                target: root
                anchors.horizontalCenter: undefined
                anchors.verticalCenter: undefined
            }
        }
    ]
}
</code></pre>

<p><strong>main.qml</strong></p>

<pre><code>/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3
 */

import QtQuick 2.15
import QtQuick.Layouts 1.12
import QtQuick.Window 2.15
import QtQuick.Controls 2.15

import org.raymii.ThingModel 1.0

import &quot;./&quot; as Example

Window {
    width: 800
    height: 800
    visible: true
    title: qsTr(&quot;Drag &amp; Drop&quot;)

    Text {
        id: infoText
        anchors.top: parent.top
        anchors.left: parent.left
        horizontalAlignment: Text.AlignHCenter
        verticalAlignment: Text.AlignTop
        color: &quot;black&quot;
        anchors.margins: 5
        fontSizeMode: Text.Fit
        minimumPixelSize: 10
        font.pixelSize: 30
        height: 40
        text: &quot;Drag and drop images below to reorder them&quot;
    }

    Button {
        anchors.top: infoText.bottom
        anchors.left: parent.left
        anchors.leftMargin: 5
        id: printButton
        text: &quot;Log C++ Model&quot;
        onClicked: {
            modeltext.text = ThingModel.printModel()
        }
    }
    Text {
        id: modeltext
        anchors.top: printButton.bottom
        anchors.left: parent.left
        anchors.right: parent.right
        anchors.margins: 5
        text: &quot;&quot;
        font.pixelSize: 20
        height: 40
        fontSizeMode: Text.Fit
        wrapMode: Text.WordWrap
        minimumPixelSize: 10
    }

    Example.ThingGrid {
        id: g
        anchors.top: modeltext.bottom
        anchors.margins: 5
        anchors.left: parent.left
        anchors.right: parent.right
        anchors.bottom: parent.bottom
    }
}
</code></pre>
Tags: <a href="../tags/animation.html">animation</a>
, <a href="../tags/c++.html">c++</a>
, <a href="../tags/cpp.html">cpp</a>
, <a href="../tags/drag-and-drop.html">drag-and-drop</a>
, <a href="../tags/qabstractlistmodel.html">qabstractlistmodel</a>
, <a href="../tags/qml.html">qml</a>
, <a href="../tags/qt.html">qt</a>
, <a href="../tags/qt5.html">qt5</a>
, <a href="../tags/tutorials.html">tutorials</a>
</div></main>
<br/>
<footer>
<br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small>
                </p>
    
    </footer>
    <script data-goatcounter="https://raymii.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

    <script defer src="/s/inc/js/instant.5.2.0.js"  type="module" ></script>

     
    </main>
    </body>
    </html>
    