
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Install NetBSD 9.2 on a DEC Alpha CPU in QEMU with X11 - Raymii.org</title>
        <style> *, ::before, ::after {background-repeat: no-repeat;-webkit-box-sizing: border-box;box-sizing: border-box;}::before, ::after {text-decoration: inherit;vertical-align: inherit;}html {cursor: default;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";line-height: 1.15;-moz-tab-size: 4;-o-tab-size: 4;tab-size: 4;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;}body {background-color: white;margin: 0;}h1 {font-size: 2em;margin: 0.67em 0;}hr {height: 0;overflow: visible;}main {display: block;}nav ol, nav ul {list-style: none;}pre {font-family: Roboto Mono, Menlo, Consolas, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}a {background-color: transparent;}abbr[title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;}b, strong {font-weight: bolder;}code, kbd, samp {font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}small {font-size: 80%;}::-moz-selection {background-color: #b3d4fc;color: #000;text-shadow: none;}::selection {background-color: #b3d4fc;color: #000;text-shadow: none;}audio, canvas, iframe, img, svg, video {vertical-align: middle;}audio, video {display: inline-block;}audio:not([controls]) {display: none;height: 0;}img {border-style: none;}svg:not([fill]) {fill: currentColor;}svg:not(:root) {overflow: hidden;}table {border-collapse: collapse;}button, input, select, textarea {font-family: inherit;font-size: inherit;line-height: inherit;}button, input, select {margin: 0;}button {overflow: visible;text-transform: none;}button, [type="button"], [type="reset"], [type="submit"] {-webkit-appearance: button;}fieldset {padding: 0.35em 0.75em 0.625em;}input {overflow: visible;}legend {color: inherit;display: table;max-width: 100%;white-space: normal;}progress {display: inline-block;vertical-align: baseline;}select {text-transform: none;}textarea {margin: 0;overflow: auto;resize: vertical;}[type="checkbox"], [type="radio"] {padding: 0;}[type="search"] {-webkit-appearance: textfield;outline-offset: -2px;}::-webkit-inner-spin-button, ::-webkit-outer-spin-button {height: auto;}::-webkit-input-placeholder {color: inherit;opacity: 0.54;}::-webkit-search-decoration {-webkit-appearance: none;}::-webkit-file-upload-button {-webkit-appearance: button;font: inherit;}::-moz-focus-inner {border-style: none;padding: 0;}:-moz-focusring {outline: 1px dotted ButtonText;}details {display: block;}dialog {background-color: white;border: solid;color: black;display: block;height: -moz-fit-content;height: -webkit-fit-content;height: fit-content;left: 0;margin: auto;padding: 1em;position: absolute;right: 0;width: -moz-fit-content;width: -webkit-fit-content;width: fit-content;}dialog:not([open]) {display: none;}summary {display: list-item;}canvas {display: inline-block;}template {display: none;}a, area, button, input, label, select, summary, textarea, [tabindex] {-ms-touch-action: manipulation;touch-action: manipulation;}[hidden] {display: none;}[aria-busy="true"] {cursor: progress;}[aria-controls] {cursor: pointer;}[aria-disabled="true"], [disabled] {cursor: not-allowed;}[aria-hidden="false"][hidden]:not(:focus) {clip: rect(0, 0, 0, 0);display: inherit;position: absolute;}main, header, footer, article, section, aside, details, summary {margin: 0 auto;margin-bottom: 16px;width: 100%;}main {display: block;margin: 0 auto;max-width: 1000px;padding: 0 16px 16px;}footer {border-top: 1px solid rgba(0, 0, 0, 0.12);padding: 16px 0;text-align: left;}footer p {margin-bottom: 0;}hr {border: 0;border-top: 1px solid rgba(0, 0, 0, 0.12);display: block;margin-top: 16px;margin-bottom: 16px;width: 100%;-webkit-box-sizing: content-box;box-sizing: content-box;height: 0;overflow: visible;}img {height: auto;max-width: 100%;vertical-align: baseline;}@media screen and (max-width: 400px) {article, section, aside {clear: both;display: block;max-width: 100%;}img {margin-right: 16px;}}embed, iframe, video {border: 0;}body {color: rgba(0, 0, 0, 0.8);font-family: "Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 16px;line-height: 1.5;}p {margin: 0;margin-bottom: 16px;}h1, h2, h3, h4, h5, h6 {color: inherit;font-family: inherit;line-height: 1.2;font-weight: 500;}h1 {font-size: 40px;margin: 20px 0 16px;}h2 {font-size: 32px;margin: 20px 0 16px;}h3 {color: #75cc00;font-size: 28px;margin: 16px 0 4px;}h4 {color: #75cc00;font-size: 24px;margin: 16px 0 4px;}h5 {color: #75cc00;font-size: 20px;margin: 16px 0 4px;}h6 {color: #75cc00;font-size: 16px;margin: 16px 0 4px;}small {color: rgba(0, 0, 0, 0.54);vertical-align: bottom;}pre {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);display: block;font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;margin: 16px 0;padding: 16px;white-space: pre-wrap;overflow-wrap: break-word;}code {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;line-height: inherit;margin: 0;vertical-align: baseline;word-break: break-all;word-wrap: break-word;}a {color: #75cc00;text-decoration: none;background-color: transparent;}a:hover, a:focus {color: #0062cc;font-weight: bolder;text-decoration: underline;}dl {margin-bottom: 16px;}dd {margin-left: 40px;}ul, ol {margin-bottom: 8px;padding-left: 40px;vertical-align: baseline;}blockquote {border-left: 2px solid rgba(0, 0, 0, 0.8);font-family: Georgia, Times, "Times New Roman", serif;font-style: italic;margin: 16px 0;padding-left: 16px;}figcaption {font-family: Georgia, Times, "Times New Roman", serif;}u {text-decoration: underline;}s {text-decoration: line-through;}sup {font-size: 14px;vertical-align: super;}sub {font-size: 14px;vertical-align: sub;}mark {background: #ffeb3b;}input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="date"], input[type="month"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="week"], input[type="number"], input[type="search"], input[type="tel"], select, textarea {background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}input[type="color"] {background: #fff;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;display: inline-block;vertical-align: middle;}input:not([type]) {-webkit-appearance: none;background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;text-align: left;}input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="url"]:focus, input[type="date"]:focus, input[type="month"]:focus, input[type="time"]:focus, input[type="datetime"]:focus, input[type="datetime-local"]:focus, input[type="week"]:focus, input[type="number"]:focus, input[type="search"]:focus, input[type="tel"]:focus, input[type="color"]:focus, select:focus, textarea:focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input:not([type]):focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {outline: 1px thin rgba(0, 0, 0, 0.12);}input[type="text"][disabled], input[type="password"][disabled], input[type="email"][disabled], input[type="url"][disabled], input[type="date"][disabled], input[type="month"][disabled], input[type="time"][disabled], input[type="datetime"][disabled], input[type="datetime-local"][disabled], input[type="week"][disabled], input[type="number"][disabled], input[type="search"][disabled], input[type="tel"][disabled], input[type="color"][disabled], select[disabled], textarea[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input:not([type])[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input[readonly], select[readonly], textarea[readonly] {border-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);}input:focus:invalid, textarea:focus:invalid, select:focus:invalid {border-color: #ea1c0d;color: #f44336;}input[type="file"]:focus:invalid:focus, input[type="radio"]:focus:invalid:focus, input[type="checkbox"]:focus:invalid:focus {outline-color: #f44336;}select {border: 1px solid rgba(0, 0, 0, 0.12);vertical-align: sub;}select:not([size]):not([multiple]) {height: -webkit-calc(2.25rem + 2px);height: calc(2.25rem + 2px);}select[multiple] {height: auto;}label {display: inline-block;line-height: 2;}fieldset {border: 0;margin: 0;padding: 8px 0;}legend {border-bottom: 1px solid rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.8);display: block;margin-bottom: 8px;padding: 8px 0;width: 100%;}textarea {overflow: auto;resize: vertical;}input[type=checkbox], input[type=radio] {-webkit-box-sizing: border-box;box-sizing: border-box;padding: 0;display: inline;}input[type=submit], input[type=reset], input[type=button], button {background-color: #75cc00;border: #75cc00;border-radius: 4px;color: #fff;padding: 8px 16px;display: inline-block;font-weight: 400;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid transparent;font-size: 1rem;line-height: 1.5;-webkit-transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;}input[type=submit]::-moz-focus-inner, input[type=reset]::-moz-focus-inner, input[type=button]::-moz-focus-inner, button::-moz-focus-inner {padding: 0;}input[type=submit]:hover, input[type=reset]:hover, input[type=button]:hover, button:hover {background-color: #0069d9;border-color: #0062cc;color: #fff;}input[type=submit]:not(:disabled):active, input[type=reset]:not(:disabled):active, input[type=button]:not(:disabled):active, button:not(:disabled):active {background-color: #0062cc;border-color: #005cbf;color: #fff;}input[type=submit]:focus, input[type=reset]:focus, input[type=button]:focus, button:focus {outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);}input[type=submit]:disabled, input[type=reset]:disabled, input[type=button]:disabled, button:disabled {opacity: .65;cursor: not-allowed;background-color: #75cc00;border-color: #75cc00;color: #fff;}table {border-top: 1px solid rgba(0, 0, 0, 0.12);margin-bottom: 16px;}caption {padding: 8px 0;}thead th {border: 0;border-bottom: 2px solid rgba(0, 0, 0, 0.12);text-align: left;}tr {margin-bottom: 8px;}th, td {border-bottom: 1px solid rgba(0, 0, 0, 0.12);padding: 16px;white-space: nowrap;vertical-align: inherit;}tfoot tr {text-align: left;}tfoot td {color: rgba(0, 0, 0, 0.54);font-size: 8px;font-style: italic;padding: 16px 4px;}a.skip-main {left:-999px;position:absolute;top:auto;width:1px;height:1px;overflow:hidden;z-index:-999;}a.skip-main:focus, a.skip-main:active {color: #fff;background-color:#000;left: auto;top: auto;width: 30%;height: auto;overflow:auto;margin: 10px 35%;padding:5px;border-radius: 15px;border:4px solid yellow;text-align:center;font-size:1.2em;z-index:999;}@font-face {font-family: 'Raleway';font-style: normal;font-weight: 600;src: url('/s/inc/css/raleway-v18-latin-600.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-600.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-600.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-600.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-600.svg#Raleway') format('svg');}@font-face {font-family: 'Raleway';font-style: italic;font-weight: 400;src: url('/s/inc/css/raleway-v18-latin-italic.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-italic.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-italic.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-italic.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-italic.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-italic.svg#Raleway') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 400;src: url('/s/inc/css/roboto-mono-v12-latin-regular.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-regular.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-regular.svg#RobotoMono') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 600;src: url('/s/inc/css/roboto-mono-v12-latin-600.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-600.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-600.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-600.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-600.svg#RobotoMono') format('svg');}@font-face {font-family: 'Ubuntu';font-style: normal;font-weight: 400;src: url('/s/inc/css/ubuntu-v15-latin-regular.eot');src: local(''), url('/s/inc/css/ubuntu-v15-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/ubuntu-v15-latin-regular.woff2') format('woff2'), url('/s/inc/css/ubuntu-v15-latin-regular.woff') format('woff'), url('/s/inc/css/ubuntu-v15-latin-regular.ttf') format('truetype'), url('/s/inc/css/ubuntu-v15-latin-regular.svg#Ubuntu') format('svg');}@font-face {font-family:'Raleway2';font-style:normal;font-weight:normal;src:url('/s/inc/css/raleway.eot');src:local('Raleway2'),local('Raleway2'),url('/s/inc/css/raleway.ttf') }.headheader {font-family:"Raleway2"!important }.headheader a {color:#000;text-decoration:none }.headheader a:hover {color:#000;text-decoration:none!important }#toc ul {list-style: none;margin: 0;padding: 0;}#toc h3 {color:black;}</style>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAYAAAD2Fg1xAAABgElEQVQ4jb3VP0iVYRTH8c9waXBokog7OYhTXChuF3GIi4hoiJA4REQIOTgGtoWTg6ODs0SYComIXCJEMhpKtD9guUU0ujRFS0PQ8DzC24v3Pq+3S9/pnMOP8/7Ocx6el/OziRN0JXTD+I2xhK4WdeNteGmbu8IgC3jQQlfCZ0zgINHzJabwoQP+ClHGV1zGJXwRDJ/FDJZi3MBQE10dL2K8gZFOGE3REDZyyjLunKG7KAzZHfMaXjXp+QbXYlzBfrvmSuhBNaHrxQU8zdQW8RhrOe0snuB7zA/jd6p4n9HV8QMfY/4JPzGAt7meFfS18LdXEk7uemIQuJ/Lj6PZQezFWhm3cTWnXcAj3MrU5oWh5WpzGM3UurGNZy28HSa8J7mB3Uy+4u/rl+UdrsT4Jraa6F6jP5M3MP0PHguzL9zzqmC2GRNYjXF2qDzDwgbgHp53wGMhJrEunGQ9oT3CQ+GFasWBsLVvwiv5XygJz/JOAe208POrJHST+CVspBB/AFY9Q3+QJqLxAAAAAElFTkSuQmCC" alt="Raymii.org Logo">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>
                </small>
            </header>
          
    <h2 class='headheader' id='main'>Install NetBSD 9.2 on a DEC Alpha CPU in QEMU with X11</h2>
<p><small>Published: 18-08-2021 | Last update: 27-08-2021 | Author: Remy van Elst | <a href="NetBSD_on_QEMU_Alpha.txt">Text only version of this article</a>
</small></p>
<div class='ad'>
                                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7993642564731324"
                             crossorigin="anonymous"></script>
                        <!-- voorartikel -->
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-client="ca-pub-7993642564731324"
                             data-ad-slot="6172324376"
                             data-ad-format="auto"></ins>
                        <script>
                             (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                        </div><br><div id="toc">
<h3>Table of Contents</h3>
<ul>
<li>
<a href="#toc_0">Article changelog</a>
</li>
</ul>
</li>
<li>
<a href="#toc_1">Patching and building QEMU</a>
<ul>
<li>
<a href="#toc_2">Installing NetBSD</a>
<ul>
<li>
<a href="#toc_3">Downloading the ISO and kernels</a>
</li>
<li>
<a href="#toc_4">NetBSD Installation</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">Running NetBSD</a>
<ul>
<li>
<a href="#toc_6">Connecting via SSH to NetBSD</a>
</li>
</ul>
</li>
<li>
<a href="#toc_7">Setup X11 and VNC (GUI)</a>
<ul>
<li>
<a href="#toc_8">Installing binary packages (pkgsrc)</a>
</li>
</ul>
</li>
<li>
<a href="#toc_9">TigerVNC configuration</a>
</li>
<li>
<a href="#toc_10">OpenSSL Speed Benchmark</a>
</li>
<li>
<a href="#toc_11">SysBench benchmark</a>
</li>
</ul>

</div><hr><div id="contents">
<p>This is a guide on installing and running NetBSD for the Alpha CPU architecture on
QEMU, including a GUI (X11 via VNC). It requires you to patch
and compile QEMU yourself. It was never possible, until now, to run
an actual operating system <em>easily</em> with QEMU Alpha, so this is amazing! 
It is very cool that <a href="https://archive.md/7LXZK">Jason Thorpe</a> is putting in <a href="https://web.archive.org/web/20210306121313/http://mail-index.netbsd.org/port-alpha/2020/02/26/msg001040.html">so much effort
on the QEMU side</a>, as all but one patch is upstream already. Alpha emulation
has always been a niche of a niche, so seeing this improve in QEMU is wonderful.
OpenVMS does not boot yet since many more things are missing on the QEMU side,
but who knows what the future might bring? Maybe even Windows NT for Alpha will
boot on QEMU one day? </p>

<p class="ad"> <a href="https://leafnode.nl">I'm developing a desktop monitoring app,  Leaf Node Monitoring, open source, but paid. For Windows, Linux & Android, go check it out.</a><br><br> <a href="https://github.com/sponsors/RaymiiOrg/">Consider sponsoring me on Github. It means the world to me if you show your appreciation and you'll help pay the server costs.</a><br><br> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">You can also sponsor me by getting a Digital Ocean VPS. With this referral link you'll get $100 credit for 60 days. </a><br><br> </p>

<p>This article is based on <a href="http://web.archive.org/web/20210817034654/http://45.76.81.249/AXP/NetBSD/">work</a> by <a href="https://mobile.twitter.com/astr0baby/">astr0baby</a>/<a href="https://github.com/DoktorCranium">DoktorCranium</a> and
his twitter screenshots. His guide is quite sparse, which I try to improve
with this one. <a href="https://mobile.twitter.com/astr0baby/">astr0baby</a> does a lot of cool emulation stuff, his twitter
is full of screenshots of his M1 Macbook running all kinds of legacy
operating systems, from AIX to OpenVMS to MorphOS on whatever old CPU you can
think of.</p>

<p>Here is how the end result of this guide looks:</p>

<p><img src="/s/inc/img/qemu-system-alpha-14.png" alt="openttd"></p>

<blockquote>
<p>Modern OpenTTD and browsing on NetBSD on Alpha! </p>
</blockquote>

<p>If you&#39;re interested in Alpha emulation or running OpenVMS, check out <a href="/s/blog/AXPBox-version-1.0.0-released.html">AXPbox</a>
or read <a href="http://www.avanthar.com/healyzh/decemulation/Alpha.html">this page</a> for more information on available emulators. AXPbox
<a href="https://github.com/lenticularis39/axpbox/wiki/Guest-support">can boot</a> the NetBSD 9.1 installer, but it doesn&#39;t install yet, due to disk
emulation issues. If you get it working with 9.2 or the current NetBSD development release,
please let me know!</p>

<p>There were earlier attempts to use QEMU Alpha emulation, <a href="http://web.archive.org/web/20160509075529/http://systems.firstworks.com/2014/02/debian-5010-alpha.html">here is a guide from
2014 on running Debian</a>. However, Debian <a href="https://lists.debian.org/debian-devel-announce/2009/10/msg00000.html">dropped the Alpha architecture</a> after version 5.0 (lenny), so NetBSD is our only modern option. And
maybe Gentoo, but I&#39;m unsure of that. Tru64 will not run on QEMU currently. </p>

<p>The Alpha machine QEMU emulates is based on the Alpha DP264 platform, this is
probably best known as the basis of the Compaq AlphaServer ES40 and Compaq
AlphaStation ES40 systems, although a number of other AlphaStations
(e.g. XP900 and XP1000), AlphaServers (e.g. DS10 and DS20) and OEM boards
(e.g. AlphaPC 264DP and API UP2000) were also based on it. (<a href="https://boxes-of-tat.blogspot.com/2021/06/linux-for-alpha-on-qemu-system.html">via</a>)</p>

<p>I can&#39;t even do a <code>cat /proc/cpuinfo</code>. The NetBSD specific
<code>cpuctl identify 0</code> command reports <code>CPU identification not implemented for
this architecture</code>. With <code>dmesg</code> you get some info, but not much:  </p>

<pre><code>dmesg | grep MHz
[     1.000000] 6600 family, unknown model variation 0x1400, 250MHz, s/n QEMU
</code></pre>

<p>Here&#39;s a screenshot of NeoFetch in the QEMU console:</p>

<p><img src="/s/inc/img/qemu-system-alpha-17.png" alt="neofetch"></p>

<p>This guide is also available for <a href="/s/articles/NetBSD_Alpha_AXPbox.html">AXPbox</a>, the other open source DEC
Alpha emulator.</p>

<h4 id="toc_0">Article changelog</h4>

<ul>
<li>2021-08-27: Added <code>openssl speed</code> and <code>sysbench</code> benchmarks</li>
<li>2021-08-20: <code>pkgin</code> works again, repo issue fixed. Updated section in article accordingly.</li>
<li>2021-08-19: Added a few responses from Jason&#39;s mailing list answer regarding kernel / emulation.</li>
</ul>

<h3 id="toc_1">Patching and building QEMU</h3>

<p>Due to not all patches <a href="https://archive.md/7LXZK">being upstream</a> you must build QEMU yourself. This process
is rather simple, as you would expect it is nothing more than getting the source code,
applying the patch and the regular <code>./configure</code> followed by <code>make</code>. To install all
required build dependencies on Ubuntu, use the following command:</p>

<pre><code>apt-get build-dep qemu
</code></pre>

<p>The patch file is rather small, which is why I can share it here. Place the below
contents in a file named <code>alpha-mmclock-qemu.patch</code>:</p>

<pre><code>--- qemu/hw/rtc/mc146818rtc.c.orig  2020-10-01 00:56:55.574093880 +0000
+++ qemu/hw/rtc/mc146818rtc.c   2020-10-01 00:58:40.326479896 +0000
@@ -155,9 +155,15 @@ static uint32_t rtc_periodic_clock_ticks
 {
     int period_code;

+#if 0
+    /*
+     * Real hardware sets the PF bit rergardless if it actually
+     * raises an interrupt.
+     */
     if (!(s-&gt;cmos_data[RTC_REG_B] &amp; REG_B_PIE)) {
         return 0;
      }
+#endif

     period_code = s-&gt;cmos_data[RTC_REG_A] &amp; 0x0f;

@@ -944,6 +950,7 @@ static void rtc_realizefn(DeviceState *d
     }

     s-&gt;periodic_timer = timer_new_ns(rtc_clock, rtc_periodic_timer, s);
+    periodic_timer_update(s, qemu_clock_get_ns(rtc_clock), 0, true);
     s-&gt;update_timer = timer_new_ns(rtc_clock, rtc_update_timer, s);
     check_update_timer(s);
</code></pre>

<p>The manual process to build and install QEMU from the latest release is on
<a href="https://www.qemu.org/download/">the official site</a>. You can keep an eye on <a href="https://git.qemu.org/?p=qemu.git;a=history;f=hw/rtc/mc146818rtc.c">the source file mx146818rtc.c
git log</a> to see if the patch process is still required. As of writing this
article, it is, the latest commit there is <code>2021-05-13 Philippe Mathieu...
hw/rtc/mc146818rtc: Convert to 3-phase reset (Resettabl...)
(fae5a0420754453beca3407250899254fb6745a1)</code>. I&#39;m building git commit hash
<code>bd44d64a3879bb6b0ca19bff3be16e0093502fac</code>, but if you notice that the git
log of the above file is different, skip the patch/checkout step and let me
know if I need to update this article.</p>

<p>Clone the QEMU source repository:</p>

<pre><code>git clone https://gitlab.com/qemu-project/qemu.git
</code></pre>

<p>Navigate into the source folder:</p>

<pre><code>cd qemu
</code></pre>

<p>Checkout the specific commit I used when writing this article:</p>

<pre><code>git checkout bd44d64a3879bb6b0ca19bff3be16e0093502fac
</code></pre>

<p>Apply the patch:</p>

<pre><code>patch -p1 &lt; alpha-mmclock-qemu.patch 
</code></pre>

<p>Output should look like:</p>

<pre><code>patching file hw/rtc/mc146818rtc.c
Hunk #2 succeeded at 934 (offset -16 lines).
</code></pre>

<p>Initialize all git submodules:</p>

<pre><code>git submodule init
git submodule update --recursive
</code></pre>

<p>Start the actual build process, first the configure step, for speed of 
compilation specifically for the Alpha architecture only:</p>

<pre><code>./configure --target-list=alpha-softmmu 
</code></pre>

<p>Followed by make to start compilation. Replace <code>-j8</code> with your amount of CPU cores:</p>

<pre><code>make -j8
</code></pre>

<p>No <code>make install</code>, since I suspect you already have qemu installed and just
want to test out stuff. This build, due to being configured with a 
specific target, will only work with that, not &quot;regular&quot; QEMU as 
provided by your distro.</p>

<p>Make will take some time, when it is finished compiling, you should
have a binary named <code>qemu-system-alpha</code> inside the <code>build</code> folder:</p>

<pre><code>file build/qemu-system-alpha
</code></pre>

<p>Output:</p>

<pre><code>build/qemu-system-alpha: ELF 64-bit LSB pie executable, x86-64, version 1
(SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2,
BuildID[sha1]=bc41c3dfc1d574362343dbe4f8d06ad1f72806a6, for GNU/Linux
4.4.0, with debug_info, not stripped
</code></pre>

<p>If you run the binary, you should see a black window with a green text
greeting you (<code>Hello</code>):</p>

<p><img src="/s/inc/img/qemu-system-alpha-1.png" alt="screenshot qemu"></p>

<p>I had some configure errors (for example <code>ERROR:
Program &#39;keycodemapdb/tools/keymap-gen&#39; not found</code>) that were the result of
the <code>git submodule update</code> command failing. I had to reset all submodules and
try again with the following commands:</p>

<pre><code>git clean -xfd
git submodule foreach --recursive git clean -xfd
git reset --hard
git submodule foreach --recursive git reset --hard
git submodule update --init --recursive
</code></pre>

<h3 id="toc_2">Installing NetBSD</h3>

<p>The installation process runs as usual once it&#39;s booted up. You use an
interactive installer to install NetBSD, but to boot, we must provide the
kernel to QEMU  manually. The kernel file for installation is different from
the one for &quot;regular&quot; use. </p>

<h4 id="toc_3">Downloading the ISO and kernels</h4>

<p>Check <a href="https://nycdn.netbsd.org/pub/NetBSD-daily/HEAD/latest/images/">the following directory</a> for the current version of the latest
<code>current</code> ISO, in my case <code>NetBSD-9.99.88-alpha.iso</code>. Download the ISO:</p>

<pre><code>wget https://nycdn.netbsd.org/pub/NetBSD-daily/HEAD/latest/images/NetBSD-9.99.88-alpha.iso
</code></pre>

<p>Note: If the version number changed, the above command will return a 404 error and you must
specify the new URL yourself.</p>

<p>More information on how the <code>current</code> (development/daily) builds work can be
found <a href="https://www.netbsd.org/releases/current.html">here</a> on the NetBSD site.</p>

<p>I asked on <a href="http://mail-index.netbsd.org/port-alpha/2021/08/19/msg001212.html">the mailing list</a> why the kernels should be provided to QEMU
outside of the installed disk, this is what Jason had to say:</p>

<blockquote>
<p>The Qemu &quot;bios&quot; (palcode-clipper) for its Alpha emulation does not contain
  any of the I/O callbacks implemented by real DEC SRM firmware.  Nor does it
  contain any of the CLI implemented by real DEC SRM firmware.  As such,
  there is no way to use a boot loader program to load the kernel from the
  file system in the emulated machines disks.</p>
</blockquote>

<p>Download the two kernel files, start with the one for installation:</p>

<pre><code>wget http://nycdn.netbsd.org/pub/NetBSD-daily/HEAD/latest/alpha/installation/instkernel/netbsd.gz
</code></pre>

<p>Uncompress it and rename so we know which one is which:</p>

<pre><code>gunzip netbsd.gz
mv netbsd inst-netbsd
</code></pre>

<p>My file is for 9.99.88, yours may differ:</p>

<pre><code>file inst-netbsd
</code></pre>

<p>Output:</p>

<pre><code>inst-netbsd: ELF 64-bit LSB executable, Alpha (unofficial), version 1
(SYSV), statically linked, for NetBSD 9.99.88, stripped
</code></pre>

<p>Same for the one for regular use:</p>

<pre><code>wget http://nycdn.netbsd.org/pub/NetBSD-daily/HEAD/latest/alpha/binary/kernel/netbsd-GENERIC.QEMU.gz 
</code></pre>

<p>Extract it:</p>

<pre><code>gunzip netbsd-GENERIC.QEMU.gz 
</code></pre>

<p>File information:</p>

<pre><code>netbsd-GENERIC.QEMU: ELF 64-bit LSB executable, Alpha(unofficial), version
1 (SYSV), statically linked, for NetBSD 9.99.88, not stripped
</code></pre>

<p>I asked what the difference is between the installation kernel and the regular
QEMU kernel file on the mailing list:</p>

<blockquote>
<p>GENERIC.QEMU is exactly the same as GENERIC except that it has the kernel
  symbol table injected into it for use by the in-kernel debugger
  (and, eventually, the in-kernel linker for modules, once I finish
  implementing all of the necessary relocations for Alpha). </p>
</blockquote>

<h4 id="toc_4">NetBSD Installation</h4>

<p>Create a disk file which the installation will use:</p>

<pre><code>qemu-img create -f qcow2 disk.img 20G 
</code></pre>

<p>Start QEMU with the following command to start the installation:</p>

<pre><code>./build/qemu-system-alpha \
-m 1024 \
-kernel inst-netbsd \
-drive file=disk.img,media=disk,format=qcow2,index=0 \
-drive file=NetBSD-9.99.88-alpha.iso,media=cdrom,format=raw,index=1 \
-net nic \
-net user,hostfwd=tcp::2222-:22 
</code></pre>

<p>Change the ISO filename if the version number has changed upstream
(<code>NetBSD-9.99.88-alpha.iso</code>).</p>

<p>If you haven&#39;t applied the patch, the install will boot but hang with an error
regarding the clock:</p>

<p><img src="/s/inc/img/qemu-system-alpha-2.png" alt="screenshot rtc error"></p>

<p>Otherwise, you will be asked what type of terminal you&#39;re using and the
installation will start as you&#39;re used to:</p>

<p><img src="/s/inc/img/qemu-system-alpha-3.png" alt="screenshot installer"></p>

<p>Continue on with the interactive installer. I&#39;m not covering the entire
installation process since there are no special things you need to do
(like the qemu patch above).</p>

<p><img src="/s/inc/img/qemu-system-alpha-4.png" alt="screenshot installer"></p>

<p>I choose a full installation (not minimal or without X11), installed to disk <code>wd0</code>
using the CDROM as source:</p>

<p><img src="/s/inc/img/qemu-system-alpha-5.png" alt="screenshot installer"></p>

<p>I also setup networking during the installation, as well as enable SSH and mdns:</p>

<p><img src="/s/inc/img/qemu-system-alpha-6.png" alt="screenshot installer"></p>

<p>Here&#39;s the summary:</p>

<p><img src="/s/inc/img/qemu-system-alpha-7.png" alt="screenshot installer"></p>

<p>Once you&#39;re done installing, shut down the VM with the following command:</p>

<pre><code>shutdown -p now
</code></pre>

<h3 id="toc_5">Running NetBSD</h3>

<p>Once NetBSD is installed, the command to start qemu is different, since we&#39;re using a 
different kernel file and we&#39;re telling NetBSD which drive to boot from (<code>wd0</code>). </p>

<p>This is the new command:</p>

<pre><code>./build/qemu-system-alpha \
-m 1024 \
-kernel netbsd-GENERIC.QEMU \
-drive file=disk.img,media=disk,format=qcow2,index=0 \
-drive file=NetBSD-9.99.88-alpha.iso,media=cdrom,format=raw,index=1 \
-append &quot;rootdev=/dev/wd0&quot; \
-net nic \
-net user,hostfwd=tcp::2222-:22
</code></pre>

<p>If you do get questions asked during boot, just press ENTER to accept the defaults. </p>

<p>If all went well, you should be able to login to your fresh new shiny Alpha NetBSD:</p>

<p><img src="/s/inc/img/qemu-system-alpha-8.png" alt="screenshot netbsd"></p>

<p>Networking works out of the box as well:</p>

<p><img src="/s/inc/img/qemu-system-alpha-9.png" alt="screenshot netbsd"></p>

<p>Awesome, well done. For the final part, we&#39;re going to install and setup
TigerVNC so we can play around with a GUI.</p>

<h4 id="toc_6">Connecting via SSH to NetBSD</h4>

<p>The QEMU VM is started with the option <code>-net user,hostfwd=tcp::2222-:22</code>. This
means that on you local machine, port <code>2222</code> is forwarded to port <code>22</code> on the
VM. To SSH into the NetBSD machine (assuming networking is setup and
working), you can connect to that port on localhost:</p>

<pre><code>ssh root@127.0.0.1 -p 2222
</code></pre>

<p>I had to allow root login (<code>vi /etc/ssh/sshd_config</code>, <code>PermitRootLogin yes</code>,
<code>service sshd restart</code>), which in this case, for this local test machine not
directly exposed to the internet, is not a security risk.</p>

<p><img src="/s/inc/img/qemu-system-alpha-12.png" alt="SSH"></p>

<p>If you&#39;re unable to install packages (for whatever reason), you can use the
built-in features to have a GUI via SSH and Xnest. See <a href="/s/articles/Remote_desktop_on_NetBSD_with_Xnest_no_VNC.html">my other article</a> how to do that.</p>

<h3 id="toc_7">Setup X11 and VNC (GUI)</h3>

<p>X is installed by default, but crashes with a segfault if <a href="https://www.netbsd.org/docs/guide/en/chap-x.html">you run it</a> on
the QEMU VGA console (<code>X -configure</code>, then <code>X -config /root/xorg.conf.new</code>).
Therefore, we&#39;re going to use VNC, which does run and is quite fast and
usable. The <code>tigervnc</code> server is not included in the installation, which is
why we start with setting up the package manager and installing a few
packages.</p>

<p>A screenshot of the segfault:</p>

<p><img src="/s/inc/img/qemu-system-alpha-11.png" alt="x11 crash"></p>

<h4 id="toc_8">Installing binary packages (pkgsrc)</h4>

<p>Assuming networking works, we can use <a href="https://www.netbsd.org/docs/pkgsrc/using.html">the usual way</a> to install
binary packages. How amazing it is that NetBSD provides binary packages
for Alpha, compiling them would otherwise take very long.</p>

<p>Type the following commands in the shell to install the binary package manager:</p>

<pre><code>PATH=&quot;/usr/pkg/sbin:/usr/pkg/bin:$PATH&quot;
PKG_PATH=&quot;https://cdn.NetBSD.org/pub/pkgsrc/packages&quot;
PKG_PATH=&quot;$PKG_PATH/NetBSD/alpha/9.2/All/&quot;
export PATH PKG_PATH
pkg_add pkgin
</code></pre>

<p>Update the package sources:</p>

<pre><code>pkgin update
</code></pre>

<p>After that, you can install tigervnc:</p>

<pre><code>pkgin install tigervnc    
</code></pre>

<p><strong>When writing this article, there was an issue with the repository, the index
  file was corrupt. The below section covers that, but you can probably skip
  it if you&#39;re not interested in NetBSD&#39;s packaging system. You can continue
  with the section <code>TigerVNC Configuration</code>. After sending a message on the
  <code>port-alpha</code> mailing list, <a href="http://mail-index.netbsd.org/port-alpha/2021/08/20/msg001216.html">John fixed the repository</a>.</strong></p>

<p>In my case, <code>pkgin update</code> gave an error, <code>pkgin: Short read of pkg_summary: truncated
bzip2 input</code>. This seems to be a <a href="http://mail-index.netbsd.org/port-sparc64/2020/06/24/msg002966.html">corrupt file</a>, which I cannot fix from
here. I did however saw on the directory index, that there also was a gzipped
version (not bzip2), <code>pkg_summary.gz</code>, but I could not find a way to get
that file instead of the bzip2 file. </p>

<p><code>pkgin</code> is a handy wrapper that mimicks <code>apt/yum</code>, but underneath it uses
<code>pkg_*</code>, as far as I know, which we can also do manually. The repository URL
is setup after we&#39;ve exported the variables earlier, so you should be able to
just do:</p>

<pre><code>pkg_add fetch
</code></pre>

<p>You can also specify the entire URL to a package:</p>

<pre><code>pkg_add ftp://ftp.netbsd.org/pub/pkgsrc/packages/NetBSD/alpha/9.2/All/fetch-1.9nb1.tgz    
</code></pre>

<p>For the exact filename you can <a href="https://cdn.netbsd.org/pub/pkgsrc/packages/NetBSD/alpha/9.2/All/">browse the web index of Alpha packages</a>. </p>

<p>You can also use <code>ftp</code> to download the package, then install it locally:</p>

<pre><code>ftp -i ftp://ftp.netbsd.org/pub/pkgsrc/packages/NetBSD/alpha/9.2/All/fetch-1.9nb1.tgz
pkg_add ./fetch-1.9nb1.tgz
</code></pre>

<p>That will however still connect to the network to fetch dependencies, so if
you&#39;re doing this offline (lets say via an NFS share), you might run into
issues there. </p>

<p>Install the <code>tigervnc</code> package:</p>

<pre><code>pkg_add tigervnc
</code></pre>

<p>It will fetch some dependencies and should install correctly:</p>

<p><img src="/s/inc/img/qemu-system-alpha-10.png" alt="vnc install"></p>

<h3 id="toc_9">TigerVNC configuration</h3>

<p>Configuring tigerVNC is simple since most configuration is already 
done via the package. Start by setting up a VNC password:</p>

<pre><code>vncpasswd
</code></pre>

<p>Enter the password twice:</p>

<pre><code>Password:
Verify:
</code></pre>

<p>Answer no to a view only password:</p>

<pre><code>Would you like to enter a view-only password (y/n)? n
</code></pre>

<p>Start the VNC server:</p>

<pre><code>vncserver
</code></pre>

<p>Output:</p>

<pre><code>New &#39;netbsd.alpha.raymii.org:1 (root)&#39; desktop is netbsd.alpha.raymii.org:1

Creating default startup script /root/.vnc/xstartup
Creating default config /root/.vnc/config
Starting applications specified in /root/.vnc/xstartup
Log file is /root/.vnc/netbsd.alpha.raymii.org:1.log
</code></pre>

<p>To connect to your shiny new awesome desktop, you must use SSH to forward a
port. Disconnect your SSH session and reconnect with a new flag for a local
port forward:</p>

<pre><code>ssh root@127.0.0.1 -p 2222 -L 5901:127.0.0.1:5901
</code></pre>

<p>This forwards port 5901 (VNC port for display <code>:1</code>) on your local machine to
port <code>5901</code> on the virtual machine. After logging in, you should be able to
use any VNC client to connect right away:</p>

<p><img src="/s/inc/img/qemu-system-alpha-13.png" alt="vnc yay"></p>

<p>How cool is that? A modern NetBSD with a graphical desktop on a CPU
architecture (Alpha) running in QEMU, with networking. </p>

<p>After rebooting, you need to enter the <code>vncserver</code> command again to start
VNC. You can also setup a service to autostart at boot, but I&#39;m not going 
to cover how to do that in this guide. You&#39;ve gotten this far on a weird
CPU emulation article, I bet you that you&#39;re very capable of figuring
autostarting VNC out yourself.</p>

<p>For some more fun, you can install a browser (<code>netsurf</code> or <code>dillo</code>, firefox or
chrome are not available as packages) or a game (my favorite, <code>openttd</code> is
available as a package including the free graphics <code>openttd-data</code>). OpenTTD
is quite playable. Not very fast, but a small map seems to run okay.</p>

<p>It even seems <code>xfce4</code> packages are available in the repository, so you could deck out
a full featured desktop. I&#39;ve tried installing it, but after 18 hours or so, it&#39;s 
still running. Netsurf took just as long, and it seems to be the installation
of GTK that takes so much time. As Jason says on the mailing list, it might be 
related to disk IO:</p>

<blockquote>
<p>Yikes.  I&#39;ll need pkg install experts to weigh in on this.  It&#39;s entirely
  possible that it&#39;s bottlenecked on the disk emulation.  I&#39;m working on
  getting VirtIO to work on alpha so hopefully we can speed disk and network
  access up a little.</p>
</blockquote>

<p>If there is any software you do want to run but not available as a binary
package, compiling it yourself (or letting <code>pkgsrc</code> do it for you) is always
an option.</p>

<p><img src="/s/inc/img/qemu-system-alpha-14.png" alt="openttd"></p>

<p>I managed to compile <code>python2</code> via <code>pkgsrc</code>, the <code>cvs checkout</code> of <code>pkgsrc</code>
took a day or so to complete:</p>

<p><img src="/s/inc/img/qemu-system-alpha-16.png" alt="python2"></p>

<p>The setup of <code>pkgsrc</code> for source compilation is documented on the NetBSD website
but this is the process I used, if you want to try it out:</p>

<pre><code>cd /usr &amp;&amp; cvs -q -z2 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r pkgsrc-2021Q1 -P pkgsrc
cd /usr/pkgsrc/lang/python27
make fetch-list | sh; # fetch dependencies
make NO_CHECKSUM=yes 
make install
</code></pre>

<p>If you get any segfaults or <code>internal compiler errors</code> during building, my
experience is that those go away if you retry the build. (Do a <code>make clean</code> first). 
Below is an example error message, which did not occur when I retried the compilation:</p>

<pre><code>mv -f .deps/loadapi.Tpo .deps/loadapi.Po
gcc -DLOCALEDIR=\&quot;/usr/pkg/share/locale\&quot; -DLIBDIR=\&quot;/usr/pkg/lib\&quot; -DINCLUDEDIR=\&quot;/usr/pkg/include\&quot; -DHAVE_CONFIG_H -I.  -I./glob   -I/usr/include -I/usr/pkg/include  -O2 -mieee -D_FORTIFY_SOURCE=2 -I/usr/include -MT main.o -MD -MP -MF .deps/main.Tpo -c -o main.o main.c
during GIMPLE pass: cddce
main.c: In function &#39;main&#39;:
main.c:1066:1: internal compiler error: Segmentation fault
 1066 | main (int argc, char **argv, char **envp)
      | ^~~~
no stack trace because unwind library not available
Please submit a full bug report,
with preprocessed source if appropriate.
See &lt;http://www.NetBSD.org/support/send-pr.html&gt; for instructions.
*** Error code 1

Stop.
make[2]: stopped in /usr/pkgsrc/devel/gmake/work/make-4.2.1
*** Error code 1
</code></pre>

<p>Astrobaby even got DOOM running:</p>

<p><img src="/s/inc/img/qemu-system-alpha-15.png" alt="doom"></p>

<h3 id="toc_10">OpenSSL Speed Benchmark</h3>

<p><a href="https://boxes-of-tat.blogspot.com/2021/06/linux-for-alpha-on-qemu-system.html">This article</a> has some benchmarks on Debian 5.0 on QEMU Alpha, including
<code>OpenSSL speed</code>. <a href="http://web.archive.org/web/20210827055720/https://emuvm.com/support/benchmarks/">EmuVM</a> has a few benchmarks as well, both real Alpha
machines as their commercial emulator. Most of the other benchmarks do not
run on NetBSD (Only OpenVMS or Tru64), so reproducing that is hard. OpenSSL
however, is included on NetBSD by default. Newer version, but hopefully
comparable results.</p>

<p><code>OpenSSL speed</code> is a performance benchmark for each of the available
algorithms. Because this is an old CPU architecture, and because <a href="https://boxes-of-tat.blogspot.com/2021/06/linux-for-alpha-on-qemu-system.html">the other
article</a> does so (as well as <a href="http://web.archive.org/web/20210827055720/https://emuvm.com/support/benchmarks/">EmuVM</a>), I&#39;m trying just the <code>md5</code> and
<code>rsa</code> benchmarks. </p>

<p><strong>The OpenSSL benchmark fails</strong>. Results overflow on the RSA side and MD5
doesn&#39;t give any numbers. Not sure if this is an emulation issue, or a
NetBSD issue. Might also be in OpenSSL, it&#39;s quite a new version(1.1.1) and
I&#39;m not sure if the OpenSSL project still tests on Alpha machines.  I&#39;m
including the results, for future reference it might be interesting. For
comparison however, they are useless. </p>

<p>Results of <code>rsa</code> calculations:</p>

<pre><code>netbsd# openssl speed rsa
Doing 512 bits private rsa&#39;s for 10s: 
Doing 512 bits public rsa&#39;s for 10s: 100761 512 bits public RSA&#39;s in 0.00s
Doing 1024 bits private rsa&#39;s for 10s: 2142 1024 bits private RSA&#39;s in 0.00s
Doing 1024 bits public rsa&#39;s for 10s: 113632 1024 bits public RSA&#39;s in 0.00s
Doing 2048 bits private rsa&#39;s for 10s: 1138 2048 bits private RSA&#39;s in 0.00s
Doing 2048 bits public rsa&#39;s for 10s: 40512 2048 bits public RSA&#39;s in 0.00s
Doing 3072 bits private rsa&#39;s for 10s: 385 3072 bits private RSA&#39;s in 0.00s
Doing 3072 bits public rsa&#39;s for 10s: 20155 3072 bits public RSA&#39;s in 0.00s
Doing 4096 bits private rsa&#39;s for 10s: 174 4096 bits private RSA&#39;s in 0.00s
Doing 4096 bits public rsa&#39;s for 10s: 11464 4096 bits public RSA&#39;s in 0.00s
Doing 7680 bits private rsa&#39;s for 10s: 29 7680 bits private RSA&#39;s in 0.00s
Doing 7680 bits public rsa&#39;s for 10s: 3540 7680 bits public RSA&#39;s in 0.00s
Doing 15360 bits private rsa&#39;s for 10s: 4 15360 bits private RSA&#39;s in 0.00s
Doing 15360 bits public rsa&#39;s for 10s: 913 15360 bits public RSA&#39;s in 0.00s
OpenSSL 1.1.1k  25 Mar 2021
NetBSD 9.99.88
options:bn(64,64) rc4(int) des(int) aes(partial) idea(int) blowfish(ptr) 
gcc version 10.3.0 (NetBSD nb1 20210411) 
                  sign    verify    sign/s verify/s
rsa  512 bits      infs 0.000000s      0.0 923036700778489577472.0
rsa 1024 bits 0.000000s 0.000000s 20953569512310820864.0 1054135706452407615488.0
rsa 2048 bits 0.000000s 0.000000s 11156638280728354816.0 374733567055141208064.0
rsa 3072 bits 0.000000s 0.000000s 3761703789465102336.0 186142468490230857728.0
rsa 4096 bits 0.000000s 0.000000s 1695153782552369408.0 105969518684333555712.0
rsa 7680 bits 0.000000s 0.000000s 278990477569769280.0 32383696070560972800.0
rsa 15360 bits 0.000000s 0.000000s 37610866572920040.0 8378888909113309184.0
</code></pre>

<p>Results of <code>md5</code> calculations:</p>

<pre><code>netbsd# openssl speed md5
Doing md5 for 3s on 16 size blocks: 
Doing md5 for 3s on 64 size blocks: 
Doing md5 for 3s on 256 size blocks: 
Doing md5 for 3s on 1024 size blocks: 
Doing md5 for 3s on 8192 size blocks: 
Doing md5 for 3s on 16384 size blocks: 
OpenSSL 1.1.1k  25 Mar 2021   NetBSD 9.99.88
options:bn(64,64) rc4(int) des(int) aes(partial) idea(int) blowfish(ptr) 
gcc version 10.3.0 (NetBSD nb1 20210411) 
The &#39;numbers&#39; are in 1000s of bytes per second processed.
type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes
md5                  0.00         0.00         0.00         0.00         0.00         0.00 
</code></pre>

<p>I did try to play with some options (longer runtime, <code>-elapsed</code> flag
(<code>Use wall-clock time instead of CPU user time as divisor</code>) but none 
helped. The weird thing is that these two commands work fine on <a href="/s/articles/NetBSD_Alpha_AXPbox.html">AXPbox with NetBSD</a>,
which makes me suspect that there is an issue with QEMU emulation as opposed to
an issue in OpenSSL. The other article has OpenSSL results from Debian 5.0, 
so it might be a combination of this OpenSSL version with QEMU, but I&#39;m not sure.</p>

<h3 id="toc_11">SysBench benchmark</h3>

<p>The <a href="https://cdn.netbsd.org/pub/pkgsrc/packages/NetBSD/alpha/9.2/All/">NetBSD Alpha</a> package repository does have a <code>sysbench</code> package. 
Sysbench is quite a populair cross platform benchmarking tool and it even
gave reasonable results, as opposed to OpenSSL. It&#39;s an older version, 
currently we&#39;re at sysbench 1.0.20 and NetBSD has 0.4.12. </p>

<p>CPU: </p>

<pre><code>sysbench --test=cpu run --max-time=30
sysbench 0.4.12:  multi-threaded system evaluation benchmark

Running the test with following options:
Number of threads: 1

Doing CPU performance benchmark

Threads started!
Time limit exceeded, exiting...
Done.

Maximum prime number checked in CPU test: 10000


Test execution summary:
    total time:                          30.0547s
    total number of events:              532
    total time taken by event execution: 30.0458
    per-request statistics:
         min:                                 53.15ms
         avg:                                 56.48ms
         max:                                132.93ms
         approx.  95 percentile:                infms

Threads fairness:
    events (avg/stddev):           532.0000/0.00
    execution time (avg/stddev):   30.0458/0.00
</code></pre>

<p>Memory:</p>

<pre><code>netbsd# sysbench --test=memory run --max-time=60
sysbench 0.4.12:  multi-threaded system evaluation benchmark

Running the test with following options:
Number of threads: 1

Doing memory operations speed test
Memory block size: 1K

Memory transfer size: 102400M

Memory operations type: write
Memory scope type: global
Threads started!
Time limit exceeded, exiting...
Done.

Operations performed: 1257653 (20960.15 ops/sec)

1228.18 MB transferred (20.47 MB/sec)


Test execution summary:
    total time:                          60.0021s
    total number of events:              1257653
    total time taken by event execution: 56.4853
    per-request statistics:
         min:                                  0.02ms
         avg:                                  0.04ms
         max:                                202.10ms
         approx.  95 percentile:                infms

Threads fairness:
    events (avg/stddev):           1257653.0000/0.00
    execution time (avg/stddev):   56.4853/0.00
</code></pre>

<p>A 30 second timeout failed the test, which is why the max time for memory is 60.</p>

<p>File I/O:</p>

<pre><code>netbsd# sysbench --test=fileio --file-test-mode=seqwr --file-num=8 run --max-time=60
sysbench 0.4.12:  multi-threaded system evaluation benchmark

Running the test with following options:
Number of threads: 1

Extra file open flags: 0
8 files, 256Mb each
2Gb total file size
Block size 16Kb
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing sequential write (creation) test
Threads started!
Done.

Operations performed:  0 Read, 131072 Write, 8 Other = 131080 Total
Read 0b  Written 2Gb  Total transferred 2Gb  (34.332Mb/sec)
 2197.25 Requests/sec executed

Test execution summary:
    total time:                          59.6529s
    total number of events:              131072
    total time taken by event execution: 57.6667
    per-request statistics:
         min:                                  0.11ms
         avg:                                  0.44ms
         max:                              13918.59ms
         approx.  95 percentile:                infms

Threads fairness:
    events (avg/stddev):           131072.0000/0.00
    execution time (avg/stddev):   57.6667/0.00
</code></pre>

<p>The default number of files (128) failed with an error message, too many open
files, which is why I tried with 8.</p>

<p>Comparing the results to AXPbox is interesting. Summarized below are the AXPbox results:</p>

<pre><code>CPU: total number of events: 19
Memory: 447.07 MB transferred (7.45 MB/sec)
Disk: Operations performed:  0 Read, 37353 Write, 0 Other = 37353 Total
Read 0b  Written 583.64Mb  Total transferred 583.64Mb  (9.7263Mb/sec)
  622.48 Requests/sec executed
</code></pre>

<p>These are the QEMU results, running on the same host machine and the same NetBSD version:</p>

<pre><code>CPU: total number of events: 532
Memory: 1228.18 MB transferred (20.47 MB/sec)
Disk: Operations performed:  0 Read, 131072 Write, 8 Other = 131080 Total
Read 0b  Written 2Gb  Total transferred 2Gb  (34.332Mb/sec)
 2197.25 Requests/sec executed
</code></pre>

<p>The emulation provided by QEMU seems to be faster by a large amount, on all three
tests. This is a basic benchmark and we have to keep in mind that both emulators
emulate different hardware and that the core code of AXPbox is over 10 years old.</p>

<p>A comparison with the machine that runs the QEMU VM (x86, Intel i7-8750H):</p>

<pre><code>$ sysbench --test=cpu run --max-time=30
WARNING: the --test option is deprecated. You can pass a script name or path on the command line without any options.
WARNING: --max-time is deprecated, use --time instead
sysbench 1.0.20 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time

Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  1369.69

General statistics:
    total time:                          30.0010s
    total number of events:              41094

Latency (ms):
         min:                                    0.71
         avg:                                    0.73
         max:                                    3.78
         95th percentile:                        0.75
         sum:                                29991.75

Threads fairness:
    events (avg/stddev):           41094.0000/0.00
    execution time (avg/stddev):   29.9918/0.00
</code></pre>
Tags: <a href="../tags/alpha.html">alpha</a>
, <a href="../tags/articles.html">articles</a>
, <a href="../tags/dec.html">dec</a>
, <a href="../tags/netbsd.html">netbsd</a>
, <a href="../tags/openvms.html">openvms</a>
, <a href="../tags/qemu.html">qemu</a>
, <a href="../tags/unix.html">unix</a>
</div>
<br/>
<footer>
<br/>
                <form role="search" action="https://encrypted.google.com/search"
                style="min-width:250px;max-width:300px;">
                    <div class="form-group">
                      <input type="hidden" name="as_sitesearch" value="raymii.org">
                      <input type="hidden" name="as_qdr" value="all">
                      <input type="text" name="as_q" class="form-control" placeholder="Search">
                    </div>
                  </form>
                <br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small>
                </p>
    
    </footer>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3704876-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-3704876-6');
    </script>
    <script data-goatcounter="https://raymii.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
     
    </main>
    </body>
    </html>
    