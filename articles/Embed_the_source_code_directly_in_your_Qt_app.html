
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Embed the source code directly in your Qt app with qmake and qrc, for GPL compliance - Raymii.org</title>
        <style> *, ::before, ::after {background-repeat: no-repeat;-webkit-box-sizing: border-box;box-sizing: border-box;}::before, ::after {text-decoration: inherit;vertical-align: inherit;}html {cursor: default;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";line-height: 1.15;-moz-tab-size: 4;-o-tab-size: 4;tab-size: 4;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;}body {background-color: white;margin: 0;}h1 {font-size: 2em;margin: 0.67em 0;}hr {height: 0;overflow: visible;}main {display: block;}nav ol, nav ul {list-style: none;}pre {font-family: Roboto Mono, Menlo, Consolas, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}a {background-color: transparent;}abbr[title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;}b, strong {font-weight: bolder;}code, kbd, samp {font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;font-size: 1em;}small {font-size: 80%;}::-moz-selection {background-color: #b3d4fc;color: #000;text-shadow: none;}::selection {background-color: #b3d4fc;color: #000;text-shadow: none;}audio, canvas, iframe, img, svg, video {vertical-align: middle;}audio, video {display: inline-block;}audio:not([controls]) {display: none;height: 0;}img {border-style: none;}svg:not([fill]) {fill: currentColor;}svg:not(:root) {overflow: hidden;}table {border-collapse: collapse;}button, input, select, textarea {font-family: inherit;font-size: inherit;line-height: inherit;}button, input, select {margin: 0;}button {overflow: visible;text-transform: none;}button, [type="button"], [type="reset"], [type="submit"] {-webkit-appearance: button;}fieldset {padding: 0.35em 0.75em 0.625em;}input {overflow: visible;}legend {color: inherit;display: table;max-width: 100%;white-space: normal;}progress {display: inline-block;vertical-align: baseline;}select {text-transform: none;}textarea {margin: 0;overflow: auto;resize: vertical;}[type="checkbox"], [type="radio"] {padding: 0;}[type="search"] {-webkit-appearance: textfield;outline-offset: -2px;}::-webkit-inner-spin-button, ::-webkit-outer-spin-button {height: auto;}::-webkit-input-placeholder {color: inherit;opacity: 0.54;}::-webkit-search-decoration {-webkit-appearance: none;}::-webkit-file-upload-button {-webkit-appearance: button;font: inherit;}::-moz-focus-inner {border-style: none;padding: 0;}:-moz-focusring {outline: 1px dotted ButtonText;}details {display: block;}dialog {background-color: white;border: solid;color: black;display: block;height: -moz-fit-content;height: -webkit-fit-content;height: fit-content;left: 0;margin: auto;padding: 1em;position: absolute;right: 0;width: -moz-fit-content;width: -webkit-fit-content;width: fit-content;}dialog:not([open]) {display: none;}summary {display: list-item;}canvas {display: inline-block;}template {display: none;}a, area, button, input, label, select, summary, textarea, [tabindex] {-ms-touch-action: manipulation;touch-action: manipulation;}[hidden] {display: none;}[aria-busy="true"] {cursor: progress;}[aria-controls] {cursor: pointer;}[aria-disabled="true"], [disabled] {cursor: not-allowed;}[aria-hidden="false"][hidden]:not(:focus) {clip: rect(0, 0, 0, 0);display: inherit;position: absolute;}main, header, footer, article, section, aside, details, summary {margin: 0 auto;margin-bottom: 16px;width: 100%;}main {display: block;margin: 0 auto;max-width: 1000px;padding: 0 16px 16px;}footer {border-top: 1px solid rgba(0, 0, 0, 0.12);padding: 16px 0;text-align: left;}footer p {margin-bottom: 0;}hr {border: 0;border-top: 1px solid rgba(0, 0, 0, 0.12);display: block;margin-top: 16px;margin-bottom: 16px;width: 100%;-webkit-box-sizing: content-box;box-sizing: content-box;height: 0;overflow: visible;}img {height: auto;max-width: 100%;vertical-align: baseline;}@media screen and (max-width: 400px) {article, section, aside {clear: both;display: block;max-width: 100%;}img {margin-right: 16px;}}embed, iframe, video {border: 0;}body {color: rgba(0, 0, 0, 0.8);font-family: "Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 16px;line-height: 1.5;}p {margin: 0;margin-bottom: 16px;}h1, h2, h3, h4, h5, h6 {color: inherit;font-family: inherit;line-height: 1.2;font-weight: 500;}h1 {font-size: 40px;margin: 20px 0 16px;}h2 {font-size: 32px;margin: 20px 0 16px;}h3 {color: #75cc00;font-size: 28px;margin: 16px 0 4px;}h4 {color: #75cc00;font-size: 24px;margin: 16px 0 4px;}h5 {color: #75cc00;font-size: 20px;margin: 16px 0 4px;}h6 {color: #75cc00;font-size: 16px;margin: 16px 0 4px;}small {color: rgba(0, 0, 0, 0.54);vertical-align: bottom;}pre {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);display: block;font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;margin: 16px 0;padding: 16px;white-space: pre-wrap;overflow-wrap: break-word;}code {background: #f7f7f9;color: rgba(0, 0, 0, 0.8);font-family: "Roboto Mono", Menlo, Monaco, Consolas, "Courier New", monospace;font-size: 16px;line-height: inherit;margin: 0;vertical-align: baseline;word-break: break-all;word-wrap: break-word;}a {color: #75cc00;text-decoration: none;background-color: transparent;}a:hover, a:focus {color: #0062cc;font-weight: bolder;text-decoration: underline;}dl {margin-bottom: 16px;}dd {margin-left: 40px;}ul, ol {margin-bottom: 8px;padding-left: 40px;vertical-align: baseline;}blockquote {border-left: 2px solid rgba(0, 0, 0, 0.8);font-family: Georgia, Times, "Times New Roman", serif;font-style: italic;margin: 16px 0;padding-left: 16px;}figcaption {font-family: Georgia, Times, "Times New Roman", serif;}u {text-decoration: underline;}s {text-decoration: line-through;}sup {font-size: 14px;vertical-align: super;}sub {font-size: 14px;vertical-align: sub;}mark {background: #ffeb3b;}input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="date"], input[type="month"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="week"], input[type="number"], input[type="search"], input[type="tel"], select, textarea {background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}input[type="color"] {background: #fff;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;display: inline-block;vertical-align: middle;}input:not([type]) {-webkit-appearance: none;background: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, 0.12);border-radius: 4px;color: rgba(0, 0, 0, 0.8);display: block;width: 100%;padding: 8px 16px;line-height: 1.5;-webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;text-align: left;}input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="url"]:focus, input[type="date"]:focus, input[type="month"]:focus, input[type="time"]:focus, input[type="datetime"]:focus, input[type="datetime-local"]:focus, input[type="week"]:focus, input[type="number"]:focus, input[type="search"]:focus, input[type="tel"]:focus, input[type="color"]:focus, select:focus, textarea:focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input:not([type]):focus {background-color: #fff;border-color: #80bdff;outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {outline: 1px thin rgba(0, 0, 0, 0.12);}input[type="text"][disabled], input[type="password"][disabled], input[type="email"][disabled], input[type="url"][disabled], input[type="date"][disabled], input[type="month"][disabled], input[type="time"][disabled], input[type="datetime"][disabled], input[type="datetime-local"][disabled], input[type="week"][disabled], input[type="number"][disabled], input[type="search"][disabled], input[type="tel"][disabled], input[type="color"][disabled], select[disabled], textarea[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input:not([type])[disabled] {background-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);cursor: not-allowed;opacity: 1;}input[readonly], select[readonly], textarea[readonly] {border-color: rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.54);}input:focus:invalid, textarea:focus:invalid, select:focus:invalid {border-color: #ea1c0d;color: #f44336;}input[type="file"]:focus:invalid:focus, input[type="radio"]:focus:invalid:focus, input[type="checkbox"]:focus:invalid:focus {outline-color: #f44336;}select {border: 1px solid rgba(0, 0, 0, 0.12);vertical-align: sub;}select:not([size]):not([multiple]) {height: -webkit-calc(2.25rem + 2px);height: calc(2.25rem + 2px);}select[multiple] {height: auto;}label {display: inline-block;line-height: 2;}fieldset {border: 0;margin: 0;padding: 8px 0;}legend {border-bottom: 1px solid rgba(0, 0, 0, 0.12);color: rgba(0, 0, 0, 0.8);display: block;margin-bottom: 8px;padding: 8px 0;width: 100%;}textarea {overflow: auto;resize: vertical;}input[type=checkbox], input[type=radio] {-webkit-box-sizing: border-box;box-sizing: border-box;padding: 0;display: inline;}input[type=submit], input[type=reset], input[type=button], button {background-color: #75cc00;border: #75cc00;border-radius: 4px;color: #fff;padding: 8px 16px;display: inline-block;font-weight: 400;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid transparent;font-size: 1rem;line-height: 1.5;-webkit-transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;}input[type=submit]::-moz-focus-inner, input[type=reset]::-moz-focus-inner, input[type=button]::-moz-focus-inner, button::-moz-focus-inner {padding: 0;}input[type=submit]:hover, input[type=reset]:hover, input[type=button]:hover, button:hover {background-color: #0069d9;border-color: #0062cc;color: #fff;}input[type=submit]:not(:disabled):active, input[type=reset]:not(:disabled):active, input[type=button]:not(:disabled):active, button:not(:disabled):active {background-color: #0062cc;border-color: #005cbf;color: #fff;}input[type=submit]:focus, input[type=reset]:focus, input[type=button]:focus, button:focus {outline: 0;-webkit-box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);}input[type=submit]:disabled, input[type=reset]:disabled, input[type=button]:disabled, button:disabled {opacity: .65;cursor: not-allowed;background-color: #75cc00;border-color: #75cc00;color: #fff;}table {border-top: 1px solid rgba(0, 0, 0, 0.12);margin-bottom: 16px;}caption {padding: 8px 0;}thead th {border: 0;border-bottom: 2px solid rgba(0, 0, 0, 0.12);text-align: left;}tr {margin-bottom: 8px;}th, td {border-bottom: 1px solid rgba(0, 0, 0, 0.12);padding: 16px;white-space: nowrap;vertical-align: inherit;}tfoot tr {text-align: left;}tfoot td {color: rgba(0, 0, 0, 0.54);font-size: 8px;font-style: italic;padding: 16px 4px;}a.skip-main {left:-999px;position:absolute;top:auto;width:1px;height:1px;overflow:hidden;z-index:-999;}a.skip-main:focus, a.skip-main:active {color: #fff;background-color:#000;left: auto;top: auto;width: 30%;height: auto;overflow:auto;margin: 10px 35%;padding:5px;border-radius: 15px;border:4px solid yellow;text-align:center;font-size:1.2em;z-index:999;}@font-face {font-family: 'Raleway';font-style: normal;font-weight: 600;src: url('/s/inc/css/raleway-v18-latin-600.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-600.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-600.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-600.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-600.svg#Raleway') format('svg');}@font-face {font-family: 'Raleway';font-style: italic;font-weight: 400;src: url('/s/inc/css/raleway-v18-latin-italic.eot');src: local(''), url('/s/inc/css/raleway-v18-latin-italic.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/raleway-v18-latin-italic.woff2') format('woff2'), url('/s/inc/css/raleway-v18-latin-italic.woff') format('woff'), url('/s/inc/css/raleway-v18-latin-italic.ttf') format('truetype'), url('/s/inc/css/raleway-v18-latin-italic.svg#Raleway') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 400;src: url('/s/inc/css/roboto-mono-v12-latin-regular.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-regular.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-regular.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-regular.svg#RobotoMono') format('svg');}@font-face {font-family: 'Roboto Mono';font-style: normal;font-weight: 600;src: url('/s/inc/css/roboto-mono-v12-latin-600.eot');src: local(''), url('/s/inc/css/roboto-mono-v12-latin-600.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/roboto-mono-v12-latin-600.woff2') format('woff2'), url('/s/inc/css/roboto-mono-v12-latin-600.woff') format('woff'), url('/s/inc/css/roboto-mono-v12-latin-600.ttf') format('truetype'), url('/s/inc/css/roboto-mono-v12-latin-600.svg#RobotoMono') format('svg');}@font-face {font-family: 'Ubuntu';font-style: normal;font-weight: 400;src: url('/s/inc/css/ubuntu-v15-latin-regular.eot');src: local(''), url('/s/inc/css/ubuntu-v15-latin-regular.eot?#iefix') format('embedded-opentype'), url('/s/inc/css/ubuntu-v15-latin-regular.woff2') format('woff2'), url('/s/inc/css/ubuntu-v15-latin-regular.woff') format('woff'), url('/s/inc/css/ubuntu-v15-latin-regular.ttf') format('truetype'), url('/s/inc/css/ubuntu-v15-latin-regular.svg#Ubuntu') format('svg');}@font-face {font-family:'Raleway2';font-style:normal;font-weight:normal;src:url('/s/inc/css/raleway.eot');src:local('Raleway2'),local('Raleway2'),url('/s/inc/css/raleway.ttf') }.headheader {font-family:"Raleway2"!important }.headheader a {color:#000;text-decoration:none }.headheader a:hover {color:#000;text-decoration:none!important }#toc ul {list-style: none;margin: 0;padding: 0;}#toc h3 {color:black;}</style>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />         
    </head>
    <body>
        
        <a id="top-of-page"></a>
        <main>
        <a class="skip-main" href="#main">Skip to main content</a>
            <header>
                <h1 class="headheader">
                    <a href="https://raymii.org/s/">Raymii.org 
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAYAAAD2Fg1xAAABgElEQVQ4jb3VP0iVYRTH8c9waXBokog7OYhTXChuF3GIi4hoiJA4REQIOTgGtoWTg6ODs0SYComIXCJEMhpKtD9guUU0ujRFS0PQ8DzC24v3Pq+3S9/pnMOP8/7Ocx6el/OziRN0JXTD+I2xhK4WdeNteGmbu8IgC3jQQlfCZ0zgINHzJabwoQP+ClHGV1zGJXwRDJ/FDJZi3MBQE10dL2K8gZFOGE3REDZyyjLunKG7KAzZHfMaXjXp+QbXYlzBfrvmSuhBNaHrxQU8zdQW8RhrOe0snuB7zA/jd6p4n9HV8QMfY/4JPzGAt7meFfS18LdXEk7uemIQuJ/Lj6PZQezFWhm3cTWnXcAj3MrU5oWh5WpzGM3UurGNZy28HSa8J7mB3Uy+4u/rl+UdrsT4Jraa6F6jP5M3MP0PHguzL9zzqmC2GRNYjXF2qDzDwgbgHp53wGMhJrEunGQ9oT3CQ+GFasWBsLVvwiv5XygJz/JOAe208POrJHST+CVspBB/AFY9Q3+QJqLxAAAAAElFTkSuQmCC" alt="Raymii.org Logo">
                    </a>
                </h1>
                <small>
                  Quis custodiet ipsos custodes?<br>
                  <a href="/s/">Home</a> | 
                  <a href="/s/static/About.html">About</a> | 
                  <a href="/s/tags/all.html">All pages</a> | 
                  <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                  <a href="https://raymii.org/s/feed.xml">RSS Feed</a> | 
                  <a href="gopher://raymii.org:70">Gopher</a>                 
                </small><br/><p>
                <link href="/s/_pagefind/pagefind-ui.css" rel="stylesheet">
                <script src="/s/_pagefind/pagefind-ui.js" type="text/javascript"></script>
                <div id="search" style="min-width:400px;max-width:1080px;"></div>
                <script>
                    window.addEventListener('DOMContentLoaded', (event) => {
                        new PagefindUI({ element: "#search" });
                    });
                </script>
                </p>
            </header>
          
    <main data-pagefind-body><h2 class='headheader' data-pagefind-meta='title' id='main'>Embed the source code directly in your Qt app with qmake and qrc, for GPL compliance</h2>
<p><small>Published: <span data-pagefind-meta='date'>12-02-2022</span> | Author: Remy van Elst | <a href="Embed_the_source_code_directly_in_your_Qt_app.txt">Text only version of this article</a>
</small></p>
<br><div class='olderthanayear'><p><strong>&#10071; This post is over one year old. It may no longer be up to date. Opinions may have changed.</strong></p></div>
<div id="toc">
<h3>Table of Contents</h3>
<ul>
<li>
<a href="#toc_0">Source code availability</a>
</li>
<li>
<a href="#toc_1">qmake a source code archive</a>
</li>
<li>
<a href="#toc_2">Save a Qt qrc embedded file to disk</a>
</li>
</ul>

</div><hr><div id="contents">
<p>In my earlier <a href="/s/blog/Selling_GPL_Software_part_1_lots_of_hurdles.html">post on selling GPL software</a> I outlined a few points that make it hard to sell GPL software. One of them is the availability of the source code. You could put it online but then everyone has access without paying. Other options like putting it behind a login or sending a link after purchase require extra systems and saving more user information, lots of extra hassle for me and the users.
One of my ideas for &#39;solving&#39; this issue is by shipping the actual source code directly inside the application. This article shows you how to do that, by creating an archive of the current source code on every build with <code>qmake</code> and embedding that inside the application using <code>qrc</code>, including a button to save the archive locally to disk. It works on the desktop as well as Android, including the required permissions.</p>

<p class="ad"> <b>Recently I removed all Google Ads from this site due to their invasive tracking, as well as Google Analytics. Please, if you found this content useful, consider a small donation using any of the options below:</b><br><br> <a href="https://leafnode.nl">I'm developing an open source monitoring app called  Leaf Node Monitoring, for windows, linux & android. Go check it out!</a><br><br> <a href="https://github.com/sponsors/RaymiiOrg/">Consider sponsoring me on Github. It means the world to me if you show your appreciation and you'll help pay the server costs.</a><br><br> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">You can also sponsor me by getting a Digital Ocean VPS. With this referral link you'll get $100 credit for 60 days. </a><br><br> </p>

<p><img src="/s/inc/img/savetodisk4.png" alt="screenshot"></p>

<blockquote>
<p>Screenshot of the demo application</p>
</blockquote>

<p>The example program has 2 buttons, one to save the zip archive we dynamically
create on every build and one to save the example image. The example image is a
random screenshot I found in an old folder from one of my previous jobs, that
system is no longer in use.</p>

<p>This solves another hurdle, the mobile app source aspect. On a desktop
I can provide a zip file with the installer and source code, but in the 
app stores I cannot do that, just an <code>.apk</code> file or <code>.aab</code> bundle. </p>

<p>By embedding the code inside the application, on Android the users can
save the code from within the app to their system, no need to download
a source archive.</p>

<p>This guide works for Qt5 and assumes you&#39;re familiar with the Qt framework
and Qml. The demo program can be found <a href="https://github.com/RaymiiOrg/QtQrcSourceCodeToDisk">on github</a>. The first part of 
the guide covers dynamically creating the source archive on every build
and the second part covers embedding it in a Qt application.</p>

<p>This is part 2 in my series on selling GPL software. You can find 
the other parts here:</p>

<ul>
<li><a href="https://raymii.org/s/blog/Selling_GPL_Software_part_1_lots_of_hurdles.html">Part 1: Selling my own GPL software, part 1: a lot of hurdles</a></li>
<li><a href="https://raymii.org/s/articles/Embed_the_source_code_directly_in_your_Qt_app.html">Part 2: Embed the source code directly in your Qt app with qmake and qrc, for GPL compliance</a></li>
<li><a href="https://raymii.org/s/blog/Existing_GPL_software_for_sale.html">Part 3: Existing GPL software for sale</a></li>
</ul>

<h3 id="toc_0">Source code availability</h3>

<p>If you haven&#39;t read the <a href="/s/blog/Selling_GPL_Software_part_1_lots_of_hurdles.html">previous article</a>, I recomend you do, as this
explains why I&#39;m struggling with this part, source code availability. I do
want the source to be available, but only to actual customers. Whatever they
then do with the source code is their right, as long as it&#39;s compliant with
the GPL. So I&#39;m not against publishing the code, but I also don&#39;t want to end
up with the software being available everywhere. In the end, if a customer does
buy the program and publishes the source, it&#39;s their right to do so and I&#39;m fine
with that.</p>

<p>The <a href="https://www.gnu.org/licenses/gpl-faq.html#DoesTheGPLAllowDownloadFee">GPL FAQ</a> has three Q&amp;A items regarding charging and source distribution 
which answer all the questions you might have:</p>

<p><strong>Does the GPL allow me to sell copies of the program for money?</strong></p>

<blockquote>
<p>Yes, the GPL allows everyone to do this. The right to sell copies is part of
  the definition of free software. Except in one special situation, there is
  no limit on what price you can charge. (The one exception is the required
  written offer to provide source code that must accompany binary-only
  release.)</p>
</blockquote>

<p><strong>Does the GPL allow me to charge a fee for downloading the program from my
  distribution site?</strong></p>

<blockquote>
<p>Yes. You can charge any fee you wish for distributing a copy of the program.
  Under GPLv2, if you distribute binaries by download, you must
  provide &quot;equivalent access&quot; to download the source--therefore, the fee to
  download source may not be greater than the fee to download the binary. If
  the binaries being distributed are licensed under the GPLv3, then you must
  offer equivalent access to the source code in the same way through the same
  place at no further charge.</p>
</blockquote>

<p><strong>If I distribute GPLed software for a fee, am I required to also make it
  available to the public without a charge?</strong></p>

<blockquote>
<p>No. However, if someone pays your fee and gets a copy, the GPL gives them
  the freedom to release it to the public, with or without a fee. For
  example, someone could pay your fee, and then put her copy on a web site
  for the general public. </p>
</blockquote>

<p>The last line of the second item, <code>you must offer equivalent access to the
source code in the same way through the same place at no further charge</code>,
seems to be covered as far as I can tell when I provide the source together
with the download and inside the application (whenever a download is not
possible such as on app-stores).</p>

<p>One of the effects of this way of publishing the source code is that you do
need to be able to run the application before you can extract the source
code. Newer versions also require a new purchase, since the app only ships
with that version&#39;s source code. On desktop platforms I do plan to ship an
archive of the source in the download after purchase, so you&#39;re not required
to run the application to get the source, but on Android in the app store
that is not possible. So, in that case, this is best effort, if it even gets
through app-store review.</p>

<h3 id="toc_1">qmake a source code archive</h3>

<p>You can find the example project <a href="https://github.com/RaymiiOrg/QtQrcSourceCodeToDisk">here on github</a>. This section
of the article covers how the source code archive is made, later on we&#39;ll 
cover the <code>qrc</code> section to extract the archive on disk.</p>

<p>I&#39;m shipping a simple <code>.zip</code> archive with the source code and relevant
project files. The file is created with the following command:</p>

<pre><code>zip -r source.zip ./ -i &#39;*.cpp&#39; &#39;*.h&#39; &#39;*.qml&#39; &#39;*.qrc&#39; &#39;*.pro&#39; &#39;*.png&#39; &#39;README.md&#39; &#39;LICENSE&#39;
</code></pre>

<p>This command produces a zip file relative to the current working directory
in which the folder structure is preserved. It includes all files on 
the wildcard extensions list and the <code>README.md</code> file. </p>

<p>This file, <code>source.zip</code>, is referenced in the <code>DISTFILES</code> section of the <code>.pro</code> 
file as well as in the <code>qrc</code> file (to be embedded in the application), so
it must be available before building the program.</p>

<p>At first I tried to add an extra compiler to the <code>qmake</code> project file,
as is <a href="http://web.archive.org/web/20211007231100/https://doc.qt.io/qt-5/qmake-advanced-usage.html#adding-compilers">documented here</a>, but that was a bit of a hassle. Either I
had to add all input files, otherwise changes would not be detected,
or there would be a lot of variable trickery. Also, when the command
runs wasn&#39;t entirely predictable, and I need to run the command <strong>before</strong> 
the actual build. This is because we reference the <code>source.zip</code> file in
our <code>qrc</code> file, it must be there before we build.</p>

<p>In the end I used a simple <code>system()</code> command, which is guaranteed to run
before the actual build:</p>

<pre><code>system(cd $$PWD; rm source.zip; zip -r source.zip ./ -i \&#39;*.cpp\&#39; \&#39;*.h\&#39; \&#39;*.qml\&#39; \&#39;*.qrc\&#39; \&#39;*.pro\&#39; \&#39;*.png\&#39; \&#39;android/*\&#39; &#39;README.md&#39; &#39;LICENSE&#39;)
</code></pre>

<p>This is not cross-platform and only works with this specific zip version&#39;s 
commandline flags, but for now that&#39;s fine enough. I can always encapsulate
a different command later on in a block like below:</p>

<pre><code>win32 {
    system(windows command)
} else {
    system(linux command)
}
</code></pre>

<p>The output when building via Qt Creator or running <code>qmake</code> looks like this:</p>

<pre><code>19:48:23: Running steps for project qrcToDisk...
19:48:23: Starting: &quot;/bin/qmake&quot; /src/QtExamples/qrcToDisk/qrcToDisk.pro -spec linux-g++ CONFIG+=debug CONFIG+=qml_debug
  adding: src/QtExamples/qrcToDisk/files/example.png (deflated 14%)
  adding: src/QtExamples/qrcToDisk/SaveToDisk.cpp (deflated 56%)
  adding: src/QtExamples/qrcToDisk/qml.qrc (deflated 36%)
  adding: src/QtExamples/qrcToDisk/main.qml (deflated 64%)
  adding: src/QtExamples/qrcToDisk/main.cpp (deflated 50%)
  adding: src/QtExamples/qrcToDisk/qrcToDisk.pro (deflated 41%)
  adding: src/QtExamples/qrcToDisk/SaveToDisk.h (deflated 33%)
19:48:23: The process &quot;/bin/qmake&quot; exited normally.
</code></pre>

<p>If you omit the <code>rm</code> command, any already existing files will be overwritten and new files
are added. Old files are not removed.</p>

<p>The zip archive opens just fine and the contents are as expected:</p>

<p><img src="/s/inc/img/savetodisk1.png" alt="zipfile"></p>

<h3 id="toc_2">Save a Qt qrc embedded file to disk</h3>

<p>A <code>qrc</code> file is part of the <a href="http://web.archive.org/web/20220211112006/https://doc.qt.io/qt-5/resources.html">Qt resource system</a>. The Qt resource system is
a platform-independent mechanism for storing binary files in the
application&#39;s executable. Most often <code>qmake</code> generates <code>make</code> rules to
generate the file <code>qrc_application.cpp</code> which is linked into your
application. This file contains all the data for the images and other
resources as static C++ arrays of compressed binary data. </p>

<p>You can also configure <code>qrc</code> to create an external binary resource file which
is later registered with the resource system. This is useful if you have, for
example, two sets of images for the same codebase.</p>

<p>Below you&#39;ll find the example contents of my <code>qml.qrc</code> file:</p>

<pre><code>&lt;RCC&gt;
    &lt;qresource prefix=&quot;/&quot;&gt;
        &lt;file&gt;main.qml&lt;/file&gt;
        &lt;file&gt;files/example.png&lt;/file&gt;
        &lt;file&gt;source.zip&lt;/file&gt;
    &lt;/qresource&gt;
&lt;/RCC&gt;
</code></pre>

<p>Copying a file out of <code>qrc</code> to the filesystem is as simple as calling
<code>QFile::copy</code>. <code>QFile</code> supports the Qt resource system and if your file&#39;s
path starts with a colon (<code>:</code>), it knows to look in the resource system 
for the filename. An example:</p>

<pre><code>QFile::copy(&quot;:/files/example.png&quot;, &quot;/tmp/example.png&quot;);
</code></pre>

<p>With the above <code>qrc</code> file, the file <code>example.png</code> that is embedded in the 
application will be copied to the <code>/tmp</code> folder.</p>

<p>The demo program I wrote to test this does a bit more, like sanitizing the 
filename, checking for non-existing folders and overwriting, but the one
<code>QFile::copy</code> like is the gist of it.</p>

<p>One problem I had was that at first I used a <a href="http://web.archive.org/web/20210507002851/https://doc.qt.io/qt-5/qml-qtquick-dialogs-filedialog.html">QML FileDialog</a> to let the
user select the folder to save the files into. The returned path however, on
linux, started with <code>file://</code>, instead of just the path(<code>/home/user/...</code>). On
Android, the path returned, no matter what the user choose, was
<code>/data/user/0/org.qtproject.example.qrcToDisk</code>, which is not a folder the
user can browse to. At first I tried to work around those issues, but that
proved not to work reliably, so I opted to just use
<code>QStandardPaths::DocumentsLocation</code>, which should always return something,
create the folder if needed.</p>

<p>One other thing to keep in mind is that by default the permissions of files
in the <code>qrc</code> file are read-only (since you can&#39;t write back to it) and 
<code>QFile</code> copies those permissions. In the example project I set the file
permission of the new file to be writable. </p>

<p>Same thing goes for the case where the destination file already exists,
<code>QFile::copy</code> will fail unless you manually remove that file. </p>

<p>In this example I overwrite any existing files, it&#39;s up to any users of this
example to implement a user question to overwrite. </p>

<p>There is a bit of boilerplate code to request permissions dynamically on 
Android, those permissions are already in the <code>AndroidManifest.xml</code> file,
but newer versions of Android also require you to ask for them before 
using them, so we do. If it all works, it looks like below:</p>

<p><img src="/s/inc/img/savetodisk2.jpg" alt="android save"></p>

<p>Once saved, the files are in the <code>Documents</code> folder:</p>

<p><img src="/s/inc/img/savetodisk3.jpg" alt="source Android"></p>
Tags: <a href="../tags/articles.html">articles</a>
, <a href="../tags/c++.html">c++</a>
, <a href="../tags/cpp.html">cpp</a>
, <a href="../tags/gpl.html">gpl</a>
, <a href="../tags/law.html">law</a>
, <a href="../tags/leaf-node-monitoring.html">leaf-node-monitoring</a>
, <a href="../tags/license.html">license</a>
, <a href="../tags/qmake.html">qmake</a>
, <a href="../tags/qml.html">qml</a>
, <a href="../tags/qrc.html">qrc</a>
, <a href="../tags/qt.html">qt</a>
, <a href="../tags/qt5.html">qt5</a>
</div></main>
<br/>
<footer>
<br>
                <p><small>
                <a href="/s/">Home</a> | 
                <a href="/s/static/About.html">About</a> | 
                <a href="/s/tags/all.html">All pages</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                Generated by <a href="/s/software/ingsoc.html">ingsoc</a>.</small>
                </p>
    
    </footer>
    <script data-goatcounter="https://raymii.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

    <script defer src="/s/inc/js/instant.5.2.0.js"  type="module" ></script>

     
    </main>
    </body>
    </html>
    